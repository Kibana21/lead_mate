<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Platform - Interactive Prototype</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .phone-frame {
            width: 375px;
            height: 812px;
            background: #f8f9fa;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }
        
        .status-bar {
            height: 44px;
            background: #1a1a2e;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-size: 12px;
            position: relative;
            z-index: 100;
        }
        
        .screen {
            display: none;
            height: calc(100% - 44px - 80px);
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .screen.active {
            display: block;
        }
        
        .back-button {
            color: white;
            font-size: 20px;
            padding: 10px 20px;
            cursor: pointer;
            background: transparent;
            border: none;
        }
        
        /* Home Screen Styles */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 0 0 30px 30px;
        }
        
        .header-with-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .greeting {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .agent-level {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .stats-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .progress-section {
            background: white;
            margin: 15px 20px;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .progress-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 78%;
            transition: width 0.3s ease;
        }
        
        .section-header {
            padding: 20px 20px 10px;
            font-size: 18px;
            font-weight: 600;
            color: #1a1a2e;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            margin: 0 20px 15px;
        }
        
        .lead-card {
            background: white;
            margin: 0 20px 15px;
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 4px solid #ffd700;
            position: relative;
            animation: slideIn 0.3s ease;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .lead-card:hover {
            transform: translateY(-2px);
        }
        
        .lead-card.diamond {
            border-left-color: #b24bf3;
            background: linear-gradient(135deg, #faf5ff 0%, #fff 100%);
        }
        
        .lead-card.gold {
            border-left-color: #ffd700;
        }
        
        .tier-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .diamond-badge {
            background: linear-gradient(135deg, #b24bf3 0%, #9333ea 100%);
            color: white;
        }
        
        .gold-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #664d00;
        }
        
        .lead-name {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 4px;
        }
        
        .lead-info {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .lead-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 12px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #666;
        }
        
        .hot-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: #fff3cd;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 12px;
        }
        
        .timer {
            color: #dc3545;
            font-weight: 700;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-peek {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-grab {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        /* Dossier Screen */
        .dossier-header {
            background: linear-gradient(135deg, #b24bf3 0%, #9333ea 100%);
            color: white;
            padding: 10px 20px 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .lead-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 10px;
        }
        
        .lead-title {
            flex: 1;
        }
        
        .lead-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .propensity-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .quick-stats {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            font-size: 13px;
            flex-wrap: wrap;
        }
        
        .stat-pill {
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 16px;
        }
        
        .section {
            background: white;
            margin: 15px;
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .insight-text {
            font-size: 14px;
            line-height: 1.6;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .product-card {
            background: linear-gradient(135deg, #faf5ff 0%, #fff 100%);
            border: 2px solid #b24bf3;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }
        
        .product-name {
            font-weight: 600;
            color: #1a1a2e;
            font-size: 15px;
        }
        
        .product-premium {
            background: #b24bf3;
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .product-why {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .product-features {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .feature-tag {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            color: #495057;
        }
        
        .talking-point {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .objection-card {
            background: #f8d7da;
            border-left: 3px solid #dc3545;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .objection-title {
            font-weight: 600;
            color: #721c24;
            font-size: 13px;
            margin-bottom: 6px;
        }
        
        .objection-response {
            font-size: 13px;
            color: #721c24;
            line-height: 1.5;
        }
        
        .compliance-alert {
            background: #d1ecf1;
            border: 1px solid #0c5460;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #0c5460;
            line-height: 1.5;
        }
        
        /* Achievements Screen */
        .achievements-header {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #664d00;
            padding: 10px 20px 20px;
        }
        
        .achievements-title {
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
        }
        
        .achievements-content {
            padding: 20px;
        }
        
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .badge-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .badge-card:hover {
            transform: translateY(-2px);
        }
        
        .badge-card.locked {
            opacity: 0.5;
        }
        
        .badge-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }
        
        .badge-name {
            font-size: 11px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 4px;
        }
        
        .badge-progress {
            font-size: 10px;
            color: #666;
        }
        
        /* Profile Screen */
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px 30px;
        }
        
        .profile-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            margin-top: 15px;
            text-align: center;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 15px;
        }
        
        .profile-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .profile-level {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        
        .profile-stat {
            text-align: center;
        }
        
        .profile-stat-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .profile-stat-label {
            font-size: 11px;
            opacity: 0.9;
        }
        
        .profile-content {
            padding: 20px;
        }
        
        .menu-item {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .menu-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .menu-icon {
            font-size: 24px;
        }
        
        .menu-text {
            font-weight: 600;
            color: #1a1a2e;
        }
        
        /* Heat Map Styles */
        .map-container {
            width: 100%;
            height: 450px;
            background: linear-gradient(135deg, #2c2c3e 0%, #1a1a2e 100%);
            position: relative;
            overflow: hidden;
        }
        
        .map-bg {
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 40%, rgba(255,107,107,0.3) 0%, transparent 30%),
                radial-gradient(circle at 70% 30%, rgba(255,193,7,0.25) 0%, transparent 25%),
                radial-gradient(circle at 50% 70%, rgba(102,126,234,0.2) 0%, transparent 35%),
                radial-gradient(circle at 20% 80%, rgba(255,193,7,0.2) 0%, transparent 20%),
                radial-gradient(circle at 80% 75%, rgba(40,167,69,0.2) 0%, transparent 25%);
            filter: blur(40px);
        }
        
        .location-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            transform: translate(-50%, -50%);
            animation: pulse-marker 2s infinite;
        }

        .location-marker:hover .zone-hover-label {
            opacity: 1 !important;
        }
        
        .marker-dot {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
        }
        
        .hot-marker {
            background: radial-gradient(circle, #ff6b6b, #dc3545);
            box-shadow: 0 0 20px rgba(255,107,107,0.6);
        }
        
        .warm-marker {
            background: radial-gradient(circle, #ffc107, #ffb700);
            box-shadow: 0 0 20px rgba(255,193,7,0.6);
        }
        
        .cool-marker {
            background: radial-gradient(circle, #28a745, #20c997);
            box-shadow: 0 0 20px rgba(40,167,69,0.6);
        }
        
        .my-location {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #667eea;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(102,126,234,0.8);
            animation: ping 1.5s infinite;
        }
        
        .legend {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 12px;
            font-size: 11px;
            color: white;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .info-panel {
            background: #f8f9fa;
            padding: 20px;
        }
        
        .panel-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1a1a2e;
        }
        
        .region-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .region-name {
            font-weight: 600;
            font-size: 16px;
            color: #1a1a2e;
        }
        
        .surge-badge {
            background: linear-gradient(135deg, #ff6b6b, #dc3545);
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            animation: blink 1s infinite;
        }
        
        .region-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #666;
        }
        
        .stat-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .proximity-alert {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border-left: 4px solid #0c5460;
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .alert-title {
            font-weight: 600;
            color: #0c5460;
            font-size: 14px;
            margin-bottom: 6px;
        }
        
        .alert-text {
            font-size: 12px;
            color: #0c5460;
            line-height: 1.5;
        }
        
        /* Rankings Screen */
        .rankings-header {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #664d00;
            padding: 10px 20px 20px;
        }
        
        .rankings-title {
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .your-rank {
            background: rgba(255,255,255,0.3);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .rank-number {
            font-size: 32px;
            font-weight: 700;
        }
        
        .leaderboard {
            padding: 20px;
        }
        
        .agent-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .agent-rank {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            margin-right: 12px;
        }
        
        .rank-gold {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #664d00;
        }
        
        .rank-silver {
            background: linear-gradient(135deg, #c0c0c0 0%, #a8a8a8 100%);
            color: #333;
        }
        
        .rank-bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%);
            color: white;
        }
        
        .agent-info {
            flex: 1;
        }
        
        .agent-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }
        
        .agent-meta {
            font-size: 12px;
            color: #666;
        }
        
        .agent-score {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }
        
        /* Squad Screen */
        .squad-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 10px 20px 20px;
        }
        
        .squad-name {
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        
        .squad-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 13px;
        }
        
        .squad-content {
            padding: 20px;
        }
        
        .member-card {
            background: white;
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }
        
        .member-status {
            font-size: 12px;
            color: #28a745;
        }
        
        /* Challenges Screen */
        .challenges-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 10px 20px 20px;
        }
        
        .challenges-title {
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .challenges-content {
            padding: 20px;
        }
        
        .challenge-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid #dc3545;
        }
        
        .challenge-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            color: #1a1a2e;
        }
        
        .challenge-progress {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .challenge-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .challenge-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
            transition: width 0.3s ease;
        }
        
        .challenge-reward {
            font-size: 12px;
            color: #28a745;
            font-weight: 600;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            align-items: center;
            padding: 10px 5px;
            gap: 5px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }

        .bottom-nav::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .bottom-nav::after {
            content: '→';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(90deg, transparent, white 30%);
            padding: 0 15px;
            font-size: 16px;
            color: #667eea;
            pointer-events: none;
            animation: slideHint 2s infinite;
        }

        @keyframes slideHint {
            0%, 100% { opacity: 0.5; transform: translateY(-50%) translateX(0); }
            50% { opacity: 1; transform: translateY(-50%) translateX(3px); }
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: #6c757d;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 70px;
            flex-shrink: 0;
            padding: 5px;
        }
        
        .nav-item:hover {
            transform: scale(1.05);
        }
        
        .nav-item.active {
            color: #667eea;
        }
        
        .nav-icon {
            font-size: 24px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
            }
        }
        
        @keyframes pulse-marker {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
        }
        
        @keyframes ping {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
        }
        
        @keyframes blink {
            0%, 50%, 100% {
                opacity: 1;
            }
            25%, 75% {
                opacity: 0.7;
            }
        }
        
        .toast {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideDown 0.3s ease;
            display: none;
        }
        
        .toast.show {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        .floating-menu {
            position: absolute;
            bottom: 90px;
            right: 20px;
            z-index: 50;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s;
        }
        
        .fab:hover {
            transform: scale(1.1);
        }

        /* Megatron Chat Modal */
        .megatron-chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .megatron-chat-overlay.active {
            display: flex;
        }

        .megatron-chat-container {
            width: 90%;
            max-width: 350px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .megatron-chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .megatron-chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .megatron-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .megatron-chat-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 1;
        }

        .megatron-chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .megatron-message {
            margin-bottom: 15px;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .megatron-message.bot {
            display: flex;
            gap: 8px;
        }

        .megatron-message.bot .message-avatar {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .megatron-message.bot .message-bubble {
            background: white;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .megatron-message.user {
            display: flex;
            justify-content: flex-end;
        }

        .megatron-message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .megatron-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .suggestion-chip {
            background: #e9ecef;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .megatron-chat-footer {
            padding: 15px;
            background: white;
            border-radius: 0 0 20px 20px;
            border-top: 1px solid #e9ecef;
        }

        .megatron-input-container {
            display: flex;
            gap: 8px;
        }

        .megatron-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }

        .megatron-input:focus {
            border-color: #667eea;
        }

        .megatron-send-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #666;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-8px);
            }
        }

        /* News Hub Styles */
        .news-header {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 10px 20px 20px;
        }

        .news-title {
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .news-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .news-filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .filter-chip {
            padding: 8px 16px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border-color: #17a2b8;
        }

        .news-content {
            padding: 15px 20px;
        }

        .news-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s;
            border-left: 4px solid #17a2b8;
        }

        .news-card:hover {
            transform: translateY(-2px);
        }

        .news-card.trending {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
        }

        .news-card.competitor {
            border-left-color: #ffc107;
        }

        .news-card.regulation {
            border-left-color: #0066cc;
        }

        .news-source {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .source-badge {
            background: #e9ecef;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            color: #495057;
        }

        .source-badge.verified {
            background: #d1ecf1;
            color: #0c5460;
        }

        .news-time {
            font-size: 11px;
            color: #999;
        }

        .news-headline {
            font-size: 16px;
            font-weight: 700;
            color: #1a1a2e;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .news-summary {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .news-impact {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .impact-title {
            font-size: 11px;
            font-weight: 700;
            color: #856404;
            margin-bottom: 4px;
        }

        .impact-text {
            font-size: 12px;
            color: #856404;
            line-height: 1.5;
        }

        .news-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .news-tag {
            background: #f8f9fa;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            color: #666;
        }

        .news-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .news-action-btn {
            flex: 1;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .news-action-btn:hover {
            background: #e9ecef;
        }

        .trending-badge {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            animation: blink 2s infinite;
        }

        /* Squad Chat Styles */
        .chat-tab-container {
            display: flex;
            gap: 0;
            background: #f8f9fa;
            padding: 10px 20px 0;
            border-bottom: 2px solid #dee2e6;
        }

        .chat-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .chat-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 160px);
            background: #f8f9fa;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: messageSlideIn 0.3s ease;
        }

        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
        }

        .message-header {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 4px;
            font-size: 11px;
        }

        .message.own .message-header {
            flex-direction: row-reverse;
        }

        .message-sender {
            font-weight: 600;
            color: #1a1a2e;
        }

        .message-time {
            color: #999;
        }

        .message-bubble {
            background: white;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message-special {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            padding: 12px;
            border-radius: 12px;
            font-size: 13px;
        }

        .message-special-title {
            font-weight: 700;
            color: #856404;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .message-special-content {
            color: #856404;
        }

        .message-action {
            background: #d1ecf1;
            border-left: 3px solid #17a2b8;
            padding: 12px;
            border-radius: 12px;
            font-size: 13px;
            color: #0c5460;
        }

        .chat-input-container {
            background: white;
            border-top: 1px solid #dee2e6;
            padding: 12px;
        }

        .chat-quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .quick-action-btn {
            padding: 6px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action-btn:hover {
            background: #e9ecef;
            transform: scale(1.05);
        }

        .chat-input-box {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }

        .chat-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 16px;
            width: fit-content;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        /* Squad News Feed Styles */
        .squad-news-item {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #17a2b8;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .squad-news-item:hover {
            transform: translateX(4px);
        }

        .squad-news-item.new {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
        }

        .squad-news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .squad-news-sharer {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #666;
        }

        .squad-news-badge {
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
        }

        .squad-news-title {
            font-size: 14px;
            font-weight: 700;
            color: #1a1a2e;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .squad-news-impact {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .squad-news-meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: #999;
        }

        .squad-news-empty {
            text-align: center;
            padding: 30px 20px;
            color: #999;
        }

        /* Dossier News Selector Styles */
        .dossier-news-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dossier-news-item:hover {
            border-color: #17a2b8;
            background: #f8f9fa;
        }

        .dossier-news-item.selected {
            border-color: #17a2b8;
            background: #d1ecf1;
        }

        .dossier-news-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .dossier-news-item.selected .dossier-news-checkbox {
            background: #17a2b8;
            border-color: #17a2b8;
            color: white;
        }

        .dossier-news-info {
            flex: 1;
        }

        .dossier-news-headline {
            font-size: 13px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .dossier-news-source {
            font-size: 11px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="toast" id="toast"></div>

    <!-- Megatron Chat Modal -->
    <div class="megatron-chat-overlay" id="megatron-chat-overlay">
        <div class="megatron-chat-container">
            <div class="megatron-chat-header">
                <div class="megatron-chat-title">
                    <div class="megatron-avatar">🤖</div>
                    <div>
                        <div style="font-weight: 700; font-size: 16px;">Megatron AI</div>
                        <div style="font-size: 11px; opacity: 0.9;">Always here to help</div>
                    </div>
                </div>
                <button class="megatron-chat-close" onclick="closeMegatronChat()">×</button>
            </div>

            <div class="megatron-chat-body" id="megatron-chat-body">
                <!-- Messages will be inserted here -->
            </div>

            <div class="megatron-chat-footer">
                <div class="megatron-input-container">
                    <input
                        type="text"
                        class="megatron-input"
                        id="megatron-input"
                        placeholder="Ask me anything..."
                        onkeypress="if(event.key==='Enter') sendMegatronMessage()"
                    >
                    <button class="megatron-send-btn" onclick="sendMegatronMessage()">➤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Peek Confirmation Modal -->
    <div class="megatron-chat-overlay" id="peek-confirm-overlay">
        <div class="megatron-chat-container" style="max-width: 340px;">
            <div style="padding: 24px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 12px;">👁️</div>
                    <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">Peek at Lead?</div>
                    <div style="font-size: 13px; color: #666;">View full dossier before deciding</div>
                </div>

                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Peek Cost:</span>
                        <span style="font-weight: 700; font-size: 16px;" id="peek-cost">50 points</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Your Balance:</span>
                        <span style="font-weight: 700;" id="peek-balance">1,240 points</span>
                    </div>
                    <div style="border-top: 1px solid #dee2e6; padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #666;">After Peek:</span>
                            <span style="font-weight: 700; color: #28a745;" id="peek-after">1,190 points</span>
                        </div>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 3px solid #ffc107;">
                    <div style="font-size: 12px; color: #856404; line-height: 1.5;">
                        <strong>💡 Peek Benefits:</strong><br>
                        • 60-second full dossier preview<br>
                        • AI insights & conversation starters<br>
                        • 50% refund if grabbed & converted
                    </div>
                </div>

                <div style="display: flex; gap: 8px;">
                    <button onclick="cancelPeek()" style="flex: 1; padding: 14px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-weight: 600; cursor: pointer;">Cancel</button>
                    <button onclick="confirmPeek()" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">👁️ Peek Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone Detail Modal -->
    <div class="megatron-chat-overlay" id="zone-detail-overlay">
        <div class="megatron-chat-container" style="max-width: 360px; max-height: 600px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; color: white; border-radius: 16px 16px 0 0;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;" id="zone-name">Tampines</div>
                        <div style="font-size: 13px; opacity: 0.9;" id="zone-distance">2.1km away</div>
                    </div>
                    <button onclick="closeZoneDetail()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; width: 32px; height: 32px; border-radius: 50%; cursor: pointer;">×</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.9;">Surge</div>
                        <div style="font-size: 18px; font-weight: 700;" id="zone-surge">2×</div>
                    </div>
                    <div style="flex: 1; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.9;">Leads</div>
                        <div style="font-size: 18px; font-weight: 700;" id="zone-leads">18</div>
                    </div>
                    <div style="flex: 1; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; opacity: 0.9;">Time Left</div>
                        <div style="font-size: 16px; font-weight: 700;" id="zone-timer">45m</div>
                    </div>
                </div>
            </div>

            <div style="padding: 15px; max-height: 380px; overflow-y: auto; background: #f8f9fa;">
                <div style="font-weight: 600; font-size: 14px; margin-bottom: 12px; color: #333;">Available Leads in Zone</div>

                <div id="zone-leads-list">
                    <!-- Leads will be inserted here -->
                </div>

                <div style="background: white; padding: 14px; border-radius: 12px; margin-top: 15px;">
                    <div style="font-weight: 600; font-size: 13px; margin-bottom: 10px;">📊 Zone Stats</div>
                    <div style="font-size: 12px; line-height: 1.8; color: #666;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span>💎 Diamond Leads:</span>
                            <span style="font-weight: 600; color: #667eea;">8 leads</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span>🥇 Gold Leads:</span>
                            <span style="font-weight: 600; color: #ffc107;">10 leads</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Avg. Propensity:</span>
                            <span style="font-weight: 600; color: #28a745;">87%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="padding: 15px; background: white; border-top: 2px solid #e9ecef; border-radius: 0 0 16px 16px;">
                <button onclick="grabAllInZone()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; box-shadow: 0 4px 12px rgba(40,167,69,0.3);">
                    ⚡ GRAB ALL LEADS IN ZONE
                </button>
            </div>
        </div>
    </div>

    <div class="phone-frame">
        <div class="status-bar">
            <span>9:41</span>
            <span>⚡ 87%</span>
        </div>

        <!-- HOME SCREEN -->
        <div class="screen active" id="home-screen">
            <div class="header">
                <div class="greeting">Good Morning, Kartik! 👋</div>
                <span class="agent-level">⭐ Expert Tier</span>
                
                <div class="stats-row">
                    <div class="stat">🔥 12 DAYS</div>
                    <div class="stat">⭐ 4.8</div>
                    <div class="stat">💰 $680 Today</div>
                </div>
            </div>
            
            <div class="progress-section">
                <div class="progress-label">Progress to Master Tier: 78%</div>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
            
            <div class="section-header">
                ⚡ LIVE LEAD MARKETPLACE
            </div>
            <div class="section-divider"></div>
            
            <!-- Live Chat Alert -->
            <div onclick="openLiveChat()" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); margin: 0 20px 15px; padding: 16px; border-radius: 16px; cursor: pointer; color: white; box-shadow: 0 4px 12px rgba(23,162,184,0.3); animation: pulse 2s infinite;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">💬 Live Chat Queue</div>
                        <div style="font-size: 13px; opacity: 0.9;">3 customers waiting • Tap to view</div>
                    </div>
                    <div style="background: #dc3545; padding: 8px 14px; border-radius: 50%; font-weight: 700; font-size: 16px;">3</div>
                </div>
            </div>
            
            <div class="lead-card diamond" onclick="viewDossier('chen-wei')">
                <div class="tier-badge diamond-badge">💎 DIAMOND - 3X</div>
                <div class="lead-name">Chen Wei</div>
                <div class="lead-info">38 years • Health + Investment</div>
                
                <div class="lead-meta">
                    <div class="meta-item">📍 2.1km • Tampines</div>
                </div>
                
                <div class="hot-indicator">
                    🔥 HOT: 94% • ⏱️ <span class="timer">28s</span> remaining
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-peek" onclick="event.stopPropagation(); peekLead()">👁️ PEEK 50pts</button>
                    <button class="btn btn-grab" onclick="event.stopPropagation(); grabLead('Chen Wei')">⚡ GRAB NOW!</button>
                </div>
            </div>
            
            <div class="lead-card gold" onclick="viewDossier('sarah-tan')">
                <div class="tier-badge gold-badge">🥇 GOLD - 2X</div>
                <div class="lead-name">Sarah Tan</div>
                <div class="lead-info">34 years • Family Protection</div>
                
                <div class="lead-meta">
                    <div class="meta-item">📍 4.2km • Bedok</div>
                </div>
                
                <div class="hot-indicator">
                    🔥 WARM: 82% • ⏱️ <span class="timer">45s</span> remaining
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-peek" onclick="event.stopPropagation(); peekLead()">👁️ PEEK 50pts</button>
                    <button class="btn btn-grab" onclick="event.stopPropagation(); grabLead('Sarah Tan')">⚡ GRAB NOW!</button>
                </div>
            </div>
        </div>

        <!-- PEEK PREVIEW SCREEN -->
        <div class="screen" id="peek-preview-screen">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="font-size: 16px; font-weight: 700;">👁️ Lead Peek Preview</div>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 14px; border-radius: 20px; font-weight: 700; font-size: 14px;">
                        ⏱️ <span id="peek-countdown">60</span>s
                    </div>
                </div>
                <div style="font-size: 12px; opacity: 0.9;">Make your decision before time runs out!</div>
            </div>

            <div style="padding: 15px; overflow-y: auto; height: calc(100% - 220px); background: #f8f9fa;">
                <!-- Lead Header -->
                <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;" id="peek-lead-name">Chen Wei</div>
                            <div style="font-size: 13px; color: #666;">38 years • Investment Banking</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600;">
                            💎 DIAMOND
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <div style="flex: 1; background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 11px; color: #666;">Propensity</div>
                            <div style="font-size: 18px; font-weight: 700; color: #28a745;">94%</div>
                        </div>
                        <div style="flex: 1; background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 11px; color: #666;">Income</div>
                            <div style="font-size: 16px; font-weight: 700;">$15K/mo</div>
                        </div>
                        <div style="flex: 1; background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 11px; color: #666;">Distance</div>
                            <div style="font-size: 16px; font-weight: 700;">2.1km</div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div style="background: #fff3cd; padding: 14px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px; color: #856404;">🤖 AI Strategic Insights</div>
                    <div style="font-size: 12px; color: #856404; line-height: 1.6;">
                        <strong>High conversion probability.</strong> Investment banker profile shows strong financial literacy. Prime candidate for ILP with tax optimization angle. Low objection risk due to income level and career stage.
                    </div>
                </div>

                <!-- Conversation Starters -->
                <div style="background: white; padding: 14px; border-radius: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 10px;">💬 Suggested Openers</div>
                    <div style="background: #e7f5ff; padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 12px; line-height: 1.5;">
                        "Hi Chen Wei! With your banking background, you'll appreciate our WealthBuilder ILP's tax-deferred growth + life coverage combo..."
                    </div>
                    <div style="background: #e7f5ff; padding: 10px; border-radius: 8px; font-size: 12px; line-height: 1.5;">
                        "Investment + protection in one vehicle? Let me show you how $1,200/mo becomes $933 after tax relief..."
                    </div>
                </div>

                <!-- Predicted Objections -->
                <div style="background: white; padding: 14px; border-radius: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 10px;">⚠️ Predicted Objections</div>
                    <div style="font-size: 12px; margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #dc3545; margin-bottom: 4px;">1. "I can invest myself"</div>
                        <div style="color: #666; padding-left: 12px;">→ Highlight tax efficiency + forced discipline + life coverage combo</div>
                    </div>
                    <div style="font-size: 12px;">
                        <div style="font-weight: 600; color: #dc3545; margin-bottom: 4px;">2. "Let me think about it"</div>
                        <div style="color: #666; padding-left: 12px;">→ Age factor: premiums increase 3-5% yearly. Lock rate now.</div>
                    </div>
                </div>

                <!-- Time to Close -->
                <div style="background: white; padding: 14px; border-radius: 12px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Est. Time to Close</div>
                            <div style="font-size: 20px; font-weight: 700; color: #28a745;">7-10 days</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Similar Leads</div>
                            <div style="font-size: 16px; font-weight: 700;">85% closed</div>
                        </div>
                    </div>
                </div>

                <!-- Product Affinity -->
                <div style="background: white; padding: 14px; border-radius: 12px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 10px;">📊 Product Affinity</div>
                    <div style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                            <span>WealthBuilder Plus ILP</span>
                            <span style="font-weight: 600; color: #28a745;">92%</span>
                        </div>
                        <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; width: 92%;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                            <span>Critical Illness</span>
                            <span style="font-weight: 600;">78%</span>
                        </div>
                        <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 78%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decision Buttons -->
            <div style="position: absolute; bottom: 80px; left: 0; right: 0; background: white; padding: 15px; border-top: 2px solid #e9ecef; z-index: 100;">
                <div style="display: flex; gap: 10px;">
                    <button onclick="passAfterPeek()" style="flex: 1; padding: 16px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; font-weight: 600; font-size: 15px; cursor: pointer;">
                        ← Pass
                    </button>
                    <button onclick="grabAfterPeek()" style="flex: 2; padding: 16px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; box-shadow: 0 4px 12px rgba(40,167,69,0.3);">
                        ⚡ GRAB LEAD!
                    </button>
                </div>
            </div>
        </div>

        <!-- DOSSIER SCREEN - CHEN WEI -->
        <div class="screen" id="dossier-chen-wei">
            <div class="dossier-header">
                <button class="back-button" onclick="switchScreen('home')">← Back</button>
                <div class="lead-header">
                    <div class="lead-title">
                        <div class="lead-name">Chen Wei</div>
                        <div class="lead-subtitle">38 years • Investment Banking</div>
                    </div>
                    <div class="propensity-badge">94%</div>
                </div>
                <div class="quick-stats">
                    <div class="stat-pill">💎 Diamond</div>
                    <div class="stat-pill">📍 2.1km</div>
                    <div class="stat-pill">$15K/mo</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    🎯 AI Intent Analysis
                    <span class="ai-badge">POWERED BY AI</span>
                </div>
                <div class="insight-text">
                    <strong>Primary Need:</strong> Wealth accumulation and investment-linked policies
                </div>
                <div class="insight-text">
                    <strong>Life Stage:</strong> Mid-career professional with strong income. Recently married, planning for family. High disposable income.
                </div>
                <div class="insight-text">
                    <strong>Digital Behavior:</strong> Spent 18 minutes comparing investment-linked plans. Downloaded wealth accumulation guide. Researched premium hospital coverage.
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    📰 Market Context & News
                    <span class="ai-badge">REAL-TIME</span>
                </div>
                <div class="insight-text" style="margin-bottom: 12px;">
                    Select relevant news to enhance this conversation with market insights
                </div>
                <div id="dossier-news-selector-chen-wei" style="margin-bottom: 15px;">
                    <!-- News items will be inserted here -->
                </div>
                <div id="dossier-selected-news-chen-wei" style="display: none;">
                    <div style="background: #d1ecf1; border-left: 3px solid #17a2b8; padding: 12px; border-radius: 8px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #0c5460; margin-bottom: 8px;">💡 How to Use This News:</div>
                        <div id="dossier-news-context-chen-wei" style="font-size: 13px; color: #0c5460; line-height: 1.6;">
                            <!-- Context will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    💡 Recommended Product Stack
                    <span class="ai-badge">FROM MEGATRON</span>
                </div>
                
                <!-- PRIMARY PRODUCT -->
                <div class="product-card" style="border: 3px solid #b24bf3;">
                    <div style="background: #b24bf3; color: white; padding: 8px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 13px;">
                        ⭐ PRIMARY RECOMMENDATION
                    </div>
                    
                    <div class="product-header">
                        <div class="product-name">WealthBuilder Plus ILP</div>
                        <div class="product-premium">$1,200/mo</div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 12px 0;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">🎯 Why This Product for Chen Wei:</div>
                        <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                            As an investment banker earning $15K/month with no dependents yet, Chen Wei is in the perfect wealth accumulation phase. This ILP combines insurance protection with investment growth, maximizing his disposable income while building long-term wealth. His financial literacy means he'll appreciate the fund flexibility and transparency.
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">📊 Your Customized Pitch:</div>
                        <div class="talking-point" style="margin-bottom: 8px;">
                            <strong>Opening:</strong> "Chen Wei, with your banking background, you understand the time value of money. This ILP lets you capture 20-30 years of compound growth while locking in insurability now—before life events or health changes make coverage more expensive."
                        </div>
                        <div class="talking-point" style="margin-bottom: 8px;">
                            <strong>Value Proposition:</strong> "Think of it as dollar-cost averaging into markets with built-in life coverage. Your $1,200/month grows tax-deferred, you get $7K annual tax relief, and if anything happens, your family receives the higher of sum assured or fund value."
                        </div>
                        <div class="talking-point">
                            <strong>ROI Framework:</strong> "At 6% average returns over 20 years, your $288K contributions could grow to $550K+. Plus, your effective cost is just $933/month after tax relief—that's less than 7% of your gross income for comprehensive wealth and protection."
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">📋 Coverage Details:</div>
                        <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                            <div>• <strong>Sum Assured:</strong> $500,000 (or fund value if higher)</div>
                            <div>• <strong>Death Benefit:</strong> 105% of premiums paid or fund value</div>
                            <div>• <strong>Total Permanent Disability:</strong> Full sum assured + premium waiver</div>
                            <div>• <strong>Critical Illness (CI):</strong> 100% sum assured (accelerated benefit)</div>
                            <div>• <strong>Policy Term:</strong> To age 65 with flexible premium payment (10/15/20 years)</div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">🎁 Recommended Riders:</div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Early Critical Illness Rider (+$45/mo)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> Covers Stage 1 cancers and early conditions. Banking sector stress makes this crucial. Pays $100K on diagnosis—allows you to focus on recovery without financial stress.
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Accidental Death & Dismemberment (+$25/mo)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> Additional $500K payout for accidents. Cost-effective for young professionals. Covers loss of limbs/sight with lump sum payments.
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Premium Waiver for CI/TPD (Included)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> If you're diagnosed with CI or TPD, all future premiums are waived but policy continues. Essential protection against premium payment inability.
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 12px;">
                            <strong>Total with Riders:</strong> $1,270/month • <strong>After Tax Relief:</strong> ~$1,003/month
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">💰 Investment Strategy:</div>
                        <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                            <strong>Recommended Fund Allocation (Based on Age 38, 27-year horizon):</strong>
                            <div style="margin: 10px 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span>Growth Funds (Equity)</span>
                                    <strong>60%</strong>
                                </div>
                                <div style="height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                    <div style="width: 60%; height: 100%; background: #28a745;"></div>
                                </div>
                            </div>
                            <div style="margin: 10px 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span>Balanced Funds (Mixed)</span>
                                    <strong>30%</strong>
                                </div>
                                <div style="height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                    <div style="width: 30%; height: 100%; background: #ffc107;"></div>
                                </div>
                            </div>
                            <div style="margin: 10px 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span>Fixed Income (Bonds)</span>
                                    <strong>10%</strong>
                                </div>
                                <div style="height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                    <div style="width: 10%; height: 100%; background: #17a2b8;"></div>
                                </div>
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                <strong>Rationale:</strong> Aggressive growth allocation leverages your long time horizon and risk tolerance. Can rebalance automatically or manually. Free fund switching quarterly.
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">📈 Projected Performance:</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Assuming 6% average annual returns:</div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px;">
                                <span>Year 10:</span>
                                <strong style="color: #28a745;">~$200K</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px;">
                                <span>Year 20:</span>
                                <strong style="color: #28a745;">~$550K</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                <span>At Age 65:</span>
                                <strong style="color: #28a745;">~$1.2M</strong>
                            </div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6; font-size: 11px; color: #666;">
                                *Projections based on historical market performance. Actual returns may vary. Insurance charges and fund management fees deducted.
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">🛡️ Key Competitive Advantages:</div>
                        <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                            <div style="margin-bottom: 6px;">✓ <strong>Fund Flexibility:</strong> 100 funds vs 30-50 from competitors</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Lower Charges:</strong> 1.2% p.a. vs industry avg 1.5-1.8%</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Partial Withdrawals:</strong> From year 3 onwards (competitors: year 5)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Free Fund Switches:</strong> 4 per year (competitors: 2-3)</div>
                            <div>✓ <strong>Premium Holiday:</strong> After year 3 if fund value sufficient</div>
                        </div>
                    </div>
                    
                    <div style="background: #d1ecf1; border: 1px solid #0c5460; padding: 12px; border-radius: 8px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #0c5460; margin-bottom: 6px;">⚖️ Required Compliance Disclosures:</div>
                        <div style="font-size: 11px; color: #0c5460; line-height: 1.5;">
                            • Financial Needs Analysis (FNA) required before policy issuance<br>
                            • Investment returns not guaranteed; may be lower than projected<br>
                            • Early termination may result in surrender charges (years 1-10)<br>
                            • 14-day free look period from policy receipt<br>
                            • Must disclose all material facts for underwriting
                        </div>
                    </div>
                </div>
                
                <!-- SECONDARY PRODUCT -->
                <div class="product-card" style="margin-top: 15px;">
                    <div style="background: #ffc107; color: #664d00; padding: 6px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 12px;">
                        🏥 COMPLEMENTARY: HEALTH PROTECTION
                    </div>
                    
                    <div class="product-header">
                        <div class="product-name">PrivateShield Premier</div>
                        <div class="product-premium">$350/mo</div>
                    </div>
                    
                    <div class="product-why">
                        <strong>Why Add This:</strong> ILP covers death/CI, but hospitalization needs separate coverage. As a banking executive, private hospital access ensures minimal work disruption. No co-payment means zero out-of-pocket costs.
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 13px; line-height: 1.6; color: #495057;">
                        <strong>Coverage:</strong> Private/A1 ward • Unlimited lifetime coverage • Pre/post hospitalization • Day surgery • Emergency overseas treatment
                    </div>
                    
                    <div class="product-features">
                        <div class="feature-tag">Private Hospital</div>
                        <div class="feature-tag">No Co-Pay</div>
                        <div class="feature-tag">Unlimited Lifetime</div>
                    </div>
                </div>
                
                <!-- PRODUCT SELECTOR -->
                <div style="margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px;">🤖 Try Different Products</div>
                    <div style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">
                        Want to explore alternatives? Select a product category:
                    </div>
                    <button onclick="openProductSelector('chen')" style="width: 100%; padding: 12px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        🔍 Browse Alternative Products
                    </button>
                </div>
                
                <!-- ASK MEGATRON -->
                <div style="margin: 20px 0; padding: 16px; background: white; border: 2px solid #667eea; border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px; color: #667eea;">💬 Ask Megatron Anything</div>
                    <div style="font-size: 13px; margin-bottom: 12px; color: #666;">
                        Get instant answers about products, pricing, or sales strategies for this lead.
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="megatron-chen" placeholder="e.g., Compare with WealthMax ILP..." style="flex: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 13px;" onkeypress="if(event.key==='Enter') askMegatronChen()">
                        <button onclick="askMegatronChen()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Ask</button>
                    </div>
                    <div style="margin-top: 10px; display: flex; flex-wrap: gap: 6px;">
                        <button onclick="quickAskChen('compare')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Compare alternatives</button>
                        <button onclick="quickAskChen('riders')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Other rider options</button>
                        <button onclick="quickAskChen('objections')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Handle "too expensive"</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">💬 Opening Lines</div>
                <div class="talking-point">
                    "Hi Chen Wei! I noticed you're researching investment options. With your banking background, you'll appreciate our ILP's flexibility with 100 fund choices and competitive 1.2% management fees—significantly lower than the industry average."
                </div>
            </div>

            <!-- INTERACTIVE FEATURES -->
            <div class="section">
                <div style="margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px;">🎭 Practice Your Pitch</div>
                    <div style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">
                        Role-play the conversation with Chen Wei. Get real-time coaching.
                    </div>
                    <button onclick="openConversationPractice('chen')" style="width: 100%; padding: 12px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        🎬 Start Conversation Practice
                    </button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">⚠️ Predicted Objections</div>
                
                <div class="objection-card">
                    <div class="objection-title">"I can invest on my own"</div>
                    <div class="objection-response">
                        <strong>Response:</strong> "Absolutely! But here's the advantage: ILPs combine tax-deferred growth with life protection. You're essentially getting insurance coverage at cost while your investments grow. Plus, the $7K annual tax relief effectively subsidizes your premiums. Think of it as a diversification strategy with downside protection."
                    </div>
                </div>
                
                <div class="objection-card">
                    <div class="objection-title">"The charges seem high"</div>
                    <div class="objection-response">
                        <strong>Response:</strong> "Let me break it down: Our 1.2% annual management fee is 30-40% lower than competitors. Insurance charges decrease over time as you age into the policy. After year 10, your net charges drop to under 1% total. Compare that to robo-advisors at 0.5-0.8% but with zero insurance coverage."
                    </div>
                </div>
            </div>
            
            <div style="padding: 15px;">
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="startCall('Chen Wei')">📞 CALL NOW</button>
                <button class="btn btn-secondary" style="width: 100%;" onclick="openConversationPractice('chen')">🎬 Practice Pitch First</button>
            </div>

            <div style="height: 20px;"></div>
        </div>

        <!-- DOSSIER SCREEN - SARAH TAN -->
        <div class="screen" id="dossier-sarah-tan">
            <div class="dossier-header">
                <button class="back-button" onclick="switchScreen('home')">← Back</button>
                <div class="lead-header">
                    <div class="lead-title">
                        <div class="lead-name">Sarah Tan</div>
                        <div class="lead-subtitle">34 years • Mother of 2</div>
                    </div>
                    <div class="propensity-badge">82%</div>
                </div>
                <div class="quick-stats">
                    <div class="stat-pill">🥇 Gold</div>
                    <div class="stat-pill">📍 4.2km</div>
                    <div class="stat-pill">$8K/mo</div>
                    <div class="stat-pill">2 Children</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    🎯 AI Intent Analysis
                    <span class="ai-badge">POWERED BY AI</span>
                </div>
                <div class="insight-text">
                    <strong>Primary Need:</strong> Family protection and children's healthcare coverage
                </div>
                <div class="insight-text">
                    <strong>Life Stage:</strong> Young family with two children (ages 4 and 7). Recently moved to 4-room HDB in Bedok. Husband works in tech ($6K/mo). Combined income $14K. Managing mortgage of $2,200/month.
                </div>
                <div class="insight-text">
                    <strong>Key Concerns:</strong> Children's medical expenses, family income protection if something happens to either parent, rising healthcare costs, children's education fund.
                </div>
                <div class="insight-text">
                    <strong>Digital Behavior:</strong> Spent 22 minutes on family health insurance comparison page. Downloaded guides: "Protecting Your Young Family" and "Child Critical Illness Coverage". Searched for pediatric coverage and maternity benefits. Visited competitor sites 3 times in past week.
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    📰 Market Context & News
                    <span class="ai-badge">REAL-TIME</span>
                </div>
                <div class="insight-text" style="margin-bottom: 12px;">
                    Select relevant news to enhance this conversation with market insights
                </div>
                <div id="dossier-news-selector-sarah-tan" style="margin-bottom: 15px;">
                    <!-- News items will be inserted here -->
                </div>
                <div id="dossier-selected-news-sarah-tan" style="display: none;">
                    <div style="background: #d1ecf1; border-left: 3px solid #17a2b8; padding: 12px; border-radius: 8px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #0c5460; margin-bottom: 8px;">💡 How to Use This News:</div>
                        <div id="dossier-news-context-sarah-tan" style="font-size: 13px; color: #0c5460; line-height: 1.6;">
                            <!-- Context will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    💡 Recommended Product Stack
                    <span class="ai-badge">FROM MEGATRON</span>
                </div>
                
                <!-- PRIMARY PRODUCT -->
                <div class="product-card" style="border: 3px solid #b24bf3;">
                    <div style="background: #b24bf3; color: white; padding: 8px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 13px;">
                        ⭐ PRIMARY RECOMMENDATION
                    </div>
                    
                    <div class="product-header">
                        <div class="product-name">HealthShield Gold Plus (Family Plan)</div>
                        <div class="product-premium">$450/mo</div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 12px 0;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">🎯 Why This Product for Sarah's Family:</div>
                        <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                            With two young children (4 & 7), medical costs are Sarah's biggest concern. Kids get sick often - from dengue to hand-foot-mouth disease. This family plan covers all 4 members under ONE policy at better rates than individual plans. It includes comprehensive pediatric care, covers pre-existing conditions after waiting period, and has no lifetime limit - critical as healthcare inflation runs at 8-10% annually in Singapore.
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">📊 Your Customized Pitch:</div>
                        <div class="talking-point" style="margin-bottom: 8px;">
                            <strong>Opening:</strong> "Sarah, as a mother of two young kids, you know how quickly medical bills add up. Last year alone, average family spent $4,800 on healthcare. This plan ensures you never have to choose between your child's health and your family's finances."
                        </div>
                        <div class="talking-point" style="margin-bottom: 8px;">
                            <strong>Value Proposition:</strong> "For $450/month - that's $112.50 per family member - you get unlimited hospitalization coverage with ZERO co-payment. Compare that to one serious illness which could easily cost $30K-$50K out of pocket without insurance. It pays for itself with just one hospitalization."
                        </div>
                        <div class="talking-point">
                            <strong>Peace of Mind Angle:</strong> "Imagine your daughter needs surgery tomorrow. With this plan, you walk into any private hospital - Mount E, Raffles, Gleneagles - show your card, and walk out paying nothing. No stress about bills when you should be focusing on your child's recovery."
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">👨‍👩‍👧‍👦 Family Coverage Details:</div>
                        <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                            <div>• <strong>Insured Members:</strong> Sarah (34), Husband (36), Daughter (7), Son (4)</div>
                            <div>• <strong>Ward Class:</strong> Private/A1 ward at any hospital</div>
                            <div>• <strong>Annual Claim Limit:</strong> Unlimited (no sub-limits)</div>
                            <div>• <strong>Lifetime Limit:</strong> Unlimited</div>
                            <div>• <strong>Pre/Post Hospitalization:</strong> 90 days pre, 180 days post</div>
                            <div>• <strong>Day Surgery:</strong> Fully covered (no hospitalization needed)</div>
                            <div>• <strong>Emergency Treatment:</strong> Including overseas emergencies</div>
                            <div>• <strong>Ambulance:</strong> Unlimited claims</div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">👶 Pediatric-Specific Benefits:</div>
                        <div style="background: #e7f3ff; padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.6; color: #495057;">
                            <div style="margin-bottom: 6px;">✓ <strong>Newborn Coverage:</strong> From day 1 (competitors: 30 days)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Vaccinations:</strong> All recommended childhood vaccines covered</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Developmental Screenings:</strong> Annual health assessments included</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Congenital Conditions:</strong> Covered after 12-month waiting period</div>
                            <div>✓ <strong>Pediatric ICU:</strong> Full coverage including neonatal ICU</div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">🎁 Recommended Riders:</div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Maternity Coverage Rider (+$80/mo)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> Planning for child #3? Covers normal delivery ($8K-$12K) and C-section ($15K-$20K) at private hospitals. Pre/post-natal care included. Complications fully covered. No age limit for adding rider.
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Children Critical Illness Booster (+$65/mo)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> Covers 37 childhood critical illnesses including leukemia (most common childhood cancer). Pays $100K lump sum per child on diagnosis. Use for treatment, therapy, or parent to take unpaid leave. Statistically, 1 in 300 kids diagnosed with cancer before age 18.
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; border-left: 3px solid #0066cc; padding: 10px; border-radius: 6px;">
                            <div style="font-weight: 600; color: #0066cc; margin-bottom: 4px;">Dental & Optical Rider (+$45/mo)</div>
                            <div style="font-size: 12px; color: #495057; line-height: 1.5;">
                                <strong>Why:</strong> Kids need braces ($5K-$8K), annual dental checkups, glasses as they grow. Covers up to $2K per family member annually. Includes orthodontics, wisdom tooth extraction, prescription glasses/contacts.
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 12px;">
                            <strong>Total with All Riders:</strong> $640/month • <strong>Per Person:</strong> $160/month • <strong>% of Income:</strong> 8% (recommended: 7-10%)
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">💰 Cost-Benefit Analysis:</div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 13px; margin-bottom: 10px; color: #495057;">
                                <strong>Without Insurance (Typical Scenarios):</strong>
                            </div>
                            <div style="font-size: 12px; line-height: 1.8; color: #666;">
                                <div>• Child's dengue hospitalization (5 days): $8,000 - $12,000</div>
                                <div>• Appendicitis surgery: $15,000 - $20,000</div>
                                <div>• Pneumonia ICU stay: $25,000 - $35,000</div>
                                <div>• Broken arm surgery: $8,000 - $10,000</div>
                                <div>• Cancer treatment (1st year): $80,000 - $150,000</div>
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #dee2e6; font-weight: 600; color: #dc3545;">
                                One serious illness = 2-3 years of premiums. The question isn't "Can I afford insurance?" It's "Can I afford NOT to have it?"
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">🆚 Why Choose Us Over Competitors:</div>
                        <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                            <div style="margin-bottom: 6px;">✓ <strong>Family Discount:</strong> 15% vs 10% (competitors)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>No Co-Payment:</strong> 0% vs 5-10% (competitors)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Guaranteed Renewal:</strong> Lifetime vs age 75 limit (competitors)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Pre-existing Waiting:</strong> 12 months vs 24-36 months (competitors)</div>
                            <div style="margin-bottom: 6px;">✓ <strong>Congenital Coverage:</strong> Included vs excluded (most competitors)</div>
                            <div>✓ <strong>Claims Processing:</strong> 3 days average vs 7-14 days (competitors)</div>
                        </div>
                    </div>
                    
                    <div style="background: #d1ecf1; border: 1px solid #0c5460; padding: 12px; border-radius: 8px; margin-top: 15px;">
                        <div style="font-weight: 600; color: #0c5460; margin-bottom: 6px;">⚖️ Important Information:</div>
                        <div style="font-size: 11px; color: #0c5460; line-height: 1.5;">
                            • Pre-existing conditions covered after 12-month waiting period<br>
                            • Elective/cosmetic procedures not covered<br>
                            • Premium may increase based on claims experience and age<br>
                            • 30-day free look period from policy receipt<br>
                            • Full medical disclosure required; non-disclosure may void claims
                        </div>
                    </div>
                </div>
                
                <!-- SECONDARY PRODUCT -->
                <div class="product-card" style="margin-top: 15px;">
                    <div style="background: #ffc107; color: #664d00; padding: 6px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 12px;">
                        🛡️ COMPLEMENTARY: INCOME PROTECTION
                    </div>
                    
                    <div class="product-header">
                        <div class="product-name">Term Life Insurance (Both Parents)</div>
                        <div class="product-premium">$170/mo</div>
                    </div>
                    
                    <div class="product-why">
                        <strong>Why Add This:</strong> Health insurance covers medical bills, but what if a parent passes away? This ensures mortgage, children's education, and living expenses are covered. At $14K combined income, losing one income source would devastate the family.
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 13px; line-height: 1.6; color: #495057;">
                        <strong>Coverage:</strong> Sarah ($400K) + Husband ($400K) for 20 years • Covers mortgage + 10 years expenses • Children covered until independence
                    </div>
                    
                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 12px; color: #495057;">
                        <strong>Calculation:</strong> Mortgage ($500K balance) + Children's education ($150K each) + 5 years living expenses ($420K) = ~$1.2M total need. Split between both parents based on income contribution.
                    </div>
                </div>
                
                <!-- INTERACTIVE FEATURES -->
                <div style="margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px;">🎭 Practice Your Pitch</div>
                    <div style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">
                        Role-play the conversation with Sarah. Get real-time coaching.
                    </div>
                    <button onclick="openConversationPractice('sarah')" style="width: 100%; padding: 12px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        🎬 Start Conversation Practice
                    </button>
                </div>
                
                <div style="margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px;">🔍 Try Different Products</div>
                    <div style="font-size: 13px; margin-bottom: 12px; opacity: 0.9;">
                        Explore alternative product combinations for this family.
                    </div>
                    <button onclick="openProductSelector('sarah')" style="width: 100%; padding: 12px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        📦 Browse Product Catalog
                    </button>
                </div>
                
                <div style="margin: 20px 0; padding: 16px; background: white; border: 2px solid #667eea; border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 15px; color: #667eea;">💬 Ask Megatron Anything</div>
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <input type="text" id="megatron-sarah" placeholder="e.g., What if they can only afford $400/mo?" style="flex: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 13px;" onkeypress="if(event.key==='Enter') askMegatronSarah()">
                        <button onclick="askMegatronSarah()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Ask</button>
                    </div>
                    <div style="display: flex; flex-wrap: gap: 6px;">
                        <button onclick="quickAskSarah('budget')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Reduce to fit budget</button>
                        <button onclick="quickAskSarah('husband')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">How to involve husband</button>
                        <button onclick="quickAskSarah('timeline')" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Best time to close</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">⚠️ Predicted Objections</div>
                
                <div class="objection-card">
                    <div class="objection-title">"It's too expensive for our budget"</div>
                    <div class="objection-response">
                        <strong>Response:</strong> "I understand - $640 seems like a lot. But break it down: $21 per day for your entire family's health security. That's less than 2 meals at a hawker center. And here's the reality - one hospitalization without insurance could cost you 6-12 months of premiums. Would you rather pay $640/month planned, or $30,000 unplanned?"<br><br>
                        <strong>Alternative:</strong> "Let's start with the essentials - base plan at $450 without riders. You can always add riders later when budget permits."
                    </div>
                </div>
                
                <div class="objection-card">
                    <div class="objection-title">"I need to discuss with my husband"</div>
                    <div class="objection-response">
                        <strong>Response:</strong> "Absolutely - this is a family decision. Would you like me to set up a quick 15-minute call with both of you? I can walk through the numbers together. Or I can send you a personalized comparison PDF you can review tonight - which would work better?"<br><br>
                        <strong>Urgency Hook:</strong> "Just to mention - premiums are age-based and increase every year. Locking in today's rates saves you money in the long run."
                    </div>
                </div>
                
                <div class="objection-card">
                    <div class="objection-title">"My company provides some coverage"</div>
                    <div class="objection-response">
                        <strong>Response:</strong> "That's great you have company coverage! But here are 3 gaps: 1) It typically only covers you, not your family. 2) You lose it if you change jobs or get retrenched. 3) It's usually basic ward only. This plan fills those gaps and follows you for life."
                    </div>
                </div>
            </div>
            
            <div style="padding: 15px;">
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="startCall('Sarah Tan')">📞 CALL NOW</button>
                <button class="btn btn-secondary" style="width: 100%;" onclick="openConversationPractice('sarah')">🎬 Practice Pitch First</button>
            </div>
            
            <div style="height: 20px;"></div>
        </div>
        
        <!-- PRODUCT SELECTOR SCREEN -->
        <div class="screen" id="product-selector-screen">
            <div class="header-with-back">
                <button class="back-button" onclick="returnToDossierFromProducts()">← Back</button>
                <div style="margin-top: 10px;">
                    <div class="greeting">Product Selector</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Explore alternative products for <span id="lead-name-selector"></span></div>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <div class="panel-header">Select Product Category</div>
                
                <div class="menu-item" onclick="showProductCategory('ilp')">
                    <div class="menu-item-left">
                        <div class="menu-icon">💰</div>
                        <div>
                            <div class="menu-text">Investment-Linked Plans (ILP)</div>
                            <div style="font-size: 11px; color: #666;">Wealth accumulation + protection</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('health')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🏥</div>
                        <div>
                            <div class="menu-text">Health Insurance</div>
                            <div style="font-size: 11px; color: #666;">Hospitalization & medical coverage</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('term')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🛡️</div>
                        <div>
                            <div class="menu-text">Term Life Insurance</div>
                            <div style="font-size: 11px; color: #666;">Affordable death protection</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('whole')">
                    <div class="menu-item-left">
                        <div class="menu-icon">♾️</div>
                        <div>
                            <div class="menu-text">Whole Life Insurance</div>
                            <div style="font-size: 11px; color: #666;">Lifetime protection + savings</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('ci')">
                    <div class="menu-item-left">
                        <div class="menu-icon">💊</div>
                        <div>
                            <div class="menu-text">Critical Illness Insurance</div>
                            <div style="font-size: 11px; color: #666;">Lump sum on CI diagnosis</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('savings')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🏦</div>
                        <div>
                            <div class="menu-text">Savings Plans</div>
                            <div style="font-size: 11px; color: #666;">Guaranteed returns + bonuses</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('retirement')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🏖️</div>
                        <div>
                            <div class="menu-text">Retirement/Annuity Plans</div>
                            <div style="font-size: 11px; color: #666;">Lifetime income stream</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item" onclick="showProductCategory('education')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🎓</div>
                        <div>
                            <div class="menu-text">Education Plans</div>
                            <div style="font-size: 11px; color: #666;">Children's future funding</div>
                        </div>
                    </div>
                    <div>→</div>
                </div>
                
                <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">🤖 Need Help Choosing?</div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 12px;">
                        Not sure which product fits best? Ask Megatron for recommendations.
                    </div>
                    <button onclick="askMegatronRecommendation()" style="width: 100%; padding: 10px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Get AI Recommendation
                    </button>
                </div>
            </div>
        </div>

        <!-- PRODUCT CATEGORY DETAIL SCREEN -->
        <div class="screen" id="product-category-screen">
            <div class="header-with-back">
                <button class="back-button" onclick="openProductSelector()">← Back to Categories</button>
                <div style="margin-top: 10px;">
                    <div class="greeting" id="category-title">Investment-Linked Plans</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Compare products in this category</div>
                </div>
            </div>

            <div style="padding: 20px; overflow-y: auto; height: calc(100% - 140px);" id="product-list-container">
                <!-- Products will be dynamically inserted here -->
            </div>
        </div>

        <!-- AI RECOMMENDATION SCREEN -->
        <div class="screen" id="ai-recommendation-screen">
            <div class="header-with-back">
                <button class="back-button" onclick="openProductSelector()">← Back</button>
                <div style="margin-top: 10px;">
                    <div class="greeting">🤖 AI Recommendations</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Personalized for <span id="recommendation-lead-name"></span></div>
                </div>
            </div>

            <div style="padding: 20px; overflow-y: auto; height: calc(100% - 140px);">
                <!-- AI Analysis Header -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">🧠 Megatron's Analysis</div>
                    <div style="font-size: 13px; line-height: 1.6; opacity: 0.95;" id="ai-analysis-text">
                        Based on the lead's profile, financial situation, and stated needs, I've identified the optimal product strategy.
                    </div>
                </div>

                <!-- Priority Level Indicator -->
                <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">📊 Recommendation Priority</div>
                    <div id="recommendation-priorities">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>

                <!-- Recommended Products -->
                <div id="recommended-products-container">
                    <!-- Will be filled dynamically -->
                </div>

                <!-- Alternative Considerations -->
                <div style="background: #f8f9fa; padding: 16px; border-radius: 12px; margin-top: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">💡 Alternative Considerations</div>
                    <div style="font-size: 13px; line-height: 1.6; color: #495057;" id="alternative-considerations">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="margin-top: 20px;">
                    <button onclick="viewRecommendedCategory()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; margin-bottom: 10px; font-size: 15px;">
                        📦 View Product Details
                    </button>
                    <button onclick="returnToDossierFromProducts()" style="width: 100%; padding: 14px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 15px;">
                        ← Back to Dossier
                    </button>
                </div>
            </div>
        </div>

        <!-- CONVERSATION PRACTICE SCREEN -->
        <div class="screen" id="conversation-practice-screen">
            <div class="header-with-back">
                <button class="back-button" onclick="backToDossierFromPractice()">← Back</button>
                <div style="margin-top: 10px;">
                    <div class="greeting">Conversation Practice</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Role-play with <span id="lead-name-practice"></span></div>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <div style="background: #fff3cd; padding: 12px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 6px;">🎭 How This Works</div>
                    <div style="font-size: 12px; color: #856404; line-height: 1.5;">
                        Practice your pitch in a safe environment. Choose from common scenarios, and Megatron will respond as the customer. You'll get real-time coaching on your responses.
                    </div>
                </div>
                
                <div class="panel-header">Choose a Scenario</div>
                
                <div class="challenge-card" onclick="startScenario('opening')" style="cursor: pointer;">
                    <div class="challenge-title">📞 Opening Call</div>
                    <div class="challenge-progress">Practice your introduction and value proposition</div>
                    <div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">Click to start →</div>
                </div>
                
                <div class="challenge-card" onclick="startScenario('objection-price')" style="cursor: pointer; border-left-color: #ffc107;">
                    <div class="challenge-title">💰 "It's Too Expensive"</div>
                    <div class="challenge-progress">Handle budget objections with confidence</div>
                    <div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">Click to start →</div>
                </div>
                
                <div class="challenge-card" onclick="startScenario('objection-think')" style="cursor: pointer; border-left-color: #28a745;">
                    <div class="challenge-title">🤔 "I Need To Think About It"</div>
                    <div class="challenge-progress">Create urgency without pressure</div>
                    <div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">Click to start →</div>
                </div>
                
                <div class="challenge-card" onclick="startScenario('objection-spouse')" style="cursor: pointer; border-left-color: #667eea;">
                    <div class="challenge-title">👫 "I Need To Discuss With Spouse"</div>
                    <div class="challenge-progress">Navigate multi-decision-maker situations</div>
                    <div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">Click to start →</div>
                </div>
                
                <div class="challenge-card" onclick="startScenario('closing')" style="cursor: pointer; border-left-color: #17a2b8;">
                    <div class="challenge-title">✅ Closing The Deal</div>
                    <div class="challenge-progress">Ask for commitment and next steps</div>
                    <div style="margin-top: 8px; font-size: 12px; color: #667eea; font-weight: 600;">Click to start →</div>
                </div>
                
                <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">💡 Pro Tip</div>
                    <div style="font-size: 13px; color: #666; line-height: 1.5;">
                        After each practice session, you'll receive a performance score and specific feedback on what worked well and what to improve.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- LIVE CALL COACHING SCREEN -->
        <div class="screen" id="live-call-screen">
            <div class="header-with-back" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button onclick="endCall()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px;">End Call</button>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 10px; height: 10px; background: #ff4444; border-radius: 50%; animation: blink 1s infinite;"></div>
                        <div style="font-size: 14px; font-weight: 600;" id="call-timer">00:00</div>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <div class="greeting" id="call-lead-name">Call with Chen Wei</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Live AI Coaching Active</div>
                </div>
            </div>
            
            <div style="padding: 15px; height: calc(100% - 120px); overflow-y: auto;">
                <!-- Real-time Transcription -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e; display: flex; align-items: center; gap: 8px;">
                        🎤 Live Transcription
                        <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 8px; font-size: 10px;">LISTENING</span>
                    </div>
                    
                    <div id="transcription-log" style="max-height: 200px; overflow-y: auto; font-size: 13px; line-height: 1.6;">
                        <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <strong style="color: #667eea;">You:</strong> Hi Chen Wei, this is [Your Name] from AIA. Thanks for taking my call. How are you today?
                        </div>
                        <div style="margin-bottom: 10px; padding: 10px; background: #e7f3ff; border-radius: 8px;">
                            <strong style="color: #0066cc;">Chen Wei:</strong> Hi, I'm good thanks. So you wanted to talk about investment plans?
                        </div>
                    </div>
                </div>
                
                <!-- AI Next Best Action -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 16px; margin-bottom: 15px; color: white; animation: pulse 2s infinite;">
                    <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        🤖 Next Best Action
                    </div>
                    <div id="next-action" style="font-size: 14px; line-height: 1.6; background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px;">
                        <strong>Recommended:</strong> Acknowledge his interest, then pivot to his primary need (wealth accumulation). Ask: "That's right! I've reviewed your profile and I think you'll be interested in our WealthBuilder Plus ILP. Have you thought about how to optimize your investments while getting life coverage?"
                    </div>
                </div>
                
                <!-- Objection Detection -->
                <div id="objection-alert" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 6px;">⚠️ Objection Detected</div>
                    <div style="font-size: 12px; color: #856404;" id="objection-text"></div>
                </div>
                
                <!-- Talking Points -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">💡 Key Talking Points</div>
                    
                    <div id="talking-points-list">
                        <div class="talking-point" style="font-size: 12px; margin-bottom: 8px;">
                            <strong>Value Prop:</strong> "With 100 fund choices and 1.2% fees - 30% lower than competitors - you maximize returns while minimizing costs."
                        </div>
                        <div class="talking-point" style="font-size: 12px; margin-bottom: 8px;">
                            <strong>Tax Benefit:</strong> "You'll get $7K annual tax relief, effectively reducing your premium to $933/month - just 6.2% of your income."
                        </div>
                        <div class="talking-point" style="font-size: 12px; margin-bottom: 8px;">
                            <strong>Time Value:</strong> "At 38, locking in insurability now is crucial. Premiums increase 5-8% annually with age."
                        </div>
                    </div>
                </div>
                
                <!-- Sentiment Analysis -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">😊 Customer Sentiment</div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Interest Level</div>
                            <div style="height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                                <div id="interest-bar" style="height: 100%; background: #28a745; width: 75%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div id="interest-percent" style="font-weight: 600; color: #28a745;">75%</div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Concern Level</div>
                            <div style="height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                                <div id="concern-bar" style="height: 100%; background: #ffc107; width: 35%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div id="concern-percent" style="font-weight: 600; color: #ffc107;">35%</div>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 12px; color: #495057;">
                        <strong>AI Analysis:</strong> Customer is engaged and asking clarifying questions. Positive tone detected. Ready for deeper product discussion.
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">⚡ Quick Actions</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        <button onclick="quickAction('send-doc')" style="padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">📄 Send Brochure</button>
                        <button onclick="quickAction('quote')" style="padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">💰 Generate Quote</button>
                        <button onclick="quickAction('compare')" style="padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">📊 Show Comparison</button>
                        <button onclick="quickAction('schedule')" style="padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: 600;">📅 Schedule F2F</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- LIVE CHAT QUEUE SCREEN -->
        <div class="screen" id="live-chat-queue-screen">
            <div class="header-with-back" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
                <button class="back-button" onclick="backToHome()">← Back</button>
                <div style="margin-top: 10px;">
                    <div class="greeting">Live Chat Queue</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Website visitors waiting for assistance</div>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #1a1a2e;">Waiting Customers (3)</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 10px; height: 10px; background: #28a745; border-radius: 50%;"></div>
                        <div style="font-size: 12px; color: #28a745; font-weight: 600;">You're Online</div>
                    </div>
                </div>
                
                <!-- Chat Request Card 1 -->
                <div class="region-card" style="margin-bottom: 15px; border-left: 4px solid #dc3545;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; font-size: 16px; color: #1a1a2e;">Melissa Wong</div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Waiting: 2m 34s</div>
                        </div>
                        <div style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;">URGENT</div>
                    </div>
                    
                    <div style="font-size: 13px; color: #495057; margin-bottom: 10px; line-height: 1.5;">
                        <strong>Page:</strong> /products/health-insurance<br>
                        <strong>Viewing:</strong> HealthShield Gold Plus<br>
                        <strong>Initial Message:</strong> "Hi, I need family coverage. How much would it cost for 4 people?"
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 12px;">
                        <button onclick="acceptChat('melissa')" style="flex: 1; padding: 10px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Accept Chat</button>
                        <button onclick="transferChat('melissa')" style="padding: 10px 16px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-weight: 600; cursor: pointer;">Transfer</button>
                    </div>
                </div>
                
                <!-- Chat Request Card 2 -->
                <div class="region-card" style="margin-bottom: 15px; border-left: 4px solid #ffc107;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; font-size: 16px; color: #1a1a2e;">David Lim</div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Waiting: 1m 15s</div>
                        </div>
                        <div style="background: #ffc107; color: #664d00; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;">MEDIUM</div>
                    </div>
                    
                    <div style="font-size: 13px; color: #495057; margin-bottom: 10px; line-height: 1.5;">
                        <strong>Page:</strong> /products/investment-plans<br>
                        <strong>Viewing:</strong> WealthBuilder Plus ILP<br>
                        <strong>Initial Message:</strong> "What's the difference between this and a normal investment account?"
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 12px;">
                        <button onclick="acceptChat('david')" style="flex: 1; padding: 10px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Accept Chat</button>
                        <button onclick="transferChat('david')" style="padding: 10px 16px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-weight: 600; cursor: pointer;">Transfer</button>
                    </div>
                </div>
                
                <!-- Chat Request Card 3 -->
                <div class="region-card" style="margin-bottom: 15px; border-left: 4px solid #28a745;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; font-size: 16px; color: #1a1a2e;">Anonymous User</div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">Waiting: 45s</div>
                        </div>
                        <div style="background: #28a745; color: white; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;">NEW</div>
                    </div>
                    
                    <div style="font-size: 13px; color: #495057; margin-bottom: 10px; line-height: 1.5;">
                        <strong>Page:</strong> /contact-us<br>
                        <strong>Viewing:</strong> Contact form<br>
                        <strong>Initial Message:</strong> "Is anyone available to answer questions?"
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 12px;">
                        <button onclick="acceptChat('anonymous')" style="flex: 1; padding: 10px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Accept Chat</button>
                        <button onclick="transferChat('anonymous')" style="padding: 10px 16px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-weight: 600; cursor: pointer;">Transfer</button>
                    </div>
                </div>
                
                <!-- Available Agents Section -->
                <div style="margin-top: 30px;">
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 12px;">Available Agents (8 online)</div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <div style="background: #e7f3ff; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            You (Sarah)
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            Marcus T.
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            Emily C.
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #ffc107; border-radius: 50%;"></div>
                            David K. (Busy)
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            Lisa W.
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #ffc107; border-radius: 50%;"></div>
                            James L. (Busy)
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            Rachel N.
                        </div>
                        <div style="background: #f8f9fa; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                            Kevin T.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ACTIVE LIVE CHAT SCREEN -->
        <div class="screen" id="active-live-chat-screen">
            <div class="header-with-back" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
                <button class="back-button" onclick="backToChatQueue()">← Back to Queue</button>
                <div style="margin-top: 10px;">
                    <div class="greeting" id="chat-customer-name">Chat with Melissa Wong</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px; display: flex; align-items: center; gap: 8px;">
                        <div style="width: 8px; height: 8px; background: #28a745; border-radius: 50%;"></div>
                        Customer is typing...
                    </div>
                </div>
            </div>
            
            <div style="padding: 15px; height: calc(100% - 300px); overflow-y: auto; background: #f8f9fa;" id="live-chat-log">
                <!-- Chat messages will appear here -->
                <div style="margin-bottom: 15px;">
                    <div style="background: #e9ecef; padding: 10px; border-radius: 12px; font-size: 12px; text-align: center; color: #666;">
                        Chat started • Melissa Wong from /products/health-insurance
                    </div>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Melissa Wong</div>
                    <div style="background: white; padding: 12px; border-radius: 12px; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); max-width: 80%;">
                        Hi, I need family coverage. How much would it cost for 4 people?
                    </div>
                </div>
                
                <div style="margin-bottom: 12px; display: flex; justify-content: flex-end;">
                    <div style="max-width: 80%;">
                        <div style="font-size: 11px; color: #666; margin-bottom: 4px; text-align: right;">You</div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 12px; font-size: 14px;">
                            Hi Melissa! I'd be happy to help. For a family of 4, our HealthShield Gold Plus starts at $450/month. Can you tell me the ages of your family members?
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Melissa Wong</div>
                    <div style="background: white; padding: 12px; border-radius: 12px; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); max-width: 80%;">
                        Me (34), husband (36), and two kids (7 and 4)
                    </div>
                </div>
            </div>
            
            <!-- AI Suggestions Panel -->
            <div style="padding: 12px; background: #fff3cd; border-top: 2px solid #ffc107;">
                <div style="font-size: 11px; font-weight: 600; color: #856404; margin-bottom: 6px;">AI Suggestion</div>
                <div id="chat-ai-suggestion" style="font-size: 12px; color: #856404; line-height: 1.5;">
                    This matches Sarah Tan's profile! Recommend HealthShield Gold Plus with Children CI Booster. Mention pediatric benefits and maternity rider.
                </div>
            </div>
            
            <!-- Chat Input -->
            <div style="position: absolute; bottom: 80px; left: 0; right: 0; background: white; padding: 12px; border-top: 1px solid #e9ecef; z-index: 100;">
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input type="text" id="live-chat-input" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                    <button onclick="sendChatMessage()" style="padding: 12px 20px; background: #17a2b8; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Send</button>
                </div>
                <div style="display: flex; gap: 6px;">
                    <button onclick="askMegatronFromChat()" style="padding: 6px 10px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;">🤖 Ask Megatron</button>
                    <button onclick="useChatTemplate('intro')" style="padding: 6px 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Quick intro</button>
                    <button onclick="useChatTemplate('quote')" style="padding: 6px 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Send quote</button>
                    <button onclick="convertToLead()" style="padding: 6px 10px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;">Convert to Lead</button>
                </div>
            </div>
        </div>
        
        <!-- CALL SUMMARY SCREEN -->
        <div class="screen" id="call-summary-screen">
            <div class="header-with-back" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <button class="back-button" onclick="backToDossierFromSummary()">← Back to Dossier</button>
                <div style="margin-top: 10px;">
                    <div class="greeting">Call Summary & Analysis</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;" id="summary-lead-name">Chen Wei • 5:23 duration</div>
                </div>
            </div>
            
            <div style="padding: 20px; overflow-y: auto; height: calc(100% - 140px);">
                <!-- Performance Score -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); text-align: center;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #1a1a2e;">Overall Performance</div>
                    <div style="font-size: 48px; font-weight: 700; color: #28a745; margin-bottom: 5px;">8.5/10</div>
                    <div style="font-size: 13px; color: #666;">Strong performance with room for improvement</div>
                </div>
                
                <!-- What Went Well -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #28a745; display: flex; align-items: center; gap: 8px;">
                        ✅ What Went Well
                    </div>
                    <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                        <div style="margin-bottom: 8px;">• <strong>Strong product knowledge:</strong> Accurately explained ILP features and benefits</div>
                        <div style="margin-bottom: 8px;">• <strong>Good rapport building:</strong> Used customer's name 4 times, warm tone throughout</div>
                        <div style="margin-bottom: 8px;">• <strong>Effective objection handling:</strong> Reframed cost concerns with tax relief breakdown</div>
                        <div>• <strong>Active listening:</strong> Picked up on job security concern and addressed it directly</div>
                    </div>
                </div>
                
                <!-- Areas for Improvement -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #ffc107; display: flex; align-items: center; gap: 8px;">
                        ⚠️ Areas for Improvement
                    </div>
                    <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                        <div style="margin-bottom: 8px;">• <strong>Pacing:</strong> Spoke too fast when explaining fund allocation (2.8 words/sec vs recommended 2.0)</div>
                        <div style="margin-bottom: 8px;">• <strong>Pushiness detected:</strong> Asked for commitment 3 times within 2 minutes - space out closing attempts</div>
                        <div>• <strong>Missing detail:</strong> Didn't mention policy surrender charges when discussing early withdrawal</div>
                    </div>
                </div>
                
                <!-- Key Insights About Lead -->
                <div style="background: linear-gradient(135deg, #e7f3ff 0%, #fff 100%); border: 2px solid #667eea; border-radius: 12px; padding: 16px; margin-bottom: 15px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #667eea; display: flex; align-items: center; gap: 8px;">
                        💡 New Insights About Lead
                    </div>
                    <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                        <div style="margin-bottom: 8px;"><strong>Primary Concern:</strong> Job security and financial flexibility</div>
                        <div style="margin-bottom: 8px;"><strong>Decision Timeline:</strong> Wants to discuss with financial advisor first (~1 week)</div>
                        <div style="margin-bottom: 8px;"><strong>Budget Sensitivity:</strong> Medium - comfortable with $1,200/mo but wants value justification</div>
                        <div style="margin-bottom: 8px;"><strong>Interest Level:</strong> High (85%) - actively comparing options</div>
                        <div><strong>Competitor Mention:</strong> Currently considering Prudential's PruInvest plan</div>
                    </div>
                </div>
                
                <!-- Conversation Summary -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">Conversation Summary</div>
                    <div style="font-size: 13px; line-height: 1.6; color: #495057;">
                        Customer expressed strong interest in wealth accumulation with insurance protection. Main discussion points: ILP structure, fund options, tax benefits, and premium holiday feature. Key objections: monthly cost and job security concerns. Successfully reframed both objections. Customer requested time to review materials and consult financial advisor. Follow-up scheduled for next Tuesday.
                    </div>
                </div>
                
                <!-- Recommended Next Steps -->
                <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-weight: 600; margin-bottom: 12px; color: #1a1a2e;">🎯 Recommended Next Steps</div>
                    <div style="font-size: 13px; line-height: 1.8; color: #495057;">
                        <div style="margin-bottom: 8px;">1. Send comparison chart: WealthBuilder Plus vs Prudential PruInvest</div>
                        <div style="margin-bottom: 8px;">2. Email detailed breakdown of premium holiday feature and surrender charges</div>
                        <div style="margin-bottom: 8px;">3. Schedule follow-up call for Tuesday 3 PM</div>
                        <div>4. Prepare ROI projections for 20-year scenario</div>
                    </div>
                </div>
                
                <!-- Lead Temperature Update -->
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 6px;">🌡️ Lead Temperature Updated</div>
                    <div style="font-size: 12px; color: #856404; line-height: 1.5;">
                        Lead status changed from <strong>Cold (50%)</strong> to <strong>Warm (85%)</strong> based on conversation signals. Move to active nurture pipeline with 3-day follow-up cadence.
                    </div>
                </div>
            </div>
            
            <div style="position: absolute; bottom: 0; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid #e9ecef;">
                <button onclick="saveCallInsights()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 15px;">
                    Save Insights & Return to Dossier
                </button>
            </div>
        </div>
        
        <!-- ACTIVE CONVERSATION SCREEN -->
        <div class="screen" id="active-conversation-screen">
            <div class="header-with-back">
                <button class="back-button" onclick="backToPracticeMenu()">← Back</button>
                <div style="margin-top: 10px;">
                    <div class="greeting" id="scenario-title">Opening Call Practice</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">
                        <span id="conversation-lead-name"></span> • Turn 1/5
                    </div>
                </div>
            </div>
            
            <div style="padding: 20px; height: calc(100% - 200px); overflow-y: auto;" id="conversation-log">
                <!-- Conversation will appear here -->
                <div class="region-card" style="background: #f8f9fa;">
                    <div style="font-size: 13px; color: #666; line-height: 1.6;">
                        <strong>Customer:</strong> "Hello? Who is this?"
                    </div>
                </div>
            </div>
            
            <div style="position: absolute; bottom: 80px; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid #e9ecef; z-index: 100;">
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <input type="text" id="agent-response" placeholder="Type your response..." style="flex: 1; padding: 12px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 13px;">
                    <button onclick="sendResponse()" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Send</button>
                </div>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <button onclick="useSuggestedResponse(1)" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Use script #1</button>
                    <button onclick="useSuggestedResponse(2)" style="padding: 6px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; cursor: pointer;">Use script #2</button>
                    <button onclick="getMegatronHelp()" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 11px; cursor: pointer;">🤖 Get hint</button>
                </div>
            </div>
        </div>
        
        <!-- ACHIEVEMENTS SCREEN -->
        <div class="screen" id="achievements-screen">
            <div class="achievements-header">
                <button class="back-button" onclick="switchScreen('home')">← Back</button>
                <div class="achievements-title">🏆 Achievements</div>
                <div style="font-size: 14px; margin-top: 5px;">23 / 47 Badges Unlocked</div>
            </div>
            
            <div class="achievements-content">
                <div class="panel-header">✅ Unlocked Badges</div>
                
                <div class="badge-grid">
                    <div class="badge-card">
                        <div class="badge-icon">🔥</div>
                        <div class="badge-name">Fire Starter</div>
                        <div class="badge-progress">7-day streak</div>
                    </div>
                    
                    <div class="badge-card">
                        <div class="badge-icon">💎</div>
                        <div class="badge-name">Diamond Hunter</div>
                        <div class="badge-progress">7/10 closed</div>
                    </div>
                    
                    <div class="badge-card">
                        <div class="badge-icon">⚡</div>
                        <div class="badge-name">Speed Demon</div>
                        <div class="badge-progress">Unlocked</div>
                    </div>
                    
                    <div class="badge-card">
                        <div class="badge-icon">🎯</div>
                        <div class="badge-name">Sniper</div>
                        <div class="badge-progress">90% rate</div>
                    </div>
                    
                    <div class="badge-card">
                        <div class="badge-icon">👥</div>
                        <div class="badge-name">Team Player</div>
                        <div class="badge-progress">Unlocked</div>
                    </div>
                    
                    <div class="badge-card">
                        <div class="badge-icon">🌅</div>
                        <div class="badge-name">Early Bird</div>
                        <div class="badge-progress">Unlocked</div>
                    </div>
                </div>
                
                <div class="panel-header" style="margin-top: 20px;">🔒 Locked Badges</div>
                
                <div class="badge-grid">
                    <div class="badge-card locked">
                        <div class="badge-icon">🌙</div>
                        <div class="badge-name">Night Owl</div>
                        <div class="badge-progress">0/10</div>
                    </div>
                    
                    <div class="badge-card locked">
                        <div class="badge-icon">💯</div>
                        <div class="badge-name">Perfectionist</div>
                        <div class="badge-progress">Locked</div>
                    </div>
                    
                    <div class="badge-card locked">
                        <div class="badge-icon">🏅</div>
                        <div class="badge-name">Mentor</div>
                        <div class="badge-progress">0/3</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROFILE SCREEN -->
        <div class="screen" id="profile-screen">
            <div class="profile-header">
                <button class="back-button" onclick="switchScreen('home')">← Back</button>
                
                <div class="profile-card">
                    <div class="profile-avatar">👤</div>
                    <div class="profile-name">Sarah Lim</div>
                    <div class="profile-level">⭐ Expert Tier • Level 8</div>
                    
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value">4.8</div>
                            <div class="profile-stat-label">Rating</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value">247</div>
                            <div class="profile-stat-label">Conversions</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value">23</div>
                            <div class="profile-stat-label">Badges</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-content">
                <div class="menu-item" onclick="switchScreen('achievements')">
                    <div class="menu-item-left">
                        <div class="menu-icon">🏆</div>
                        <div class="menu-text">Achievements</div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item">
                    <div class="menu-item-left">
                        <div class="menu-icon">📊</div>
                        <div class="menu-text">My Performance</div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item">
                    <div class="menu-item-left">
                        <div class="menu-icon">📚</div>
                        <div class="menu-text">Training & Resources</div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item">
                    <div class="menu-item-left">
                        <div class="menu-icon">⚙️</div>
                        <div class="menu-text">Settings</div>
                    </div>
                    <div>→</div>
                </div>
                
                <div class="menu-item">
                    <div class="menu-item-left">
                        <div class="menu-icon">❓</div>
                        <div class="menu-text">Help & Support</div>
                    </div>
                    <div>→</div>
                </div>
            </div>
        </div>
        
        <!-- HEAT MAP SCREEN -->
        <div class="screen" id="heatmap-screen">
            <!-- Filter Controls -->
            <div style="background: white; padding: 12px 15px; border-bottom: 2px solid #e9ecef;">
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
                    <button onclick="toggleHeatmapFilter('all')" id="filter-all" class="heatmap-filter-btn active" style="flex: 1; padding: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer;">
                        All Zones
                    </button>
                    <button onclick="toggleHeatmapFilter('surge')" id="filter-surge" class="heatmap-filter-btn" style="flex: 1; padding: 8px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer;">
                        🔥 Surge Only
                    </button>
                    <button onclick="toggleHeatmapFilter('nearby')" id="filter-nearby" class="heatmap-filter-btn" style="flex: 1; padding: 8px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer;">
                        📍 Nearby
                    </button>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <span style="font-size: 11px; color: #666;">Radius:</span>
                    <input type="range" id="proximity-range" min="1" max="10" value="3" oninput="updateProximityRadius(this.value)" style="flex: 1;">
                    <span style="font-size: 11px; font-weight: 600;" id="radius-label">3km</span>
                    <button id="route-mode-btn" onclick="toggleRouteMode()" style="padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer;">
                        🗺️ Plan Route
                    </button>
                </div>
            </div>

            <!-- Route Planning Panel -->
            <div id="route-panel" style="display: none; background: white; padding: 12px 15px; border-bottom: 2px solid #e9ecef;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="font-weight: 600; font-size: 13px; color: #667eea;">📍 Building Your Route</div>
                    <button onclick="clearRoute()" style="padding: 4px 10px; background: #dc3545; color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer;">
                        Clear
                    </button>
                </div>
                <div style="font-size: 11px; color: #666; margin-bottom: 8px;">Click zones on map to add to route (min 2 zones)</div>
                <div id="selected-zones" style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;">
                    <!-- Selected zones will appear here -->
                </div>
                <div id="route-summary" style="display: none; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                        <span>Total Distance:</span>
                        <span style="font-weight: 600;" id="route-distance">0km</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                        <span>Est. Travel Time:</span>
                        <span style="font-weight: 600;" id="route-time">0 min</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px;">
                        <span>Total Leads:</span>
                        <span style="font-weight: 600; color: #28a745;" id="route-leads">0 leads</span>
                    </div>
                </div>
                <button id="optimize-route-btn" onclick="optimizeRoute()" style="display: none; width: 100%; padding: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;">
                    ⚡ Optimize & Start Route
                </button>
            </div>

            <div class="map-container">
                <div class="map-bg"></div>

                <!-- Route Lines Container -->
                <svg id="route-lines" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
                    <!-- Route lines will be drawn here -->
                </svg>

                <!-- Proximity Radius Circle -->
                <div id="proximity-circle" style="position: absolute; left: 50%; top: 46%; width: 120px; height: 120px; border: 2px dashed #667eea; border-radius: 50%; transform: translate(-50%, -50%); opacity: 0.3; pointer-events: none; z-index: 2;"></div>

                <!-- Clickable Zone Markers -->
                <div class="location-marker zone-marker" data-zone="tampines" data-x="35" data-y="45" onclick="handleZoneClick('tampines')" title="Tampines - 18 leads, 2.1km away" style="left: 35%; top: 45%; cursor: pointer; z-index: 10;">
                    <div class="marker-dot hot-marker" style="animation: pulse 2s infinite;">🔥</div>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: rgba(220, 53, 69, 0.9); color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">2× SURGE</div>
                    <div class="zone-hover-label" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100;">
                        <div style="margin-bottom: 4px;">📍 Tampines</div>
                        <div style="font-size: 10px; opacity: 0.9;">18 leads • 2.1km away</div>
                    </div>
                </div>

                <div class="location-marker zone-marker" data-zone="cbd" data-x="70" data-y="35" onclick="handleZoneClick('cbd')" title="CBD / Marina - 12 leads, 8.5km away" style="left: 70%; top: 35%; cursor: pointer; z-index: 10;">
                    <div class="marker-dot hot-marker" style="animation: pulse 2s infinite;">🔥</div>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: rgba(255, 193, 7, 0.9); color: #333; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">1.5× SURGE</div>
                    <div class="zone-hover-label" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100;">
                        <div style="margin-bottom: 4px;">📍 CBD / Marina</div>
                        <div style="font-size: 10px; opacity: 0.9;">12 leads • 8.5km away</div>
                    </div>
                </div>

                <div class="location-marker zone-marker" data-zone="bedok" data-x="25" data-y="75" onclick="handleZoneClick('bedok')" title="Bedok - 5 leads, 3.5km away" style="left: 25%; top: 75%; cursor: pointer; z-index: 10;">
                    <div class="marker-dot warm-marker">💎</div>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: rgba(102, 126, 234, 0.9); color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">5 leads</div>
                    <div class="zone-hover-label" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100;">
                        <div style="margin-bottom: 4px;">📍 Bedok</div>
                        <div style="font-size: 10px; opacity: 0.9;">5 leads • 3.5km away</div>
                    </div>
                </div>

                <div class="location-marker zone-marker" data-zone="eastcoast" data-x="80" data-y="70" onclick="handleZoneClick('eastcoast')" title="East Coast - 3 leads, 6.2km away" style="left: 80%; top: 70%; cursor: pointer; z-index: 10;">
                    <div class="marker-dot warm-marker">💎</div>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: rgba(102, 126, 234, 0.9); color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">3 leads</div>
                    <div class="zone-hover-label" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100;">
                        <div style="margin-bottom: 4px;">📍 East Coast</div>
                        <div style="font-size: 10px; opacity: 0.9;">3 leads • 6.2km away</div>
                    </div>
                </div>

                <div class="location-marker zone-marker" data-zone="sembawang" data-x="55" data-y="65" onclick="handleZoneClick('sembawang')" title="Sembawang - 2 leads, 12.5km away" style="left: 55%; top: 65%; cursor: pointer; z-index: 10;">
                    <div class="marker-dot cool-marker">📍</div>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: rgba(40, 167, 69, 0.9); color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">2 leads</div>
                    <div class="zone-hover-label" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100;">
                        <div style="margin-bottom: 4px;">📍 Sembawang</div>
                        <div style="font-size: 10px; opacity: 0.9;">2 leads • 12.5km away</div>
                    </div>
                </div>

                <div class="my-location" style="left: 52%; top: 48%;">
                    <div style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); background: #667eea; color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; white-space: nowrap;">You are here</div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ff6b6b;"></div>
                        <span>Surge Zone (2×)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ffc107;"></div>
                        <span>High Activity</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #28a745;"></div>
                        <span>Normal</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #667eea;"></div>
                        <span>Your Location</span>
                    </div>
                </div>
            </div>
            
            <div class="info-panel">
                <div class="proximity-alert">
                    <div class="alert-title">⚡ PROXIMITY BONUS AVAILABLE!</div>
                    <div class="alert-text">
                        5 Diamond leads within 3km radius. Grab now for +50 bonus points each!
                    </div>
                </div>
                
                <div class="panel-header">🔥 Active Surge Zones</div>
                
                <div class="region-card">
                    <div class="region-header">
                        <div class="region-name">📍 Tampines</div>
                        <div class="surge-badge">2× SURGE</div>
                    </div>
                    <div class="region-stats">
                        <div class="stat-group">
                            <span>💎</span>
                            <span>18 leads</span>
                        </div>
                        <div class="stat-group">
                            <span>📍</span>
                            <span>2.1km away</span>
                        </div>
                        <div class="stat-group">
                            <span>⏱️</span>
                            <span>45 min left</span>
                        </div>
                    </div>
                </div>
                
                <div class="region-card">
                    <div class="region-header">
                        <div class="region-name">📍 CBD / Marina</div>
                        <div class="surge-badge">1.5× SURGE</div>
                    </div>
                    <div class="region-stats">
                        <div class="stat-group">
                            <span>💎</span>
                            <span>12 leads</span>
                        </div>
                        <div class="stat-group">
                            <span>📍</span>
                            <span>8.5km away</span>
                        </div>
                        <div class="stat-group">
                            <span>⏱️</span>
                            <span>1h 15m left</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RANKINGS SCREEN -->
        <div class="screen" id="rankings-screen">
            <div class="rankings-header">
                <div class="rankings-title">🏆 Leaderboard</div>
                <div class="your-rank">
                    <div>
                        <div style="font-size: 13px;">Your Rank</div>
                        <div style="font-size: 16px; font-weight: 600;">Sarah Lim</div>
                    </div>
                    <div class="rank-number">#8</div>
                </div>
            </div>
            
            <div class="leaderboard">
                <div class="agent-row">
                    <div class="agent-rank rank-gold">1</div>
                    <div class="agent-info">
                        <div class="agent-name">Marcus Tan</div>
                        <div class="agent-meta">Master • 34 conversions this month</div>
                    </div>
                    <div class="agent-score">4.9★</div>
                </div>
                
                <div class="agent-row">
                    <div class="agent-rank rank-silver">2</div>
                    <div class="agent-info">
                        <div class="agent-name">Emily Chen</div>
                        <div class="agent-meta">Master • 31 conversions this month</div>
                    </div>
                    <div class="agent-score">4.8★</div>
                </div>
                
                <div class="agent-row">
                    <div class="agent-rank rank-bronze">3</div>
                    <div class="agent-info">
                        <div class="agent-name">David Kumar</div>
                        <div class="agent-meta">Expert • 29 conversions this month</div>
                    </div>
                    <div class="agent-score">4.8★</div>
                </div>
                
                <div class="agent-row">
                    <div class="agent-info">
                        <div class="agent-name">Lisa Wong</div>
                        <div class="agent-meta">Expert • 27 conversions this month</div>
                    </div>
                    <div class="agent-score">4.7★</div>
                </div>
                
                <div class="agent-row">
                    <div class="agent-info">
                        <div class="agent-name">James Lee</div>
                        <div class="agent-meta">Expert • 26 conversions this month</div>
                    </div>
                    <div class="agent-score">4.7★</div>
                </div>
            </div>
        </div>
        
        <!-- SQUAD SCREEN -->
        <div class="screen" id="squad-screen">
            <div class="squad-header">
                <div class="squad-name">🦅 East Eagles</div>
                <div>Rank #1 • 2,847 points</div>
                <div class="squad-stats">
                    <div>👥 8 Members</div>
                    <div>🔥 12 Day Streak</div>
                    <div>🏆 3 Wins</div>
                </div>
            </div>

            <!-- 3-Tab Navigation -->
            <div class="chat-tab-container">
                <div class="chat-tab active" onclick="switchSquadTab('members')">👥 Members</div>
                <div class="chat-tab" onclick="switchSquadTab('news')">📰 News</div>
                <div class="chat-tab" onclick="switchSquadTab('chat')">💬 Chat</div>
            </div>

            <!-- Members Tab Content -->
            <div class="squad-content" id="squad-members-tab">
                <div class="panel-header">👥 Squad Members</div>

                <div class="member-card">
                    <div class="member-info">
                        <div class="member-name">Sarah Lim (You)</div>
                        <div class="member-status">🟢 Active now • 24 conversions</div>
                    </div>
                    <div class="agent-score">4.8★</div>
                </div>

                <div class="member-card">
                    <div class="member-info">
                        <div class="member-name">Marcus Tan</div>
                        <div class="member-status">🟢 Active now • 34 conversions</div>
                    </div>
                    <div class="agent-score">4.9★</div>
                </div>

                <div class="member-card">
                    <div class="member-info">
                        <div class="member-name">Rachel Ng</div>
                        <div class="member-status">🟡 Active 15 min ago • 19 conversions</div>
                    </div>
                    <div class="agent-score">4.6★</div>
                </div>

                <div class="member-card">
                    <div class="member-info">
                        <div class="member-name">Kevin Tan</div>
                        <div class="member-status">🟢 Active now • 22 conversions</div>
                    </div>
                    <div class="agent-score">4.7★</div>
                </div>

                <div class="panel-header" style="margin-top: 20px;">🎯 Squad Challenges</div>

                <div class="region-card">
                    <div class="region-name">Team Goal: 100 Conversions</div>
                    <div class="progress-bar" style="margin-top: 10px;">
                        <div class="progress-fill" style="width: 87%;"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 8px;">87 / 100 • 13 more to win $5,000 bonus!</div>
                </div>
            </div>

            <!-- News Tab Content -->
            <div class="squad-content" id="squad-news-tab" style="display: none;">
                <div class="panel-header">📰 Squad News Feed</div>
                <div style="font-size: 12px; color: #666; margin-bottom: 15px;">Market insights shared by squad members</div>

                <div id="squad-news-feed">
                    <!-- Shared news will appear here -->
                </div>
            </div>

            <!-- Chat Tab Content -->
            <div class="chat-container" id="squad-chat-tab" style="display: none;">
                <div class="chat-messages" id="chat-messages-container">
                    <!-- Messages will be rendered here -->
                </div>

                <div class="chat-input-container">
                    <div class="chat-quick-actions">
                        <button class="quick-action-btn" onclick="sendQuickMessage('tips')">💡 Share Tip</button>
                        <button class="quick-action-btn" onclick="sendQuickMessage('celebrate')">🎉 Celebrate</button>
                        <button class="quick-action-btn" onclick="sendQuickMessage('help')">🆘 Need Help</button>
                        <button class="quick-action-btn" onclick="sendQuickMessage('megatron')">🤖 Ask Megatron</button>
                    </div>
                    <div class="chat-input-box">
                        <input type="text" class="chat-input" id="chat-input" placeholder="Type a message..." onkeypress="handleChatEnter(event)">
                        <button class="chat-send-btn" onclick="sendChatMessage()">
                            <span>➤</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEWS HUB SCREEN -->
        <div class="screen" id="news-screen">
            <div class="news-header">
                <div class="news-title">📰 Market Intelligence Hub</div>
                <div class="news-subtitle">Stay informed with latest insurance market news & insights</div>
            </div>

            <div class="news-filters">
                <div class="filter-chip active" onclick="filterNews('all')">🌐 All News</div>
                <div class="filter-chip" onclick="filterNews('trending')">🔥 Trending</div>
                <div class="filter-chip" onclick="filterNews('health')">🏥 Health</div>
                <div class="filter-chip" onclick="filterNews('regulation')">⚖️ Regulation</div>
                <div class="filter-chip" onclick="filterNews('competitor')">🎯 Competitors</div>
                <div class="filter-chip" onclick="filterNews('esg')">🌱 ESG</div>
            </div>

            <div class="news-content" id="news-container">
                <!-- News cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- CHALLENGES SCREEN -->
        <div class="screen" id="challenges-screen">
            <div class="challenges-header">
                <div class="challenges-title">🎯 Active Challenges</div>
                <div style="font-size: 14px; margin-top: 5px;">Complete challenges to earn bonus points & rewards</div>
            </div>
            
            <div class="challenges-content">
                <div class="challenge-card">
                    <div class="challenge-title">🔥 Daily Active Streak</div>
                    <div class="challenge-progress">12 days streak • Keep it going!</div>
                    <div class="challenge-bar">
                        <div class="challenge-fill" style="width: 40%;"></div>
                    </div>
                    <div class="challenge-reward">Reward: +500 pts at 30 days</div>
                </div>
                
                <div class="challenge-card" style="border-left-color: #ffc107;">
                    <div class="challenge-title">⚡ Morning Rush Master</div>
                    <div class="challenge-progress">Accept 5 leads before 10 AM</div>
                    <div class="challenge-bar">
                        <div class="challenge-fill" style="width: 60%; background: linear-gradient(90deg, #ffc107 0%, #ffb700 100%);"></div>
                    </div>
                    <div class="challenge-reward">Progress: 3 / 5 • Reward: +300 pts</div>
                </div>
                
                <div class="challenge-card" style="border-left-color: #28a745;">
                    <div class="challenge-title">💎 Diamond Hunter</div>
                    <div class="challenge-progress">Close 10 Diamond leads</div>
                    <div class="challenge-bar">
                        <div class="challenge-fill" style="width: 70%; background: linear-gradient(90deg, #28a745 0%, #20c997 100%);"></div>
                    </div>
                    <div class="challenge-reward">Progress: 7 / 10 • Reward: Badge + 1000 pts</div>
                </div>
                
                <div class="challenge-card" style="border-left-color: #667eea;">
                    <div class="challenge-title">⭐ Perfect Week</div>
                    <div class="challenge-progress">Maintain 90%+ conversion rate this week</div>
                    <div class="challenge-bar">
                        <div class="challenge-fill" style="width: 92%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                    <div class="challenge-reward">Current: 92% • Reward: +1000 pts + Badge</div>
                </div>
                
                <div class="panel-header" style="margin-top: 20px;">⚡ Flash Challenges</div>
                
                <div class="proximity-alert">
                    <div class="alert-title">🔥 ACTIVE NOW: Next 10 Health Leads = TRIPLE POINTS!</div>
                    <div class="alert-text">Time remaining: 12 minutes</div>
                </div>
            </div>
        </div>
        
        <!-- BOTTOM NAVIGATION -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchScreen('home')">
                <div class="nav-icon">🏠</div>
                <div>Home</div>
            </div>
            <div class="nav-item" onclick="switchScreen('news')">
                <div class="nav-icon">📰</div>
                <div>News</div>
            </div>
            <div class="nav-item" onclick="switchScreen('heatmap')">
                <div class="nav-icon">🗺️</div>
                <div>Map</div>
            </div>
            <div class="nav-item" onclick="switchScreen('rankings')">
                <div class="nav-icon">🏆</div>
                <div>Ranks</div>
            </div>
            <div class="nav-item" onclick="switchScreen('squad')">
                <div class="nav-icon">👥</div>
                <div>Squad</div>
            </div>
            <div class="nav-item" onclick="switchScreen('challenges')">
                <div class="nav-icon">🎯</div>
                <div>Goals</div>
            </div>
        </div>
        
        <!-- FLOATING ACTION BUTTON -->
        <div class="floating-menu">
            <div class="fab" onclick="switchScreen('profile')">👤</div>
        </div>
    </div>
    
    <script>
        function switchScreen(screen) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
            });
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected screen
            const screenMap = {
                'home': 'home-screen',
                'news': 'news-screen',
                'heatmap': 'heatmap-screen',
                'rankings': 'rankings-screen',
                'squad': 'squad-screen',
                'challenges': 'challenges-screen',
                'profile': 'profile-screen',
                'achievements': 'achievements-screen'
            };

            document.getElementById(screenMap[screen]).classList.add('active');

            // Add active to nav item if it's a main nav screen
            if (['home', 'news', 'heatmap', 'rankings', 'squad', 'challenges'].includes(screen)) {
                const navItems = document.querySelectorAll('.nav-item');
                const navMap = {
                    'home': 0,
                    'news': 1,
                    'heatmap': 2,
                    'rankings': 3,
                    'squad': 4,
                    'challenges': 5
                };
                navItems[navMap[screen]].classList.add('active');
            }

            // If switching to news screen, render news
            if (screen === 'news') {
                renderNews('all');
            }
        }
        
        function viewDossier(leadId) {
            const dossierMap = {
                'chen-wei': 'dossier-chen-wei',
                'sarah-tan': 'dossier-sarah-tan'
            };

            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
            });

            document.getElementById(dossierMap[leadId]).classList.add('active');

            // Render news selector for this dossier
            setTimeout(() => {
                renderDossierNewsSelector(leadId);
            }, 100);
        }
        
        function grabLead(leadName) {
            showToast(`✅ Lead grabbed: ${leadName}! +150 points`);
            setTimeout(() => {
                switchScreen('home');
            }, 1500);
        }
        
        function startCall(leadName) {
            // Set currentLead based on the lead name
            if (leadName === 'Chen Wei') {
                currentLead = 'chen-wei';
            } else if (leadName === 'Sarah Tan') {
                currentLead = 'sarah-tan';
            }
            
            // Set up the call screen
            document.getElementById('call-lead-name').textContent = `Call with ${leadName}`;
            
            // Switch to call screen
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('live-call-screen').classList.add('active');
            
            // Start call timer
            startCallTimer();
            
            // Simulate live transcription updates
            setTimeout(() => simulateTranscription(), 3000);
            
            showToast(`📞 Calling ${leadName}...`);
        }
        
        let callSeconds = 0;
        let callTimerInterval;
        
        function startCallTimer() {
            callSeconds = 0;
            callTimerInterval = setInterval(() => {
                callSeconds++;
                const minutes = Math.floor(callSeconds / 60);
                const seconds = callSeconds % 60;
                const timerElement = document.getElementById('call-timer');
                if (timerElement) {
                    timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        function simulateTranscription() {
            const transcriptionLog = document.getElementById('transcription-log');
            if (!transcriptionLog) return;
            
            const conversations = [
                { speaker: 'Chen Wei', text: 'So how much would this cost me monthly?', action: 'Handle pricing question', sentiment: { interest: 80, concern: 40 } },
                { speaker: 'You', text: '$1,200 per month, but with the $7K tax relief, your effective cost is just $933 monthly.', action: '', sentiment: null },
                { speaker: 'Chen Wei', text: "That's quite a bit. What if I lose my job?", action: 'Objection: Financial security concern', sentiment: { interest: 70, concern: 60 } },
                { speaker: 'You', text: 'Great question! The policy has a premium holiday feature after year 3 if your fund value is sufficient to cover charges.', action: '', sentiment: null },
                { speaker: 'Chen Wei', text: 'Interesting. And how does this compare to just investing on my own?', action: 'Reframe: ILP vs DIY investing', sentiment: { interest: 85, concern: 35 } }
            ];
            
            let index = 0;
            
            const addTranscription = setInterval(() => {
                if (index >= conversations.length) {
                    clearInterval(addTranscription);
                    return;
                }
                
                const conv = conversations[index];
                const isCustomer = conv.speaker !== 'You';
                
                transcriptionLog.innerHTML += `
                    <div style="margin-bottom: 10px; padding: 10px; background: ${isCustomer ? '#e7f3ff' : '#f8f9fa'}; border-radius: 8px;">
                        <strong style="color: ${isCustomer ? '#0066cc' : '#667eea'};">${conv.speaker}:</strong> ${conv.text}
                    </div>
                `;
                
                transcriptionLog.scrollTop = transcriptionLog.scrollHeight;
                
                // Update next best action if provided
                if (conv.action) {
                    updateNextAction(conv.action, conv.text);
                }
                
                // Update sentiment if provided
                if (conv.sentiment) {
                    updateSentiment(conv.sentiment.interest, conv.sentiment.concern);
                }
                
                // Check for objections
                if (conv.text.includes('lose my job') || conv.text.includes('expensive') || conv.text.includes('quite a bit')) {
                    showObjectionAlert(conv.text);
                }
                
                index++;
            }, 5000);
        }
        
        function updateNextAction(action, customerText) {
            const nextActionElement = document.getElementById('next-action');
            if (!nextActionElement) return;
            
            const actions = {
                'Handle pricing question': '<strong>Recommended:</strong> Break down the value: "After tax relief, it\'s $933/mo - just 6.2% of your income for $500K coverage plus investment growth. Compare that to pure term life ($85) + separate investing (0.5-1% fees)."',
                'Objection: Financial security concern': '<strong>Recommended:</strong> Acknowledge concern, then reassure: "I understand - job security is important. That\'s why we have the premium holiday feature AND you can make partial withdrawals from year 3 if needed. Your investment is accessible."',
                'Reframe: ILP vs DIY investing': '<strong>Recommended:</strong> Use differentiation angle: "Great comparison! DIY investing gives you 0% life coverage. ILPs combine both - you\'re essentially getting insurance at cost while your money grows. Plus, tax-deferred growth and $7K relief you don\'t get from normal investing."'
            };
            
            nextActionElement.innerHTML = actions[action] || nextActionElement.innerHTML;
        }
        
        function updateSentiment(interest, concern) {
            const interestBar = document.getElementById('interest-bar');
            const concernBar = document.getElementById('concern-bar');
            const interestPercent = document.getElementById('interest-percent');
            const concernPercent = document.getElementById('concern-percent');
            
            if (interestBar) {
                interestBar.style.width = `${interest}%`;
            }
            
            if (interestPercent) {
                interestPercent.textContent = `${interest}%`;
            }
            
            if (concernBar) {
                concernBar.style.width = `${concern}%`;
            }
            
            if (concernPercent) {
                concernPercent.textContent = `${concern}%`;
            }
        }
        
        function showObjectionAlert(objectionText) {
            const alert = document.getElementById('objection-alert');
            const alertText = document.getElementById('objection-text');
            
            if (alert && alertText) {
                alert.style.display = 'block';
                alertText.textContent = `Customer expressed: "${objectionText}". Recommended approach: Acknowledge → Empathize → Reframe with specific benefit.`;
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 8000);
            }
        }
        
        function endCall() {
            clearInterval(callTimerInterval);
            const duration = `${Math.floor(callSeconds / 60)}:${String(callSeconds % 60).padStart(2, '0')}`;
            
            // Update summary screen with call details
            const summaryElement = document.getElementById('summary-lead-name');
            if (summaryElement) {
                const leadName = currentLead === 'chen-wei' ? 'Chen Wei' : 'Sarah Tan';
                summaryElement.textContent = `${leadName} • ${duration} duration`;
            }
            
            // Show call summary screen instead of going back immediately
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('call-summary-screen').classList.add('active');
            
            showToast(`✅ Call ended. Analyzing conversation...`);
        }
        
        function saveCallInsights() {
            showToast('✅ Insights saved! Lead profile updated to "Warm (85%)"');
            
            // Return to the appropriate dossier
            setTimeout(() => {
                if (currentLead === 'chen-wei') {
                    viewDossier('chen-wei');
                } else if (currentLead === 'sarah-tan') {
                    viewDossier('sarah-tan');
                } else {
                    switchScreen('home');
                }
            }, 1000);
        }
        
        function backToDossierFromSummary() {
            // Allow going back without saving if user wants to review
            if (currentLead === 'chen-wei') {
                viewDossier('chen-wei');
            } else if (currentLead === 'sarah-tan') {
                viewDossier('sarah-tan');
            } else {
                switchScreen('home');
            }
        }
        
        // Live Chat Functions
        function openLiveChat() {
            try {
                // Hide all screens first
                const allScreens = document.querySelectorAll('.screen');
                allScreens.forEach(s => s.classList.remove('active'));
                
                // Find and show the live chat screen
                const chatScreen = document.getElementById('live-chat-queue-screen');
                
                if (!chatScreen) {
                    alert('Live Chat screen not found. Please refresh the page (Ctrl+Shift+R or Cmd+Shift+R)');
                    return;
                }
                
                chatScreen.classList.add('active');
            } catch (error) {
                alert('Error opening Live Chat: ' + error.message + '. Please refresh the page.');
            }
        }
        
        function backToHome() {
            try {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const homeScreen = document.getElementById('home-screen');
                if (homeScreen) {
                    homeScreen.classList.add('active');
                    // Reactivate home nav
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    const navItems = document.querySelectorAll('.nav-item');
                    if (navItems[0]) navItems[0].classList.add('active');
                }
            } catch (error) {
                alert('Error going back to home: ' + error.message);
            }
        }
        
        function backToChatQueue() {
            try {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const queueScreen = document.getElementById('live-chat-queue-screen');
                if (queueScreen) {
                    queueScreen.classList.add('active');
                }
            } catch (error) {
                alert('Error going back to queue: ' + error.message);
            }
        }
        
        function openConversationPractice(lead) {
            currentLead = lead;
            const leadNames = {
                'chen': 'Chen Wei',
                'sarah': 'Sarah Tan'
            };
            
            try {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                
                const practiceScreen = document.getElementById('conversation-practice-screen');
                if (practiceScreen) {
                    practiceScreen.classList.add('active');
                    
                    const nameElement = document.getElementById('lead-name-practice');
                    if (nameElement) {
                        nameElement.textContent = leadNames[lead] || 'this lead';
                    }
                } else {
                    alert('Conversation practice screen not found. Please refresh the page.');
                }
            } catch (error) {
                alert('Error opening conversation practice: ' + error.message);
            }
        }
        
        function startScenario(scenario) {
            conversationTurn = 1;
            const scenarios = {
                'opening': 'Opening Call Practice',
                'objection-price': 'Handling "Too Expensive"',
                'objection-think': 'Handling "Need To Think"',
                'objection-spouse': 'Handling "Discuss With Spouse"',
                'closing': 'Closing The Deal'
            };
            
            try {
                document.getElementById('scenario-title').textContent = scenarios[scenario];
                document.getElementById('conversation-lead-name').textContent = currentLead === 'sarah' ? 'Sarah Tan' : 'Chen Wei';
                
                const conversationLog = document.getElementById('conversation-log');
                conversationLog.innerHTML = '<div class="region-card" style="background: #f8f9fa;"><div style="font-size: 13px; color: #666; line-height: 1.6;"><strong>Customer:</strong> "Hello? Who is this?"</div></div>';
                
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('active-conversation-screen').classList.add('active');
            } catch (error) {
                alert('Error starting scenario: ' + error.message);
            }
        }
        
        function sendResponse() {
            const input = document.getElementById('agent-response');
            if (!input) {
                showToast('⚠️ Error: Input field not found');
                return;
            }
            
            const response = input.value.trim();
            
            if (!response) {
                showToast('⚠️ Please type a response first');
                return;
            }
            
            const conversationLog = document.getElementById('conversation-log');
            if (!conversationLog) {
                showToast('⚠️ Error: Conversation log not found');
                return;
            }
            
            // Add agent response
            conversationLog.innerHTML += `<div class="region-card" style="background: #e7f3ff; margin-top: 10px;"><div style="font-size: 13px; color: #495057; line-height: 1.6;"><strong>You:</strong> "${response}"</div></div>`;
            
            // Simulate customer response based on conversation turn
            setTimeout(() => {
                const customerResponses = [
                    { text: "That sounds interesting. Tell me more about the coverage details.", coaching: "Good! Customer is engaged. Now provide specific coverage details. Score: 7/10" },
                    { text: "I see. But how much does this actually cost per month?", coaching: "Price question! Break down the cost clearly and emphasize value. Score: 8/10" },
                    { text: "That's quite expensive. Can we make it cheaper somehow?", coaching: "Objection detected! Acknowledge concern, then reframe with benefits. Don't discount immediately. Score: 7.5/10" },
                    { text: "What if I lose my job? Can I still afford this?", coaching: "Financial security concern. Highlight premium holiday feature and flexibility. Score: 8/10" },
                    { text: "Interesting. How does this compare to what I can get from other companies?", coaching: "Comparison question! Use competitive advantages - lower fees, better features. Score: 8.5/10" },
                    { text: "I need to discuss this with my spouse before deciding.", coaching: "Common objection. Offer to schedule a call with both. Don't push too hard. Score: 7/10" },
                    { text: "Can you send me some information to review?", coaching: "Great! Customer wants details. Send materials and schedule follow-up. Score: 9/10" },
                    { text: "Okay, I think I'm interested. What are the next steps?", coaching: "Buying signal! Explain application process and book appointment. Score: 9.5/10" }
                ];
                
                if (conversationTurn >= customerResponses.length) {
                    conversationLog.innerHTML += `<div class="region-card" style="background: #d4edda; margin-top: 10px; border: 2px solid #28a745;"><div style="font-size: 13px; color: #155724; line-height: 1.6; text-align: center;"><strong>🎉 Practice Complete!</strong><br>Great job! You handled the conversation well. Final Score: 8.5/10<br><button onclick="backToDossierFromPractice()" style="margin-top: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer;">Back to Dossier</button></div></div>`;
                    conversationLog.scrollTop = conversationLog.scrollHeight;
                    return;
                }
                
                const currentResponse = customerResponses[conversationTurn];
                
                conversationLog.innerHTML += `<div class="region-card" style="background: #f8f9fa; margin-top: 10px;"><div style="font-size: 13px; color: #666; line-height: 1.6;"><strong>Customer:</strong> "${currentResponse.text}"</div></div>`;
                
                // Add coaching feedback
                conversationLog.innerHTML += `<div class="proximity-alert" style="margin-top: 10px;"><div class="alert-title">🤖 Megatron Coach</div><div class="alert-text">${currentResponse.coaching}</div></div>`;
                
                conversationLog.scrollTop = conversationLog.scrollHeight;
                conversationTurn++;
            }, 1500);
            
            input.value = '';
            conversationLog.scrollTop = conversationLog.scrollHeight;
        }
        
        function backToDossierFromPractice() {
            if (currentLead === 'chen-wei') {
                viewDossier('chen-wei');
            } else if (currentLead === 'sarah-tan') {
                viewDossier('sarah-tan');
            } else {
                switchScreen('home');
            }
        }
        
        function useSuggestedResponse(num) {
            const input = document.getElementById('agent-response');
            if (!input) {
                showToast('⚠️ Error: Input field not available');
                return;
            }
            
            const suggestions = {
                1: "Hi! This is [Your Name] from AIA. I noticed you've been researching health insurance options. I'd love to share how we can help protect your family. Do you have 5 minutes?",
                2: "I understand cost is a concern. Let me break down the value: this plan costs less than $15/day per person, but one serious illness could cost $50,000+ out of pocket without insurance. Which makes more sense financially?"
            };
            input.value = suggestions[num] || suggestions[1];
        }
        
        function getMegatronHelp() {
            const conversationLog = document.getElementById('conversation-log');
            if (!conversationLog) {
                showToast('⚠️ Error: Conversation log not found');
                return;
            }
            
            const hints = [
                "Try acknowledging their concern first, then reframe with a specific benefit that addresses their worry. Use their name to build rapport.",
                "Focus on asking open-ended questions to understand their needs better. What's their biggest concern about insurance?",
                "Break down complex information into simple terms. Avoid jargon. Use analogies they can relate to.",
                "Create urgency without being pushy. Mention premium increases with age or limited-time offers.",
                "Use the 'Feel, Felt, Found' technique: 'I understand how you feel. Others felt the same way. What they found was...'",
                "Listen for buying signals: questions about process, asking for details, discussing budget. When you hear them, move toward closing.",
                "If they're hesitant, try the assumptive close: 'When would be a good time to start your coverage?' instead of 'Do you want to buy?'"
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            
            conversationLog.innerHTML += `
                <div class="proximity-alert" style="margin-top: 10px; border-left-color: #667eea; background: linear-gradient(135deg, #e7f3ff 0%, #fff 100%);">
                    <div class="alert-title" style="color: #667eea;">💡 Megatron Hint</div>
                    <div class="alert-text" style="color: #495057;">${randomHint}</div>
                </div>
            `;
            
            conversationLog.scrollTop = conversationLog.scrollHeight;
        }
        
        function backToPracticeMenu() {
            try {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const practiceScreen = document.getElementById('conversation-practice-screen');
                if (practiceScreen) {
                    practiceScreen.classList.add('active');
                } else {
                    alert('Practice screen not found. Returning to dossier.');
                    backToDossierFromPractice();
                }
            } catch (error) {
                alert('Error going back: ' + error.message);
            }
        }
        
        function returnToScenarioSelection() {
            // Completely new function name to bypass cache
            const allScreens = document.querySelectorAll('.screen');
            allScreens.forEach(function(screen) {
                screen.classList.remove('active');
            });
            
            const scenarioScreen = document.getElementById('conversation-practice-screen');
            if (scenarioScreen) {
                scenarioScreen.classList.add('active');
            } else {
                // Fallback - go back to dossier
                if (currentLead === 'chen-wei') {
                    viewDossier('chen-wei');
                } else if (currentLead === 'sarah-tan') {
                    viewDossier('sarah-tan');
                } else {
                    const homeScreen = document.getElementById('home-screen');
                    if (homeScreen) homeScreen.classList.add('active');
                }
            }
        }
        
        function returnToDossierFromProducts() {
            // Navigate back to the appropriate dossier
            const allScreens = document.querySelectorAll('.screen');
            allScreens.forEach(function(screen) {
                screen.classList.remove('active');
            });
            
            if (currentLead === 'chen-wei') {
                const dossier = document.getElementById('dossier-chen-wei');
                if (dossier) dossier.classList.add('active');
            } else if (currentLead === 'sarah-tan') {
                const dossier = document.getElementById('dossier-sarah-tan');
                if (dossier) dossier.classList.add('active');
            } else {
                const homeScreen = document.getElementById('home-screen');
                if (homeScreen) homeScreen.classList.add('active');
            }
        }
        
        function returnToDossierFromConversation() {
            // Navigate back to the appropriate dossier
            const allScreens = document.querySelectorAll('.screen');
            allScreens.forEach(function(screen) {
                screen.classList.remove('active');
            });
            
            if (currentLead === 'chen-wei' || currentLead === 'chen') {
                const dossier = document.getElementById('dossier-chen-wei');
                if (dossier) dossier.classList.add('active');
            } else if (currentLead === 'sarah-tan' || currentLead === 'sarah') {
                const dossier = document.getElementById('dossier-sarah-tan');
                if (dossier) dossier.classList.add('active');
            } else {
                const homeScreen = document.getElementById('home-screen');
                if (homeScreen) homeScreen.classList.add('active');
            }
        }
        
        function acceptChat(customerId) {
            const names = {
                'melissa': 'Melissa Wong',
                'david': 'David Lim',
                'anonymous': 'Anonymous User'
            };
            
            document.getElementById('chat-customer-name').textContent = `Chat with ${names[customerId] || 'Customer'}`;
            
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('active-live-chat-screen').classList.add('active');
            
            showToast(`✅ Chat accepted! You're now chatting with ${names[customerId]}`);
        }
        
        function transferChat(customerId) {
            showToast('📤 Transfer request sent to available agents...');
        }
        
        function sendChatMessage() {
            const input = document.getElementById('live-chat-input');
            if (!input || !input.value.trim()) {
                showToast('⚠️ Please type a message first');
                return;
            }
            
            const message = input.value.trim();
            const chatLog = document.getElementById('live-chat-log');
            
            if (chatLog) {
                chatLog.innerHTML += `
                    <div style="margin-bottom: 12px; display: flex; justify-content: flex-end;">
                        <div style="max-width: 80%;">
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px; text-align: right;">You</div>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 12px; font-size: 14px;">
                                ${message}
                            </div>
                        </div>
                    </div>
                `;
                chatLog.scrollTop = chatLog.scrollHeight;
            }
            
            input.value = '';
            
            // Simulate customer response
            setTimeout(() => {
                simulateCustomerResponse();
            }, 2000);
        }
        
        function simulateCustomerResponse() {
            const chatLog = document.getElementById('live-chat-log');
            if (!chatLog) return;
            
            const responses = [
                "That sounds good. Can you send me more details?",
                "What about pre-existing conditions?",
                "Is there a waiting period?",
                "Can I get a quote in writing?",
                "Thanks! This is very helpful."
            ];
            
            const response = responses[Math.floor(Math.random() * responses.length)];
            
            chatLog.innerHTML += `
                <div style="margin-bottom: 12px;">
                    <div style="font-size: 11px; color: #666; margin-bottom: 4px;">Customer</div>
                    <div style="background: white; padding: 12px; border-radius: 12px; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); max-width: 80%;">
                        ${response}
                    </div>
                </div>
            `;
            chatLog.scrollTop = chatLog.scrollHeight;
        }
        
        function useChatTemplate(type) {
            const input = document.getElementById('live-chat-input');
            if (!input) return;
            
            const templates = {
                'intro': "Hi! I'm Sarah from AIA. I'd be happy to help you with your insurance needs. What questions can I answer for you?",
                'quote': "I can prepare a personalized quote for you. Let me gather a few details..."
            };
            
            input.value = templates[type] || '';
        }
        
        function convertToLead() {
            showToast('✅ Customer converted to lead! Creating profile...');
            setTimeout(() => {
                showToast('💡 Lead "Melissa Wong" added to marketplace with 85% propensity score');
                switchScreen('home');
            }, 2000);
        }
        
        // Keyboard support for chat
        document.addEventListener('keypress', function(e) {
            if (e.target && e.target.id === 'live-chat-input' && e.key === 'Enter') {
                e.preventDefault();
                sendChatMessage();
            }
        });
        
        function quickAction(action) {
            const actions = {
                'send-doc': '📄 Brochure sent via email!',
                'quote': '💰 Quote generated and shared on screen',
                'compare': '📊 Comparison chart sent to customer',
                'schedule': '📅 Follow-up meeting scheduled for tomorrow 3 PM'
            };
            showToast(actions[action] || 'Action completed');
        }
        
        function peekLead() {
            showToast('👁️ Lead peeked! -50 points. 60 seconds to decide.');
        }
        
        function openProductSelector(lead) {
            if (lead) {
                currentLead = lead;
            }

            const leadNames = {
                'chen': 'Chen Wei',
                'chen-wei': 'Chen Wei',
                'sarah': 'Sarah Tan',
                'sarah-tan': 'Sarah Tan'
            };

            const nameElement = document.getElementById('lead-name-selector');
            if (nameElement) {
                nameElement.textContent = leadNames[currentLead] || leadNames[lead] || 'this lead';
            }

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('product-selector-screen').classList.add('active');
        }

        function showProductCategory(category) {
            const categories = {
                'ilp': {
                    title: '💰 Investment-Linked Plans (ILP)',
                    products: [
                        {
                            name: 'WealthBuilder Plus ILP',
                            premium: '$1,200/mo',
                            highlights: ['100 fund choices', '1.2% management fee', '$500K sum assured', 'Flexible premium payment'],
                            match: 95,
                            recommended: true
                        },
                        {
                            name: 'WealthMax ILP',
                            premium: '$1,150/mo',
                            highlights: ['80 fund choices', '1.5% management fee', '$450K sum assured', 'Lower initial premium'],
                            match: 85
                        },
                        {
                            name: 'FutureSecure ILP',
                            premium: '$1,280/mo',
                            highlights: ['120 fund choices', '1.3% management fee', '$550K sum assured', 'Premium features'],
                            match: 82
                        }
                    ]
                },
                'health': {
                    title: '🏥 Health Insurance',
                    products: [
                        {
                            name: 'HealthShield Gold Plus',
                            premium: '$450/mo',
                            highlights: ['Private/A1 ward', 'Unlimited annual limit', 'Family coverage', 'Zero co-payment'],
                            match: 92,
                            recommended: true
                        },
                        {
                            name: 'MediCare Premium',
                            premium: '$380/mo',
                            highlights: ['B1 ward', '$300K annual limit', 'Individual coverage', '10% co-payment'],
                            match: 78
                        },
                        {
                            name: 'HealthGuard Plus',
                            premium: '$520/mo',
                            highlights: ['Private ward', 'Unlimited coverage', 'Includes dental/optical', 'Global coverage'],
                            match: 85
                        }
                    ]
                },
                'term': {
                    title: '🛡️ Term Life Insurance',
                    products: [
                        {
                            name: 'TermShield Max',
                            premium: '$120/mo',
                            highlights: ['$1M coverage', 'To age 65', 'Renewable', 'Convertible to whole life'],
                            match: 88
                        },
                        {
                            name: 'LifeGuard Term',
                            premium: '$95/mo',
                            highlights: ['$750K coverage', 'To age 60', 'Basic protection', 'Affordable'],
                            match: 75
                        },
                        {
                            name: 'FamilyProtect Term',
                            premium: '$150/mo',
                            highlights: ['$1.2M coverage', 'To age 70', 'Includes CI rider', 'Premium freeze option'],
                            match: 82
                        }
                    ]
                },
                'whole': {
                    title: '♾️ Whole Life Insurance',
                    products: [
                        {
                            name: 'Lifetime Protect Plus',
                            premium: '$450/mo',
                            highlights: ['$300K sum assured', 'Guaranteed bonuses', 'Cash value buildup', 'Lifetime coverage'],
                            match: 80
                        },
                        {
                            name: 'WholeLife Premium',
                            premium: '$520/mo',
                            highlights: ['$400K sum assured', 'Participating policy', 'Higher bonuses', 'Premium for 20 years'],
                            match: 83
                        }
                    ]
                },
                'ci': {
                    title: '💊 Critical Illness Insurance',
                    products: [
                        {
                            name: 'CI Shield Complete',
                            premium: '$180/mo',
                            highlights: ['$200K lump sum', '100 conditions covered', 'Early stage coverage', 'Multiple claim benefit'],
                            match: 86
                        },
                        {
                            name: 'CriticalCare Plus',
                            premium: '$150/mo',
                            highlights: ['$150K lump sum', '85 conditions', 'Standard coverage', 'Premium waiver'],
                            match: 78
                        }
                    ]
                },
                'savings': {
                    title: '🏦 Savings Plans',
                    products: [
                        {
                            name: 'SaveMax Endowment',
                            premium: '$500/mo',
                            highlights: ['3.5% guaranteed returns', 'Non-participating', '15 year term', 'Predictable maturity'],
                            match: 75
                        },
                        {
                            name: 'WealthGrow Savings',
                            premium: '$600/mo',
                            highlights: ['2.5% guaranteed + bonuses', 'Participating policy', '20 year term', 'Higher potential'],
                            match: 81
                        }
                    ]
                },
                'retirement': {
                    title: '🏖️ Retirement/Annuity Plans',
                    products: [
                        {
                            name: 'RetireSecure Annuity',
                            premium: '$800/mo',
                            highlights: ['$2,500/mo from age 65', 'Guaranteed lifetime income', 'Inflation protection', 'Spouse continuation'],
                            match: 70
                        },
                        {
                            name: 'GoldenYears Plan',
                            premium: '$650/mo',
                            highlights: ['$2,000/mo from age 65', 'For 20 years', 'Lower premium', 'Fixed term payout'],
                            match: 68
                        }
                    ]
                },
                'education': {
                    title: '🎓 Education Plans',
                    products: [
                        {
                            name: 'SmartKids Education',
                            premium: '$350/mo',
                            highlights: ['$100K at age 18', 'Guaranteed payouts', 'Payor benefit included', '15 year term'],
                            match: 82
                        },
                        {
                            name: 'FutureScholar Plan',
                            premium: '$420/mo',
                            highlights: ['$130K at age 18', 'Milestone payouts', 'University coverage', 'Overseas study benefit'],
                            match: 85
                        }
                    ]
                }
            };

            const categoryData = categories[category];
            if (!categoryData) return;

            document.getElementById('category-title').textContent = categoryData.title;

            const container = document.getElementById('product-list-container');
            container.innerHTML = '';

            categoryData.products.forEach(product => {
                const productCard = `
                    <div class="product-card" style="margin-bottom: 15px; ${product.recommended ? 'border: 3px solid #667eea;' : ''}">
                        ${product.recommended ? '<div style="background: #667eea; color: white; padding: 8px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 13px;">⭐ RECOMMENDED FOR THIS LEAD</div>' : ''}

                        <div class="product-header">
                            <div class="product-name">${product.name}</div>
                            <div class="product-premium">${product.premium}</div>
                        </div>

                        <div style="margin: 12px 0;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <div style="font-weight: 600; color: #1a1a2e;">Match Score:</div>
                                <div style="flex: 1; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: ${product.match}%;"></div>
                                </div>
                                <div style="font-weight: 700; color: #667eea;">${product.match}%</div>
                            </div>
                        </div>

                        <div style="margin: 12px 0;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">Key Features:</div>
                            ${product.highlights.map(h => `<div style="font-size: 13px; color: #495057; margin-bottom: 4px; padding-left: 8px;">• ${h}</div>`).join('')}
                        </div>

                        <button onclick="selectProduct('${product.name}')" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px;">
                            Select This Product
                        </button>
                    </div>
                `;
                container.innerHTML += productCard;
            });

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('product-category-screen').classList.add('active');
        }

        function selectProduct(productName) {
            showToast(`✅ ${productName} selected! Product details saved to dossier.`);
            setTimeout(() => {
                returnToDossierFromProducts();
            }, 1500);
        }

        let recommendedCategory = 'ilp'; // Track which category to view

        function askMegatronRecommendation() {
            const leadProfiles = {
                'chen': {
                    name: 'Chen Wei',
                    analysis: 'Chen Wei is a 38-year-old investment banker earning $15K/month with no dependents. His primary focus is wealth accumulation while maintaining protection. His financial literacy and high income make him ideal for investment-linked products combined with comprehensive health coverage.',
                    priorities: [
                        { priority: 'HIGH', label: 'Wealth Accumulation', reason: 'High disposable income, 20-30 year growth horizon' },
                        { priority: 'HIGH', label: 'Tax Optimization', reason: 'Can maximize $7K annual tax relief benefits' },
                        { priority: 'MEDIUM', label: 'Health Protection', reason: 'Banking sector stress, should secure coverage now' }
                    ],
                    recommendations: [
                        {
                            rank: 1,
                            category: 'ilp',
                            name: 'WealthBuilder Plus ILP',
                            premium: '$1,200/mo',
                            rationale: 'Perfect match for wealth accumulation phase. Combines insurance protection with investment growth. His financial background means he\'ll appreciate fund flexibility and transparency.',
                            keyBenefits: ['Tax-deferred growth', '$7K annual tax relief', '100 fund choices', '$500K protection'],
                            urgency: 'Lock in insurability before life events or health changes'
                        },
                        {
                            rank: 2,
                            category: 'health',
                            name: 'HealthShield Gold Plus',
                            premium: '$280/mo (individual)',
                            rationale: 'Banking sector stress makes health coverage crucial. Private hospital access without co-payment. Secure now while healthy and premiums are low.',
                            keyBenefits: ['Private/A1 ward', 'Unlimited coverage', 'Zero co-payment', 'Emergency coverage'],
                            urgency: 'Premiums increase with age - lock in now'
                        },
                        {
                            rank: 3,
                            category: 'ci',
                            name: 'CI Shield Complete',
                            premium: '$180/mo',
                            rationale: 'Additional safety net for critical illness. Lump sum payout allows focus on recovery without financial stress.',
                            keyBenefits: ['$200K lump sum', '100 conditions', 'Early stage coverage', 'Multiple claims'],
                            urgency: 'Consider as add-on to comprehensive protection'
                        }
                    ],
                    alternatives: 'If budget is a concern, consider starting with WealthBuilder Plus ILP alone ($1,200/mo) and adding health coverage within 6 months. However, the complete package ($1,660/mo) represents only 11% of gross income - well within recommended 15-20% allocation for protection and savings.',
                    totalMonthly: '$1,660',
                    totalAnnual: '$19,920',
                    afterTaxRelief: '$1,077/mo effective cost',
                    recommendedCategory: 'ilp'
                },
                'chen-wei': {
                    name: 'Chen Wei',
                    analysis: 'Chen Wei is a 38-year-old investment banker earning $15K/month with no dependents. His primary focus is wealth accumulation while maintaining protection. His financial literacy and high income make him ideal for investment-linked products combined with comprehensive health coverage.',
                    priorities: [
                        { priority: 'HIGH', label: 'Wealth Accumulation', reason: 'High disposable income, 20-30 year growth horizon' },
                        { priority: 'HIGH', label: 'Tax Optimization', reason: 'Can maximize $7K annual tax relief benefits' },
                        { priority: 'MEDIUM', label: 'Health Protection', reason: 'Banking sector stress, should secure coverage now' }
                    ],
                    recommendations: [
                        {
                            rank: 1,
                            category: 'ilp',
                            name: 'WealthBuilder Plus ILP',
                            premium: '$1,200/mo',
                            rationale: 'Perfect match for wealth accumulation phase. Combines insurance protection with investment growth. His financial background means he\'ll appreciate fund flexibility and transparency.',
                            keyBenefits: ['Tax-deferred growth', '$7K annual tax relief', '100 fund choices', '$500K protection'],
                            urgency: 'Lock in insurability before life events or health changes'
                        },
                        {
                            rank: 2,
                            category: 'health',
                            name: 'HealthShield Gold Plus',
                            premium: '$280/mo (individual)',
                            rationale: 'Banking sector stress makes health coverage crucial. Private hospital access without co-payment. Secure now while healthy and premiums are low.',
                            keyBenefits: ['Private/A1 ward', 'Unlimited coverage', 'Zero co-payment', 'Emergency coverage'],
                            urgency: 'Premiums increase with age - lock in now'
                        },
                        {
                            rank: 3,
                            category: 'ci',
                            name: 'CI Shield Complete',
                            premium: '$180/mo',
                            rationale: 'Additional safety net for critical illness. Lump sum payout allows focus on recovery without financial stress.',
                            keyBenefits: ['$200K lump sum', '100 conditions', 'Early stage coverage', 'Multiple claims'],
                            urgency: 'Consider as add-on to comprehensive protection'
                        }
                    ],
                    alternatives: 'If budget is a concern, consider starting with WealthBuilder Plus ILP alone ($1,200/mo) and adding health coverage within 6 months. However, the complete package ($1,660/mo) represents only 11% of gross income - well within recommended 15-20% allocation for protection and savings.',
                    totalMonthly: '$1,660',
                    totalAnnual: '$19,920',
                    afterTaxRelief: '$1,077/mo effective cost',
                    recommendedCategory: 'ilp'
                },
                'sarah': {
                    name: 'Sarah Tan',
                    analysis: 'Sarah Tan is a 34-year-old mother of two young children (ages 4 & 7) with combined family income of $14K/month. Her primary concern is protecting her family from medical expenses and ensuring income continuity if something happens to either parent. The family is managing a $2,200/month mortgage.',
                    priorities: [
                        { priority: 'CRITICAL', label: 'Family Health Protection', reason: 'Two young children, frequent medical needs' },
                        { priority: 'HIGH', label: 'Income Protection', reason: 'Mortgage obligations, dependent children' },
                        { priority: 'MEDIUM', label: 'Children\'s Education', reason: 'Long-term planning for university costs' }
                    ],
                    recommendations: [
                        {
                            rank: 1,
                            category: 'health',
                            name: 'HealthShield Gold Plus (Family)',
                            premium: '$450/mo',
                            rationale: 'Covers all 4 family members. Kids get sick often - this prevents choosing between child\'s health and family finances. One serious illness could cost $30K-$50K out of pocket without coverage.',
                            keyBenefits: ['All 4 members covered', 'Private hospital access', 'Unlimited coverage', 'Pediatric benefits'],
                            urgency: 'Critical - one hospitalization pays for years of premiums'
                        },
                        {
                            rank: 2,
                            category: 'term',
                            name: 'FamilyProtect Term Life',
                            premium: '$150/mo (for both parents)',
                            rationale: 'If either parent passes, family receives $1.2M - enough to pay off mortgage, fund children\'s education, and cover 5 years of living expenses. Peace of mind for $150/month.',
                            keyBenefits: ['$1.2M coverage', 'Mortgage protection', 'Education funding', 'Income replacement'],
                            urgency: 'Essential with young dependents and mortgage'
                        },
                        {
                            rank: 3,
                            category: 'education',
                            name: 'SmartKids Education Plan',
                            premium: '$350/mo',
                            rationale: 'Guaranteed $100K at age 18 for each child. Removes uncertainty about university funding. Payor benefit means premiums waived if parent becomes disabled.',
                            keyBenefits: ['$100K guaranteed', 'Payor benefit', 'Tax-deferred growth', 'University funding'],
                            urgency: 'Start early for maximum compound growth'
                        }
                    ],
                    alternatives: 'Minimum recommended: Health + Term Life ($600/mo total). This protects against the two biggest financial risks - medical bills and loss of income. Education plan can be added later, but health and life protection should not be delayed.',
                    totalMonthly: '$950',
                    totalAnnual: '$11,400',
                    afterTaxRelief: '$850/mo effective cost',
                    recommendedCategory: 'health'
                },
                'sarah-tan': {
                    name: 'Sarah Tan',
                    analysis: 'Sarah Tan is a 34-year-old mother of two young children (ages 4 & 7) with combined family income of $14K/month. Her primary concern is protecting her family from medical expenses and ensuring income continuity if something happens to either parent. The family is managing a $2,200/month mortgage.',
                    priorities: [
                        { priority: 'CRITICAL', label: 'Family Health Protection', reason: 'Two young children, frequent medical needs' },
                        { priority: 'HIGH', label: 'Income Protection', reason: 'Mortgage obligations, dependent children' },
                        { priority: 'MEDIUM', label: 'Children\'s Education', reason: 'Long-term planning for university costs' }
                    ],
                    recommendations: [
                        {
                            rank: 1,
                            category: 'health',
                            name: 'HealthShield Gold Plus (Family)',
                            premium: '$450/mo',
                            rationale: 'Covers all 4 family members. Kids get sick often - this prevents choosing between child\'s health and family finances. One serious illness could cost $30K-$50K out of pocket without coverage.',
                            keyBenefits: ['All 4 members covered', 'Private hospital access', 'Unlimited coverage', 'Pediatric benefits'],
                            urgency: 'Critical - one hospitalization pays for years of premiums'
                        },
                        {
                            rank: 2,
                            category: 'term',
                            name: 'FamilyProtect Term Life',
                            premium: '$150/mo (for both parents)',
                            rationale: 'If either parent passes, family receives $1.2M - enough to pay off mortgage, fund children\'s education, and cover 5 years of living expenses. Peace of mind for $150/month.',
                            keyBenefits: ['$1.2M coverage', 'Mortgage protection', 'Education funding', 'Income replacement'],
                            urgency: 'Essential with young dependents and mortgage'
                        },
                        {
                            rank: 3,
                            category: 'education',
                            name: 'SmartKids Education Plan',
                            premium: '$350/mo',
                            rationale: 'Guaranteed $100K at age 18 for each child. Removes uncertainty about university funding. Payor benefit means premiums waived if parent becomes disabled.',
                            keyBenefits: ['$100K guaranteed', 'Payor benefit', 'Tax-deferred growth', 'University funding'],
                            urgency: 'Start early for maximum compound growth'
                        }
                    ],
                    alternatives: 'Minimum recommended: Health + Term Life ($600/mo total). This protects against the two biggest financial risks - medical bills and loss of income. Education plan can be added later, but health and life protection should not be delayed.',
                    totalMonthly: '$950',
                    totalAnnual: '$11,400',
                    afterTaxRelief: '$850/mo effective cost',
                    recommendedCategory: 'health'
                }
            };

            const profile = leadProfiles[currentLead] || leadProfiles['chen'];
            recommendedCategory = profile.recommendedCategory;

            // Set lead name
            document.getElementById('recommendation-lead-name').textContent = profile.name;

            // Set analysis text
            document.getElementById('ai-analysis-text').textContent = profile.analysis;

            // Set priorities
            const prioritiesContainer = document.getElementById('recommendation-priorities');
            prioritiesContainer.innerHTML = '';
            profile.priorities.forEach(p => {
                const priorityColors = {
                    'CRITICAL': { bg: '#dc3545', text: 'white' },
                    'HIGH': { bg: '#ffc107', text: '#664d00' },
                    'MEDIUM': { bg: '#17a2b8', text: 'white' }
                };
                const colors = priorityColors[p.priority];
                prioritiesContainer.innerHTML += `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="background: ${colors.bg}; color: ${colors.text}; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; margin-right: 10px; min-width: 70px; text-align: center;">
                            ${p.priority}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 13px; color: #1a1a2e;">${p.label}</div>
                            <div style="font-size: 12px; color: #666;">${p.reason}</div>
                        </div>
                    </div>
                `;
            });

            // Set recommended products
            const productsContainer = document.getElementById('recommended-products-container');
            productsContainer.innerHTML = '';
            profile.recommendations.forEach(rec => {
                productsContainer.innerHTML += `
                    <div class="product-card" style="margin-bottom: 15px; ${rec.rank === 1 ? 'border: 3px solid #28a745;' : ''}">
                        ${rec.rank === 1 ? '<div style="background: #28a745; color: white; padding: 8px 12px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 13px;">🏆 #1 PRIORITY RECOMMENDATION</div>' : `<div style="background: #667eea; color: white; padding: 6px 10px; border-radius: 8px; margin: -14px -14px 12px; font-weight: 600; font-size: 12px;">Recommendation #${rec.rank}</div>`}

                        <div class="product-header">
                            <div class="product-name">${rec.name}</div>
                            <div class="product-premium">${rec.premium}</div>
                        </div>

                        <div style="margin: 12px 0; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 6px; color: #1a1a2e;">🎯 Why This Product:</div>
                            <div style="font-size: 13px; line-height: 1.6; color: #495057;">${rec.rationale}</div>
                        </div>

                        <div style="margin: 12px 0;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #1a1a2e;">✨ Key Benefits:</div>
                            ${rec.keyBenefits.map(b => `<div style="font-size: 13px; color: #495057; margin-bottom: 4px; padding-left: 8px;">• ${b}</div>`).join('')}
                        </div>

                        <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px;">
                            <div style="font-size: 12px; color: #856404;">
                                <strong>⏰ Timing:</strong> ${rec.urgency}
                            </div>
                        </div>

                        <button onclick="showProductCategory('${rec.category}')" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 12px;">
                            View Similar Products
                        </button>
                    </div>
                `;
            });

            // Set alternatives
            document.getElementById('alternative-considerations').innerHTML = `
                <p style="margin-bottom: 10px;">${profile.alternatives}</p>
                <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span style="font-weight: 600;">Total Monthly Premium:</span>
                        <span style="font-weight: 700; color: #667eea;">${profile.totalMonthly}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span style="font-weight: 600;">Annual Premium:</span>
                        <span style="font-weight: 700;">${profile.totalAnnual}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 2px solid #e9ecef;">
                        <span style="font-weight: 600; color: #28a745;">After Tax Relief:</span>
                        <span style="font-weight: 700; color: #28a745;">${profile.afterTaxRelief}</span>
                    </div>
                </div>
            `;

            // Show the screen
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('ai-recommendation-screen').classList.add('active');
        }

        function viewRecommendedCategory() {
            showProductCategory(recommendedCategory);
        }

        function askMegatron() {
            openMegatronChat();
        }

        function openMegatronChat() {
            const overlay = document.getElementById('megatron-chat-overlay');
            const chatBody = document.getElementById('megatron-chat-body');

            // Clear previous messages
            chatBody.innerHTML = '';

            // Add welcome message
            const leadNames = {
                'chen': 'Chen Wei',
                'chen-wei': 'Chen Wei',
                'sarah': 'Sarah Tan',
                'sarah-tan': 'Sarah Tan'
            };
            const leadName = leadNames[currentLead] || 'this lead';

            addMegatronMessage(`Hi! I'm Megatron, your AI assistant. I have full context about ${leadName}'s profile, needs, and behavior. What would you like to know?`, true);

            // Show overlay
            overlay.classList.add('active');
        }

        function closeMegatronChat() {
            const overlay = document.getElementById('megatron-chat-overlay');
            overlay.classList.remove('active');

            // Reset live chat mode flag
            window.megatronLiveChatMode = false;
        }

        function addMegatronMessage(text, showSuggestions = false) {
            const chatBody = document.getElementById('megatron-chat-body');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'megatron-message bot';

            messageDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div>
                    <div class="message-bubble">
                        <div class="message-text">${text}</div>
                    </div>
                    ${showSuggestions ? getSuggestionChips() : ''}
                </div>
            `;

            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function addUserMessage(text) {
            const chatBody = document.getElementById('megatron-chat-body');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'megatron-message user';

            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="message-text">${text}</div>
                </div>
            `;

            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function showTypingIndicator() {
            const chatBody = document.getElementById('megatron-chat-body');

            const typingDiv = document.createElement('div');
            typingDiv.className = 'megatron-message bot';
            typingDiv.id = 'typing-indicator';

            typingDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;

            chatBody.appendChild(typingDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function getSuggestionChips() {
            const suggestions = [
                'Compare ILP products',
                'Handling objections',
                'Best opening line',
                'Price justification',
                'Alternative products'
            ];

            let html = '<div class="megatron-suggestions">';
            suggestions.forEach(s => {
                html += `<div class="suggestion-chip" onclick="askMegatronQuestion('${s}')">${s}</div>`;
            });
            html += '</div>';

            return html;
        }

        function askMegatronQuestion(question) {
            // Add user message
            addUserMessage(question);

            // Clear input if it exists
            const input = document.getElementById('megatron-input');
            if (input) {
                input.value = '';
            }

            // Show typing indicator
            showTypingIndicator();

            // Generate response after delay
            setTimeout(() => {
                removeTypingIndicator();
                const response = getMegatronResponse(question);
                addMegatronMessage(response);
            }, 1500);
        }

        function sendMegatronMessage() {
            const input = document.getElementById('megatron-input');
            const question = input.value.trim();

            if (!question) return;

            askMegatronQuestion(question);
        }

        function getMegatronResponse(question) {
            const lowerQuestion = question.toLowerCase();

            const leadContext = {
                'chen': {
                    name: 'Chen Wei',
                    income: '$15K/mo',
                    profile: 'investment banker, 38 years old, no dependents'
                },
                'chen-wei': {
                    name: 'Chen Wei',
                    income: '$15K/mo',
                    profile: 'investment banker, 38 years old, no dependents'
                },
                'sarah': {
                    name: 'Sarah Tan',
                    income: '$14K/mo (combined)',
                    profile: '34 years old, mother of 2 young children, $2,200/mo mortgage'
                },
                'sarah-tan': {
                    name: 'Sarah Tan',
                    income: '$14K/mo (combined)',
                    profile: '34 years old, mother of 2 young children, $2,200/mo mortgage'
                }
            };

            // Handle when currentLead is not defined (live chat mode)
            const context = (typeof currentLead !== 'undefined' && leadContext[currentLead]) ? leadContext[currentLead] : leadContext['chen'];

            // Live chat specific responses
            if (window.megatronLiveChatMode) {
                // What to say next
                if (lowerQuestion.includes('what') && (lowerQuestion.includes('say') || lowerQuestion.includes('next') || lowerQuestion.includes('respond'))) {
                    return `Based on Melissa asking about family coverage for 4 people, here's what to say next:<br><br><strong>Suggested response:</strong><br>"Perfect! For a family of 4 (you 34, husband 36, kids 7 and 4), the <strong>HealthShield Gold Plus Family Plan</strong> is ideal at <strong>$450/month</strong>. This gives:<br><br>✓ Unlimited coverage at ANY private hospital<br>✓ A1 ward for parents, pediatric ward for kids<br>✓ ZERO co-payment or deductibles<br>✓ Pre/post hospitalization coverage<br>✓ Maternity rider available ($60/mo extra)<br><br>Would you like me to email you a detailed quote with coverage breakdown?"`;
                }

                // Calculate quote
                if (lowerQuestion.includes('calculate') || lowerQuestion.includes('quote') || lowerQuestion.includes('pricing')) {
                    return `<strong>Quick Quote for Melissa Wong:</strong><br><br><strong>HealthShield Gold Plus Family Plan</strong><br>• Adults (34F, 36M): $280/mo<br>• Children (7, 4): $170/mo<br>• <strong>Total: $450/month</strong><br><br><strong>Optional Add-ons:</strong><br>• Maternity Coverage: +$60/mo<br>• Dental & Optical: +$40/mo<br>• Critical Illness for Kids: +$35/mo<br><br><strong>Premium Package: $585/mo</strong><br>(Includes all add-ons)<br><br>Annual: $5,400 base / $7,020 premium`;
                }

                // Handle price objection
                if (lowerQuestion.includes('handle') && lowerQuestion.includes('price')) {
                    return `<strong>Handling "$450/mo is expensive" objection:</strong><br><br><strong>1. Break it down:</strong><br>"That's just $112.50 per family member. Think about it - unlimited private hospital coverage for less than what many families spend on dining out."<br><br><strong>2. Risk comparison:</strong><br>"One hospitalization for your child could cost $30,000-$50,000. This plan pays for itself with just ONE serious illness."<br><br><strong>3. Offer flexibility:</strong><br>"If budget is tight, we have a B2 ward plan at $300/mo. But honestly, with 2 young kids, the A1/pediatric coverage gives you peace of mind worth the extra $150."<br><br><strong>4. Future-proof:</strong><br>"At 34, you lock in this rate now. Wait 5 years and the same coverage could be $600+/mo."`;
                }

                // Best product recommendation
                if (lowerQuestion.includes('product') || lowerQuestion.includes('recommend') || lowerQuestion.includes('best')) {
                    return `<strong>Best Product for Melissa:</strong><br><br><strong>HealthShield Gold Plus Family Plan</strong> ($450/mo)<br><br><strong>Why this fits:</strong><br>• She has 2 young kids (7, 4) - pediatric coverage crucial<br>• Age 34 - still eligible for maternity rider<br>• Family of 4 - family plan saves $150+/mo vs individual plans<br>• Mentioned needing "coverage" not "cheapest" - quality matters<br><br><strong>Upsell opportunity:</strong><br>Add Critical Illness for Kids rider ($35/mo). Kids' cancer treatment can cost $200K+.`;
                }

                // Closing the chat
                if (lowerQuestion.includes('close') || lowerQuestion.includes('convert')) {
                    return `<strong>How to close this chat:</strong><br><br>1. <strong>Soft close:</strong> "I can email you a detailed proposal. What's the best email to send it to?"<br><br>2. <strong>Next step:</strong> "Would you like to schedule a quick 15-min call to go through the coverage details together?"<br><br>3. <strong>Convert to lead:</strong> Click the green "Convert to Lead" button and create a formal lead in the system with her details.<br><br>4. <strong>Create urgency:</strong> "I'm seeing high volume this week. I can hold this rate for you until Friday if you'd like to move forward."`;
                }
            }

            // Product comparison
            if (lowerQuestion.includes('compare') && lowerQuestion.includes('ilp')) {
                return `For ${context.name}:<br><br><strong>WealthBuilder Plus ILP</strong> ($1,200/mo) - RECOMMENDED<br>• 100 fund choices<br>• 1.2% management fee<br>• Best value for cost<br><br><strong>WealthMax ILP</strong> ($1,150/mo)<br>• 80 fund choices<br>• 1.5% management fee (0.3% higher)<br>• Slightly lower coverage<br><br>WealthBuilder Plus offers better long-term value despite $50/mo higher premium.`;
            }

            // Product alternatives
            if (lowerQuestion.includes('alternative')) {
                if (currentLead.includes('chen')) {
                    return `Alternative products for Chen Wei:<br><br>1. <strong>FutureSecure ILP</strong> - More fund choices (120) but higher fees<br>2. <strong>Whole Life + Separate Investments</strong> - Could work but less tax efficient<br>3. <strong>Pure Term Life + DIY Investing</strong> - Cheapest but requires discipline<br><br>ILP remains optimal for his profile due to tax benefits and forced savings.`;
                } else {
                    return `For Sarah's family:<br><br>1. <strong>Individual health plans</strong> vs family plan - Would cost $600+/mo instead of $450/mo<br>2. <strong>Lower tier coverage</strong> (B2 ward) - Saves $150/mo but limits hospital choice<br>3. <strong>Term life only</strong> - Minimum protection at $150/mo<br><br>Family health plan is best value for coverage quality.`;
                }
            }

            // Objection handling
            if (lowerQuestion.includes('objection') || lowerQuestion.includes('expensive') || lowerQuestion.includes('price')) {
                if (currentLead.includes('chen')) {
                    return `Handling "too expensive" for Chen Wei:<br><br><strong>Reframe the cost:</strong><br>"After $7K tax relief, you're paying $933/mo - that's just 6.2% of your income. Most financial advisors recommend 15-20% for protection + savings. You're well below that."<br><br><strong>ROI perspective:</strong><br>"At 6% returns over 20 years, your $288K becomes $550K+. That's nearly double, PLUS life coverage. Try getting that from a term policy + separate investments after fees."`;
                } else {
                    return `For Sarah's "too expensive" objection:<br><br><strong>Risk vs cost:</strong><br>"One hospitalization for your child could cost $30K-$50K. This plan costs $450/mo = $5,400/year. It pays for itself with just ONE serious illness."<br><br><strong>Family value:</strong><br>"That's $112.50 per family member. Less than a weekly family dinner, but covers unlimited medical bills for a whole year."`;
                }
            }

            // Opening lines
            if (lowerQuestion.includes('opening') || lowerQuestion.includes('start')) {
                if (currentLead.includes('chen')) {
                    return `Best opening for Chen Wei:<br><br>"Hi Chen Wei! I noticed you're researching investment options. With your banking background, you'll appreciate this: our WealthBuilder ILP combines tax-deferred growth with life coverage - essentially letting you invest $1,200/mo but only paying $933 after tax relief. It's like the company subsidizing your wealth building."<br><br>This hooks his financial knowledge and leads with the tax benefit he'll value.`;
                } else {
                    return `Opening line for Sarah:<br><br>"Hi Sarah! As a mother of two young kids, I know medical bills are a constant worry. Last year, the average family spent $4,800 on healthcare. What if I could show you how to protect your entire family - all 4 members - with ZERO out-of-pocket costs at any private hospital, for just $450 a month?"<br><br>Addresses her main pain point (kids' health) immediately.`;
                }
            }

            // Pricing justification
            if (lowerQuestion.includes('justify') || lowerQuestion.includes('worth')) {
                return `Why ${context.name} should buy NOW:<br><br>1. <strong>Age factor:</strong> Premiums increase 3-5% per year of age. Lock in now.<br>2. <strong>Health:</strong> Currently healthy = no exclusions. Wait = risk of conditions that raise premiums or get excluded.<br>3. <strong>Tax relief:</strong> ${context.income} income = can maximize $7K annual deduction. That's $583/mo in savings.<br>4. <strong>Time value:</strong> Starting now gives 20-30 years of compound growth vs waiting even 2 years.`;
            }

            // Commission/motivation
            if (lowerQuestion.includes('commission') || lowerQuestion.includes('earn')) {
                return `Your earnings on this deal:<br><br>• First year commission: ~25-30% of annual premium<br>• Renewal commissions: 3-5% for years 2-10<br>• This is a high-quality lead with 94% propensity<br>• Diamond tier = 3X points toward your quota<br><br>Plus, satisfied clients refer family members. Chen Wei has high-income banker friends!`;
            }

            // Product features
            if (lowerQuestion.includes('feature') || lowerQuestion.includes('benefit')) {
                if (currentLead.includes('chen')) {
                    return `WealthBuilder Plus key features:<br><br>✓ $500K sum assured (or fund value if higher)<br>✓ 100 fund choices across equities, bonds, balanced<br>✓ Switch funds FREE up to 12x/year<br>✓ $7K annual tax relief (CPF Life also counts)<br>✓ Premium holiday after year 3 if needed<br>✓ Partial withdrawals allowed after year 5<br>✓ 1.2% management fee (competitors: 1.5-2%)`;
                } else {
                    return `HealthShield Gold Plus Family features:<br><br>✓ Covers all 4 family members<br>✓ Private/A1 ward at ANY hospital<br>✓ UNLIMITED annual limit (no cap)<br>✓ ZERO co-payment<br>✓ Pre/post hospitalization: 90/180 days<br>✓ Day surgery covered (no admission needed)<br>✓ Emergency overseas coverage<br>✓ Pediatric benefits from day 1`;
                }
            }

            // Timeline/urgency
            if (lowerQuestion.includes('when') || lowerQuestion.includes('urgent') || lowerQuestion.includes('timing')) {
                return `Timing strategy:<br><br><strong>Ideal timeline:</strong><br>• Week 1: Initial call, build rapport, understand needs<br>• Week 2: Present recommendation, handle objections<br>• Week 3: Close the deal, collect payment<br><br><strong>Create urgency:</strong><br>"This lead is live for 28 seconds remaining. Other agents can see this too. Also, end-of-month deadline for tax relief documentation means securing this now gets them benefits sooner."`;
            }

            // Competitor comparison
            if (lowerQuestion.includes('competitor') || lowerQuestion.includes('vs ')) {
                return `vs Competitors:<br><br><strong>Prudential:</strong> Similar features, 0.2% higher fees<br><strong>Great Eastern:</strong> Fewer fund choices (60 vs 100)<br><strong>Manulife:</strong> Higher coverage but 15% more expensive<br><strong>AXA:</strong> Competitive pricing but limited hospital network<br><br>Our advantage: Best fee structure + fund flexibility + established reputation.`;
            }

            // Closing techniques
            if (lowerQuestion.includes('close') || lowerQuestion.includes('seal')) {
                return `Closing techniques:<br><br>1. <strong>Assumption close:</strong> "Let me get the paperwork started. Should we set premium payment on the 1st or 15th of the month?"<br><br>2. <strong>Limited choice:</strong> "Would you prefer 15-year or 20-year premium payment term?"<br><br>3. <strong>Urgency:</strong> "This propensity score (94%) means high likelihood. Other agents are seeing this lead too. Should we lock this in today?"`;
            }

            // Budget reduction
            if (lowerQuestion.includes('budget') || lowerQuestion.includes('reduce') || lowerQuestion.includes('afford')) {
                if (currentLead.includes('sarah')) {
                    return `Options to fit Sarah's budget:<br><br>1. <strong>B2 Ward Coverage</strong> ($300/mo) - Saves $150/mo but limits to B2/C ward hospitals<br>2. <strong>Higher Deductible</strong> ($380/mo) - $20K deductible instead of $0, saves $70/mo<br>3. <strong>Co-payment Option</strong> ($350/mo) - 10% co-pay up to $3K/year, saves $100/mo<br><br><strong>Recommendation:</strong> Keep current plan. One hospitalization costs $30K-$50K. The $450/mo is actually protecting her from financial ruin. Perhaps reduce elsewhere (dining out, subscriptions)?`;
                } else {
                    return `Ways to reduce Chen's premium:<br><br>1. <strong>Lower sum assured</strong> to $300K (save ~$150/mo) - But he can afford current plan<br>2. <strong>Fewer fund choices</strong> with WealthMax (save $50/mo) - But higher fees long-term<br>3. <strong>Pure term life</strong> ($80/mo) - Cheapest but no investment component<br><br><strong>Don't recommend reducing.</strong> At his income level ($15K/mo), $1,200/mo is only 8%. This is PERFECT allocation for wealth building + protection.`;
                }
            }

            // Involving spouse/husband
            if (lowerQuestion.includes('husband') || lowerQuestion.includes('spouse') || lowerQuestion.includes('involve')) {
                return `Involving Sarah's husband strategy:<br><br>1. <strong>Schedule joint call:</strong> "I'd love to walk through this with both of you. When's good for a quick 15-min call together?"<br><br>2. <strong>Use their story:</strong> "Many couples discuss big financial decisions together. That's smart. Can we schedule a time when you're both available?"<br><br>3. <strong>Provide takeaway materials:</strong> "I'll send you a simple one-pager showing the coverage and costs. Share it with your husband and let me know what questions come up."<br><br>4. <strong>Reframe as family protection:</strong> "This is really about protecting your kids. I'm sure he'd want to be part of that conversation."`;
            }

            // Riders and additional coverage
            if (lowerQuestion.includes('rider') || lowerQuestion.includes('additional')) {
                if (currentLead.includes('chen')) {
                    return `Additional riders for Chen Wei:<br><br>1. <strong>Critical Illness Multiplier</strong> ($80/mo) - Extra payout for cancer, heart attack, stroke<br>2. <strong>Total Permanent Disability</strong> ($45/mo) - Premium waiver if disabled<br>3. <strong>Hospital Income</strong> ($30/mo) - Daily cash while hospitalized<br>4. <strong>Accidental Death Benefit</strong> ($25/mo) - Double payout if accidental death<br><br><strong>Recommendation:</strong> Add CI Multiplier and TPD. Total package becomes $1,325/mo but gives comprehensive protection.`;
                } else {
                    return `Riders to enhance Sarah's plan:<br><br>1. <strong>Maternity Coverage</strong> ($60/mo) - If planning more kids<br>2. <strong>Dental & Optical</strong> ($40/mo) - Kids need frequent dental/eye care<br>3. <strong>Critical Illness for Kids</strong> ($35/mo) - Lump sum if child diagnosed with CI<br>4. <strong>Outpatient Coverage</strong> ($55/mo) - GP visits, specialist consults<br><br>With 2 young kids, Dental & CI riders are valuable. Total becomes $545/mo.`;
                }
            }

            // Default helpful response
            const helpContext = window.megatronLiveChatMode ? 'this conversation' : context.name;
            return `I can help with:<br><br>• Product comparisons and alternatives<br>• Objection handling scripts<br>• Opening lines and pitch strategies<br>• Pricing justification<br>• Best timing to close<br>• Commission structure<br>• Competitor analysis<br>• Budget reduction strategies<br>• Involving spouse in decision<br>• Additional riders and coverage<br><br>What specific aspect would you like to explore for ${helpContext}?`;
        }
        
        function askMegatronChen() {
            const input = document.getElementById('megatron-chen');
            const question = input.value.trim();

            // Set current lead to Chen
            currentLead = 'chen';

            // Open chat
            openMegatronChat();

            // If there's a question, ask it
            if (question) {
                setTimeout(() => {
                    askMegatronQuestion(question);
                }, 500);
            }
        }

        function askMegatronSarah() {
            const input = document.getElementById('megatron-sarah');
            const question = input.value.trim();

            // Set current lead to Sarah
            currentLead = 'sarah';

            // Open chat
            openMegatronChat();

            // If there's a question, ask it
            if (question) {
                setTimeout(() => {
                    askMegatronQuestion(question);
                }, 500);
            }
        }

        function quickAskChen(type) {
            currentLead = 'chen';
            const questions = {
                'compare': 'Compare ILP products',
                'riders': 'What additional riders should I recommend?',
                'objections': 'How to handle "too expensive" objection'
            };
            openMegatronChat();
            setTimeout(() => {
                askMegatronQuestion(questions[type]);
            }, 500);
        }

        function quickAskSarah(type) {
            currentLead = 'sarah';
            const questions = {
                'budget': 'How to reduce cost to fit their budget?',
                'husband': 'How to involve husband in decision?',
                'timeline': 'Best time to close this deal'
            };
            openMegatronChat();
            setTimeout(() => {
                askMegatronQuestion(questions[type]);
            }, 500);
        }

        function askMegatronFromChat() {
            // Get customer name from the chat header
            const customerName = document.getElementById('chat-customer-name')?.textContent || 'Melissa Wong';

            // Set a flag that we're in live chat mode
            window.megatronLiveChatMode = true;

            // Open Megatron chat with live chat context
            const overlay = document.getElementById('megatron-chat-overlay');
            const chatBody = document.getElementById('megatron-chat-body');

            // Clear previous messages
            chatBody.innerHTML = '';

            // Add welcome message with live chat context
            const contextMessage = `Hi! I can see you're chatting with ${customerName.replace('Chat with ', '')}. I have the conversation context and can help you with:<br><br>
• How to respond to their questions<br>
• Product recommendations for their situation<br>
• Pricing and quote calculations<br>
• Objection handling scripts<br>
• Next best actions<br><br>
What do you need help with?`;

            addMegatronMessage(contextMessage, false);

            // Add custom suggestion chips for live chat
            const chatBody2 = document.getElementById('megatron-chat-body');
            const lastMessage = chatBody2.lastElementChild;

            const suggestionsHtml = `
                <div class="megatron-suggestions">
                    <div class="suggestion-chip" onclick="askMegatronQuestion('What should I say next?')">What should I say next?</div>
                    <div class="suggestion-chip" onclick="askMegatronQuestion('Calculate quote for family of 4')">Calculate quote</div>
                    <div class="suggestion-chip" onclick="askMegatronQuestion('Handle price objection')">Handle price objection</div>
                    <div class="suggestion-chip" onclick="askMegatronQuestion('Best product to recommend')">Best product</div>
                </div>
            `;

            if (lastMessage) {
                // Select the second div (the wrapper div, not the avatar)
                const wrapperDiv = lastMessage.querySelectorAll('div')[1];
                if (wrapperDiv) {
                    wrapperDiv.insertAdjacentHTML('beforeend', suggestionsHtml);
                }
            }

            // Show overlay
            overlay.classList.add('active');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Peek Feature Functions
        let peekTimer = null;
        let peekTimeRemaining = 60;
        let userPoints = 1240;
        let currentPeekLead = null;
        let agentTier = 'expert'; // 'expert', 'master', 'legend'

        function getPeekCost() {
            const tierCosts = {
                'expert': 50,
                'master': 25,
                'legend': 10
            };
            return tierCosts[agentTier] || 50;
        }

        function peekLead() {
            const cost = getPeekCost();

            // Check if user has enough points
            if (userPoints < cost) {
                showToast('❌ Not enough points to peek!');
                return;
            }

            // Show confirmation modal
            document.getElementById('peek-cost').textContent = cost + ' points';
            document.getElementById('peek-balance').textContent = userPoints.toLocaleString() + ' points';
            document.getElementById('peek-after').textContent = (userPoints - cost).toLocaleString() + ' points';
            document.getElementById('peek-confirm-overlay').classList.add('active');
        }

        function cancelPeek() {
            document.getElementById('peek-confirm-overlay').classList.remove('active');
        }

        function confirmPeek() {
            const cost = getPeekCost();

            // Deduct points
            userPoints -= cost;

            // Close confirmation modal
            document.getElementById('peek-confirm-overlay').classList.remove('active');

            // Show peek preview screen
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('peek-preview-screen').classList.add('active');

            // Start 60-second countdown
            peekTimeRemaining = 60;
            updatePeekCountdown();
            peekTimer = setInterval(() => {
                peekTimeRemaining--;
                updatePeekCountdown();

                if (peekTimeRemaining <= 0) {
                    clearInterval(peekTimer);
                    // Auto-return to home if no decision made
                    showToast('⏰ Peek time expired! Returning to queue...');
                    setTimeout(() => {
                        switchScreen('home');
                    }, 2000);
                }
            }, 1000);

            showToast(`👁️ Peeking at lead! -${cost} points`);
        }

        function updatePeekCountdown() {
            const countdownEl = document.getElementById('peek-countdown');
            if (countdownEl) {
                countdownEl.textContent = peekTimeRemaining;

                // Change color as time runs out
                const parentEl = countdownEl.parentElement;
                if (peekTimeRemaining <= 10) {
                    parentEl.style.background = 'rgba(220, 53, 69, 0.3)';
                } else if (peekTimeRemaining <= 30) {
                    parentEl.style.background = 'rgba(255, 193, 7, 0.3)';
                }
            }
        }

        function passAfterPeek() {
            // Clear timer
            if (peekTimer) {
                clearInterval(peekTimer);
                peekTimer = null;
            }

            // Return to home
            showToast('Lead passed. Points spent are not refunded.');
            switchScreen('home');
        }

        function grabAfterPeek() {
            // Clear timer
            if (peekTimer) {
                clearInterval(peekTimer);
                peekTimer = null;
            }

            const cost = getPeekCost();
            const refund = Math.floor(cost * 0.5); // 50% refund potential

            // Add points for grabbing (150) but remember they can get 50% refund on conversion
            userPoints += 150;

            showToast(`✅ Lead grabbed! +150 points. Convert to earn ${refund} point refund!`);

            // Track that this lead was peeked (for refund tracking)
            window.peekedLeadGrabbed = true;
            window.peekRefundAmount = refund;

            setTimeout(() => {
                switchScreen('home');
            }, 2000);
        }

        // Function to call when lead is successfully converted
        function convertPeekedLead() {
            if (window.peekedLeadGrabbed && window.peekRefundAmount) {
                userPoints += window.peekRefundAmount;
                showToast(`🎉 Lead converted! +${window.peekRefundAmount} point refund (50% peek cost)`);
                window.peekedLeadGrabbed = false;
                window.peekRefundAmount = 0;
            }
        }

        // Heatmap Interactive Functions
        const zoneData = {
            'tampines': {
                name: 'Tampines',
                distance: '2.1km',
                surge: '2×',
                leads: 18,
                timeLeft: 45,
                leads_list: [
                    { name: 'Rachel Lim', tier: 'diamond', propensity: 96, product: 'ILP', premium: '$1,500/mo' },
                    { name: 'Michael Tan', tier: 'diamond', propensity: 94, product: 'Whole Life', premium: '$2,000/mo' },
                    { name: 'Stephanie Wong', tier: 'gold', propensity: 88, product: 'Health', premium: '$450/mo' },
                    { name: 'David Chen', tier: 'gold', propensity: 85, product: 'ILP', premium: '$1,200/mo' },
                    { name: 'Amanda Ng', tier: 'diamond', propensity: 92, product: 'CI', premium: '$800/mo' }
                ]
            },
            'cbd': {
                name: 'CBD / Marina',
                distance: '8.5km',
                surge: '1.5×',
                leads: 12,
                timeLeft: 75,
                leads_list: [
                    { name: 'James Koh', tier: 'diamond', propensity: 95, product: 'ILP', premium: '$2,500/mo' },
                    { name: 'Linda Tan', tier: 'diamond', propensity: 91, product: 'Whole Life', premium: '$1,800/mo' },
                    { name: 'Kevin Lim', tier: 'gold', propensity: 86, product: 'Health', premium: '$600/mo' }
                ]
            },
            'bedok': {
                name: 'Bedok',
                distance: '3.5km',
                surge: '1×',
                leads: 5,
                timeLeft: 0,
                leads_list: [
                    { name: 'Sarah Lee', tier: 'gold', propensity: 82, product: 'Health', premium: '$400/mo' },
                    { name: 'Tommy Ng', tier: 'gold', propensity: 79, product: 'Term Life', premium: '$150/mo' }
                ]
            },
            'eastcoast': {
                name: 'East Coast',
                distance: '6.2km',
                surge: '1×',
                leads: 3,
                timeLeft: 0,
                leads_list: [
                    { name: 'Jessica Poh', tier: 'gold', propensity: 84, product: 'ILP', premium: '$1,000/mo' }
                ]
            },
            'sembawang': {
                name: 'Sembawang',
                distance: '12.5km',
                surge: '1×',
                leads: 2,
                timeLeft: 0,
                leads_list: [
                    { name: 'Patrick Ong', tier: 'silver', propensity: 75, product: 'Health', premium: '$300/mo' }
                ]
            }
        };

        function openZoneDetail(zoneId) {
            const zone = zoneData[zoneId];
            if (!zone) return;

            // Update modal content
            document.getElementById('zone-name').textContent = zone.name;
            document.getElementById('zone-distance').textContent = zone.distance + ' away';
            document.getElementById('zone-surge').textContent = zone.surge;
            document.getElementById('zone-leads').textContent = zone.leads;
            document.getElementById('zone-timer').textContent = zone.timeLeft > 0 ? zone.timeLeft + 'm' : 'Expired';

            // Build leads list
            const leadsList = document.getElementById('zone-leads-list');
            leadsList.innerHTML = '';

            zone.leads_list.forEach(lead => {
                const tierColors = {
                    'diamond': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'gold': 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)',
                    'silver': 'linear-gradient(135deg, #6c757d 0%, #495057 100%)'
                };

                const tierIcons = {
                    'diamond': '💎',
                    'gold': '🥇',
                    'silver': '🥈'
                };

                const leadCard = `
                    <div style="background: white; padding: 12px; border-radius: 12px; margin-bottom: 10px; cursor: pointer;" onclick="showToast('Lead grabbed: ${lead.name}')">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">${lead.name}</div>
                                <div style="font-size: 11px; color: #666;">${lead.product} • ${lead.premium}</div>
                            </div>
                            <div style="background: ${tierColors[lead.tier]}; color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600;">
                                ${tierIcons[lead.tier]} ${lead.tier.toUpperCase()}
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 11px; color: #666;">Propensity: <span style="font-weight: 600; color: #28a745;">${lead.propensity}%</span></div>
                            <button style="padding: 6px 12px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer;">
                                ⚡ GRAB
                            </button>
                        </div>
                    </div>
                `;
                leadsList.insertAdjacentHTML('beforeend', leadCard);
            });

            // Show modal
            document.getElementById('zone-detail-overlay').classList.add('active');
        }

        function closeZoneDetail() {
            document.getElementById('zone-detail-overlay').classList.remove('active');
        }

        function grabAllInZone() {
            showToast('🎉 All leads in zone grabbed! +850 points');
            closeZoneDetail();
        }

        function toggleHeatmapFilter(filter) {
            // Update button states
            document.querySelectorAll('.heatmap-filter-btn').forEach(btn => {
                btn.style.background = '#f8f9fa';
                btn.style.border = '1px solid #dee2e6';
                btn.style.color = '#333';
            });

            const activeBtn = document.getElementById('filter-' + filter);
            activeBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            activeBtn.style.border = 'none';
            activeBtn.style.color = 'white';

            // Filter markers
            const markers = document.querySelectorAll('.zone-marker');
            markers.forEach(marker => {
                const zone = marker.getAttribute('data-zone');
                const zoneInfo = zoneData[zone];

                if (filter === 'all') {
                    marker.style.display = 'block';
                } else if (filter === 'surge') {
                    marker.style.display = zoneInfo.timeLeft > 0 ? 'block' : 'none';
                } else if (filter === 'nearby') {
                    const distance = parseFloat(zoneInfo.distance);
                    marker.style.display = distance <= 5 ? 'block' : 'none';
                }
            });
        }

        function updateProximityRadius(value) {
            document.getElementById('radius-label').textContent = value + 'km';

            // Update proximity circle size
            const circle = document.getElementById('proximity-circle');
            const size = 40 * parseInt(value); // 40px per km
            circle.style.width = size + 'px';
            circle.style.height = size + 'px';
        }

        // Route Planning Variables
        let routeMode = false;
        let selectedZones = [];
        let routeOrder = [];

        function toggleRouteMode() {
            routeMode = !routeMode;
            const btn = document.getElementById('route-mode-btn');
            const panel = document.getElementById('route-panel');

            if (routeMode) {
                btn.style.background = '#dc3545';
                btn.textContent = '❌ Cancel Route';
                panel.style.display = 'block';
                showToast('📍 Route mode ON - Click zones to add them to your route');
            } else {
                btn.style.background = '#28a745';
                btn.textContent = '🗺️ Plan Route';
                panel.style.display = 'none';
                clearRoute();
            }
        }

        function handleZoneClick(zoneId) {
            if (routeMode) {
                toggleZoneSelection(zoneId);
            } else {
                openZoneDetail(zoneId);
            }
        }

        function toggleZoneSelection(zoneId) {
            const zoneElement = document.querySelector(`[data-zone="${zoneId}"]`);
            const zoneInfo = zoneData[zoneId];

            if (selectedZones.includes(zoneId)) {
                // Deselect
                selectedZones = selectedZones.filter(z => z !== zoneId);
                zoneElement.style.transform = 'scale(1)';
                zoneElement.style.filter = 'none';
            } else {
                // Select
                selectedZones.push(zoneId);
                zoneElement.style.transform = 'scale(1.2)';
                zoneElement.style.filter = 'drop-shadow(0 0 10px #667eea)';
            }

            updateRoutePanel();
        }

        function updateRoutePanel() {
            const selectedZonesContainer = document.getElementById('selected-zones');
            selectedZonesContainer.innerHTML = '';

            selectedZones.forEach((zoneId, index) => {
                const zone = zoneData[zoneId];
                const chip = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 16px; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                        <span>${index + 1}. ${zone.name}</span>
                        <span onclick="toggleZoneSelection('${zoneId}')" style="cursor: pointer; opacity: 0.8;">×</span>
                    </div>
                `;
                selectedZonesContainer.insertAdjacentHTML('beforeend', chip);
            });

            // Show/hide optimize button and summary
            if (selectedZones.length >= 2) {
                document.getElementById('optimize-route-btn').style.display = 'block';
                calculateAndDisplayRoute();
            } else {
                document.getElementById('optimize-route-btn').style.display = 'none';
                document.getElementById('route-summary').style.display = 'none';
                clearRouteLines();
            }
        }

        function calculateAndDisplayRoute() {
            // Calculate total distance and leads
            let totalDistance = 0;
            let totalLeads = 0;

            // Start from user location (52%, 48%)
            let prevX = 52, prevY = 48;

            selectedZones.forEach(zoneId => {
                const zone = zoneData[zoneId];
                const marker = document.querySelector(`[data-zone="${zoneId}"]`);
                const x = parseInt(marker.getAttribute('data-x'));
                const y = parseInt(marker.getAttribute('data-y'));

                // Simple distance calculation (Pythagorean)
                const dist = Math.sqrt(Math.pow(x - prevX, 2) + Math.pow(y - prevY, 2)) / 10; // Scale down
                totalDistance += parseFloat(zone.distance);
                totalLeads += zone.leads;

                prevX = x;
                prevY = y;
            });

            // Display summary
            const estimatedTime = Math.round(totalDistance * 3); // 3 min per km average
            document.getElementById('route-distance').textContent = totalDistance.toFixed(1) + 'km';
            document.getElementById('route-time').textContent = estimatedTime + ' min';
            document.getElementById('route-leads').textContent = totalLeads + ' leads';
            document.getElementById('route-summary').style.display = 'block';

            // Draw route lines
            drawRouteLines();
        }

        function drawRouteLines() {
            const svg = document.getElementById('route-lines');
            svg.innerHTML = '';

            if (selectedZones.length < 2) return;

            const mapContainer = document.querySelector('.map-container');
            const width = mapContainer.offsetWidth;
            const height = mapContainer.offsetHeight;

            // Start from user location
            let prevX = width * 0.52;
            let prevY = height * 0.48;

            selectedZones.forEach((zoneId, index) => {
                const marker = document.querySelector(`[data-zone="${zoneId}"]`);
                const x = (parseInt(marker.getAttribute('data-x')) / 100) * width;
                const y = (parseInt(marker.getAttribute('data-y')) / 100) * height;

                // Draw line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', prevX);
                line.setAttribute('y1', prevY);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#667eea');
                line.setAttribute('stroke-width', '3');
                line.setAttribute('stroke-dasharray', '8,4');
                line.setAttribute('opacity', '0.7');

                svg.appendChild(line);

                // Draw route number circle
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', '12');
                circle.setAttribute('fill', '#667eea');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', '2');

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', y + 4);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '11');
                text.setAttribute('font-weight', 'bold');
                text.textContent = index + 1;

                svg.appendChild(circle);
                svg.appendChild(text);

                prevX = x;
                prevY = y;
            });
        }

        function clearRouteLines() {
            document.getElementById('route-lines').innerHTML = '';
        }

        function clearRoute() {
            selectedZones.forEach(zoneId => {
                const zoneElement = document.querySelector(`[data-zone="${zoneId}"]`);
                zoneElement.style.transform = 'scale(1)';
                zoneElement.style.filter = 'none';
            });

            selectedZones = [];
            document.getElementById('selected-zones').innerHTML = '';
            document.getElementById('optimize-route-btn').style.display = 'none';
            document.getElementById('route-summary').style.display = 'none';
            clearRouteLines();
        }

        function optimizeRoute() {
            // Optimize route using nearest neighbor algorithm
            if (selectedZones.length < 2) return;

            // Simple optimization: sort by distance from current location
            const optimized = [...selectedZones].sort((a, b) => {
                return parseFloat(zoneData[a].distance) - parseFloat(zoneData[b].distance);
            });

            selectedZones = optimized;
            updateRoutePanel();

            showToast(`✅ Route optimized! ${selectedZones.length} stops, ${document.getElementById('route-distance').textContent} total`);

            // Optionally auto-start navigation
            setTimeout(() => {
                const firstZone = zoneData[selectedZones[0]];
                showToast(`🚗 Starting navigation to ${firstZone.name} (${firstZone.distance})`);
            }, 2000);
        }

        // Start surge timer countdown
        setInterval(() => {
            Object.keys(zoneData).forEach(zoneId => {
                if (zoneData[zoneId].timeLeft > 0) {
                    zoneData[zoneId].timeLeft--;
                }
            });
        }, 60000); // Update every minute

        // ===== NEWS HUB FEATURE =====

        // Hardcoded news data array
        const newsData = [
            {
                id: 1,
                category: 'trending',
                type: 'trending',
                source: 'MAS',
                verified: true,
                time: '2 hours ago',
                headline: 'MAS Issues New Guidelines on Outpatient Coverage Reforms',
                summary: 'Monetary Authority of Singapore announces expanded coverage requirements for outpatient treatments under integrated health plans, effective Q2 2025.',
                impactTitle: '💡 What This Means for Agents',
                impactText: 'Position AIA HealthShield as comprehensive beyond CPF-approved limits. Highlight our expanded outpatient benefits that exceed new MAS requirements. Use this regulatory change as urgency trigger for policy reviews.',
                tags: ['Health Insurance', 'Regulation', 'MAS', 'Outpatient'],
                link: '#'
            },
            {
                id: 2,
                category: 'competitor',
                type: 'competitor',
                source: 'Business Times',
                verified: true,
                time: '5 hours ago',
                headline: 'NTUC Income Launches "Life360" Comprehensive Protection Plan',
                summary: 'New product combines life, critical illness, and disability coverage with flexible premium options starting at $180/month for $300K coverage.',
                impactTitle: '💡 Competitive Response Strategy',
                impactText: 'Emphasize AIA\'s faster claims processing (5 days vs 7 days) and higher customer satisfaction scores. Our Smart Protect offers 15% more riders at similar premium points. Mention 100 fund options in ILP vs their 45.',
                tags: ['Competition', 'NTUC', 'Life Insurance', 'Product Launch'],
                link: '#'
            },
            {
                id: 3,
                category: 'health',
                type: 'regulation',
                source: 'CPF Board',
                verified: true,
                time: '8 hours ago',
                headline: 'CPF Life Payout Adjustments Effective Jan 2025',
                summary: 'Updated CPF Life payout rates announced with increases ranging from 2-4% across all plan types due to improved longevity projections.',
                impactTitle: '💡 Sales Opportunity',
                impactText: 'Perfect moment to position Smart Wealth Builder II for retirement income gaps. CPF increases signal longer lifespans = greater retirement funding needs. Use "CPF + Private Plan" combo pitch to show comprehensive retirement strategy.',
                tags: ['CPF', 'Retirement', 'Annuity', 'Government Policy'],
                link: '#'
            },
            {
                id: 4,
                category: 'health',
                type: 'trending',
                source: 'Straits Times',
                verified: true,
                time: '1 day ago',
                headline: 'Private Hospital Costs Rise 12% Year-on-Year in Singapore',
                summary: 'Average hospitalization costs at private hospitals increased significantly, with ICU stays averaging $3,800/day and specialist consultations up 15%.',
                impactTitle: '💡 Urgency Messaging',
                impactText: 'Use rising costs as urgency trigger for health insurance upgrades. Emphasize "lock in coverage now before premiums adjust." PrivateShield Premier with no co-payment becomes even more valuable. Share cost comparison examples.',
                tags: ['Healthcare Costs', 'Private Hospitals', 'Market Trends'],
                link: '#'
            },
            {
                id: 5,
                category: 'regulation',
                type: 'regulation',
                source: 'LIA Singapore',
                verified: true,
                time: '1 day ago',
                headline: 'New Suitability Assessment Requirements for Investment Products',
                summary: 'Life Insurance Association introduces enhanced customer profiling requirements for ILP sales, including mandatory risk tolerance questionnaires.',
                impactTitle: '💡 Compliance Update',
                impactText: 'Ensure all ILP sales include updated Financial Needs Analysis (FNA) with new risk profiling questions. AIA portal updated with automated assessment tool. Complete compliance training module before selling ILPs.',
                tags: ['Compliance', 'ILP', 'Regulation', 'LIA'],
                link: '#'
            },
            {
                id: 6,
                category: 'esg',
                type: 'esg',
                source: 'AIA Group',
                verified: true,
                time: '2 days ago',
                headline: 'AIA Achieves Carbon Neutral Operations Across Asia-Pacific',
                summary: 'AIA Group announces achievement of carbon neutrality across all regional operations, reinforcing commitment to ESG principles and sustainable investing.',
                impactTitle: '💡 Brand Differentiation',
                impactText: 'Leverage ESG credentials with younger, environmentally-conscious clients. Our WealthBuilder ESG Fund options align with sustainability values. Mention carbon-neutral operations as corporate responsibility proof point.',
                tags: ['ESG', 'Sustainability', 'Corporate News', 'AIA'],
                link: '#'
            },
            {
                id: 7,
                category: 'competitor',
                type: 'competitor',
                source: 'Reuters',
                verified: true,
                time: '2 days ago',
                headline: 'Prudential Reports 23% Growth in Digital Policy Purchases',
                summary: 'Competitor sees significant uptake in online policy purchases, with 45% of term life policies now sold via digital channels.',
                impactTitle: '💡 Digital Engagement',
                impactText: 'Highlight AIA\'s superior mobile app experience and AI-powered lead tools. While competitors push self-service, emphasize personalized advisory value. Use digital tools as enablers, not replacements for relationship.',
                tags: ['Digital Transformation', 'Prudential', 'Market Trends'],
                link: '#'
            },
            {
                id: 8,
                category: 'health',
                type: 'health',
                source: 'MOH Singapore',
                verified: true,
                time: '3 days ago',
                headline: 'Ministry of Health Expands MediShield Life Coverage for Cancer Treatments',
                summary: 'New immunotherapy and targeted therapy treatments added to MediShield Life coverage list, reducing out-of-pocket costs for cancer patients.',
                impactTitle: '💡 Coverage Gap Analysis',
                impactText: 'MediShield expansion is positive but still has coverage limits. Position AIA CriticalCare as essential supplement. Highlight 120 critical illness conditions vs MediShield\'s basic cancer coverage. Early-stage detection benefits crucial.',
                tags: ['MediShield', 'Cancer', 'MOH', 'Healthcare'],
                link: '#'
            },
            {
                id: 9,
                category: 'trending',
                type: 'trending',
                source: 'Bloomberg',
                verified: true,
                time: '3 days ago',
                headline: 'Singapore Life Insurance Sector Records 18% Premium Growth in 2024',
                summary: 'Industry-wide new business premiums reach $15.2B, driven by strong demand for health and investment-linked products amid economic recovery.',
                impactTitle: '💡 Market Confidence',
                impactText: 'Strong market growth validates insurance value proposition. Use industry momentum in conversations: "18% growth shows Singaporeans prioritizing protection." Position AIA as market leader in growth segment.',
                tags: ['Market Data', 'Industry Growth', 'Singapore'],
                link: '#'
            },
            {
                id: 10,
                category: 'esg',
                type: 'esg',
                source: 'CNA',
                verified: true,
                time: '4 days ago',
                headline: 'Green Building Standards Impact Commercial Property Insurance',
                summary: 'New sustainability requirements for commercial buildings create opportunities for specialized green property coverage products.',
                impactTitle: '💡 Corporate Client Opportunity',
                impactText: 'For corporate/SME clients, position AIA Business Protection Suite with ESG compliance benefits. Green building coverage becoming differentiator. Partner with corporate sales team for cross-sell opportunities.',
                tags: ['ESG', 'Commercial', 'Property', 'Green Building'],
                link: '#'
            }
        ];

        let currentNewsFilter = 'all';

        // Render news cards
        function renderNews(filter = 'all') {
            currentNewsFilter = filter;
            const container = document.getElementById('news-container');

            // Update filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event?.target?.classList.add('active');

            // Filter news
            let filteredNews = newsData;
            if (filter !== 'all') {
                filteredNews = newsData.filter(news => news.category === filter);
            }

            // Render news cards
            container.innerHTML = filteredNews.map(news => `
                <div class="news-card ${news.type}" onclick="viewNewsDetail(${news.id})">
                    <div class="news-source">
                        <span class="source-badge ${news.verified ? 'verified' : ''}">
                            ${news.verified ? '✓ ' : ''}${news.source}
                        </span>
                        ${news.type === 'trending' ? '<span class="trending-badge">🔥 TRENDING</span>' : ''}
                        <span class="news-time">${news.time}</span>
                    </div>

                    <div class="news-headline">${news.headline}</div>
                    <div class="news-summary">${news.summary}</div>

                    <div class="news-impact">
                        <div class="impact-title">${news.impactTitle}</div>
                        <div class="impact-text">${news.impactText}</div>
                    </div>

                    <div class="news-tags">
                        ${news.tags.map(tag => `<span class="news-tag">${tag}</span>`).join('')}
                    </div>

                    <div class="news-actions">
                        <button class="news-action-btn" onclick="event.stopPropagation(); useInDossier(${news.id})">
                            📋 Use in Dossier
                        </button>
                        <button class="news-action-btn" onclick="event.stopPropagation(); shareNews(${news.id})">
                            📤 Share
                        </button>
                    </div>
                </div>
            `).join('');

            // If no news found
            if (filteredNews.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 15px;">📭</div>
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">No news in this category</div>
                        <div style="font-size: 13px;">Try selecting a different filter</div>
                    </div>
                `;
            }
        }

        // Filter news by category
        function filterNews(category) {
            renderNews(category);
        }

        // View news detail
        function viewNewsDetail(newsId) {
            const news = newsData.find(n => n.id === newsId);
            if (!news) return;

            showToast(`📰 Opening: ${news.headline.substring(0, 40)}...`);

            // In a real app, this would open a detailed view
            // For now, just show a toast
            setTimeout(() => {
                showToast(`💡 ${news.impactTitle}`);
            }, 1500);
        }

        // Use news in dossier
        function useInDossier(newsId) {
            const news = newsData.find(n => n.id === newsId);
            if (!news) return;

            showToast(`✅ Added to talking points: "${news.headline.substring(0, 30)}..."`);
        }

        // Share news
        function shareNews(newsId) {
            const news = newsData.find(n => n.id === newsId);
            if (!news) return;

            showToast(`📤 Shared to squad: ${news.headline.substring(0, 35)}...`);
        }

        // Initialize news on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderNews('all');
            renderChatMessages();
        });

        // ===== SQUAD CHAT FEATURE =====

        // Hardcoded chat messages
        const chatMessages = [
            {
                id: 1,
                sender: 'Marcus Tan',
                avatar: 'MT',
                time: '9:23 AM',
                type: 'text',
                content: 'Morning team! Just grabbed a Diamond lead in Tampines. Anyone have experience with high-net-worth health insurance clients?'
            },
            {
                id: 2,
                sender: 'Rachel Ng',
                avatar: 'RN',
                time: '9:25 AM',
                type: 'text',
                content: 'Yes! I closed 3 similar cases last month. Key is to focus on comprehensive coverage and international benefits.'
            },
            {
                id: 3,
                sender: 'Rachel Ng',
                avatar: 'RN',
                time: '9:25 AM',
                type: 'tip',
                title: '💡 Pro Tip: HNW Health Insurance',
                content: 'Emphasize: (1) No claim limits, (2) Global coverage including US, (3) VIP hospital rooms, (4) Direct billing with top hospitals. Use HealthShield Premier comparison chart.'
            },
            {
                id: 4,
                sender: 'You',
                avatar: 'SL',
                time: '9:27 AM',
                type: 'text',
                content: 'Thanks Rachel! That\'s super helpful 🙏',
                own: true
            },
            {
                id: 5,
                sender: 'Kevin Tan',
                avatar: 'KT',
                time: '10:15 AM',
                type: 'celebration',
                content: '🎉 Just closed a $500K life policy! 7th conversion this week!'
            },
            {
                id: 6,
                sender: 'Marcus Tan',
                avatar: 'MT',
                time: '10:16 AM',
                type: 'text',
                content: 'Beast mode Kevin! 🔥 What was your approach?'
            },
            {
                id: 7,
                sender: 'Kevin Tan',
                avatar: 'KT',
                time: '10:18 AM',
                type: 'text',
                content: 'Used the "CPF gap analysis" strategy we discussed last week. Client realized CPF only covers 30% of retirement needs. Smart Wealth Builder was a no-brainer.'
            },
            {
                id: 8,
                sender: 'You',
                avatar: 'SL',
                time: '11:42 AM',
                type: 'news',
                title: '📰 Shared from News Hub',
                content: 'MAS Issues New Guidelines on Outpatient Coverage Reforms - Great talking point for policy reviews!',
                newsId: 1
            },
            {
                id: 9,
                sender: 'Rachel Ng',
                avatar: 'RN',
                time: '11:45 AM',
                type: 'text',
                content: 'Perfect timing! I have 3 policy reviews scheduled this afternoon. Will definitely use this.'
            },
            {
                id: 10,
                sender: 'Lisa Wong',
                avatar: 'LW',
                time: '2:34 PM',
                type: 'help',
                content: '🆘 Quick help needed: Client asking about pre-existing conditions waiting period. Is it 12 or 24 months for HealthShield?'
            },
            {
                id: 11,
                sender: 'Marcus Tan',
                avatar: 'MT',
                time: '2:35 PM',
                type: 'text',
                content: '12 months for HealthShield Plus, 24 months for specific conditions like diabetes. Check Megatron for exact details.'
            },
            {
                id: 12,
                sender: 'Lisa Wong',
                avatar: 'LW',
                time: '2:36 PM',
                type: 'text',
                content: 'Thanks Marcus! Crisis averted 😅'
            },
            {
                id: 13,
                sender: 'You',
                avatar: 'SL',
                time: '3:15 PM',
                type: 'text',
                content: 'Anyone free for a quick strategy call? Have a complex ILP case - client wants ESG funds but worried about returns.',
                own: true
            },
            {
                id: 14,
                sender: 'Rachel Ng',
                avatar: 'RN',
                time: '3:16 PM',
                type: 'text',
                content: 'I can hop on in 10 min! ESG funds have been outperforming lately. I\'ll share the performance data.'
            }
        ];

        let currentChatMessages = [...chatMessages];
        let sharedNewsItems = [
            {
                newsId: 2,
                sharedBy: 'Marcus Tan',
                sharedTime: '2:15 PM',
                isNew: true
            },
            {
                newsId: 4,
                sharedBy: 'Rachel Ng',
                sharedTime: '1:30 PM',
                isNew: true
            },
            {
                newsId: 1,
                sharedBy: 'You',
                sharedTime: '11:42 AM',
                isNew: false
            },
            {
                newsId: 9,
                sharedBy: 'Kevin Tan',
                sharedTime: '10:20 AM',
                isNew: false
            },
            {
                newsId: 3,
                sharedBy: 'Lisa Wong',
                sharedTime: 'Yesterday',
                isNew: false
            }
        ];

        // Switch between Members, News, and Chat tabs
        function switchSquadTab(tab) {
            // Update tab active states
            document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Hide all tabs
            document.getElementById('squad-members-tab').style.display = 'none';
            document.getElementById('squad-news-tab').style.display = 'none';
            document.getElementById('squad-chat-tab').style.display = 'none';

            // Show selected tab
            if (tab === 'members') {
                document.getElementById('squad-members-tab').style.display = 'block';
            } else if (tab === 'news') {
                document.getElementById('squad-news-tab').style.display = 'block';
                renderSquadNewsFeed();
            } else if (tab === 'chat') {
                document.getElementById('squad-chat-tab').style.display = 'flex';
                renderChatMessages();
                scrollChatToBottom();
            }
        }

        // Render squad news feed
        function renderSquadNewsFeed() {
            const container = document.getElementById('squad-news-feed');
            if (!container) return;

            if (sharedNewsItems.length === 0) {
                container.innerHTML = `
                    <div class="squad-news-empty">
                        <div style="font-size: 36px; margin-bottom: 10px;">📭</div>
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px;">No news shared yet</div>
                        <div style="font-size: 12px;">Share insights from News Hub to keep squad informed</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = sharedNewsItems.map(item => {
                const news = newsData.find(n => n.id === item.newsId);
                if (!news) return '';

                return `
                    <div class="squad-news-item ${item.isNew ? 'new' : ''}" onclick="viewNewsFromSquad(${item.newsId})">
                        <div class="squad-news-header">
                            <div class="squad-news-sharer">
                                📤 Shared by ${item.sharedBy} • ${item.sharedTime}
                            </div>
                            ${item.isNew ? '<span class="squad-news-badge">NEW</span>' : ''}
                        </div>
                        <div class="squad-news-title">${news.headline}</div>
                        <div class="squad-news-impact">💡 ${news.impactText.substring(0, 120)}...</div>
                        <div class="squad-news-meta">
                            <span>📰 ${news.source}</span>
                            <span>🏷️ ${news.tags[0]}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View news from squad feed
        function viewNewsFromSquad(newsId) {
            // Mark as read
            const item = sharedNewsItems.find(i => i.newsId === newsId);
            if (item) item.isNew = false;

            // Switch to news hub
            switchScreen('news');

            // Show news detail
            setTimeout(() => {
                viewNewsDetail(newsId);
            }, 300);
        }

        // Render chat messages
        function renderChatMessages() {
            const container = document.getElementById('chat-messages-container');
            if (!container) return;

            container.innerHTML = currentChatMessages.map(msg => {
                const ownClass = msg.own ? 'own' : '';

                // Regular text message
                if (msg.type === 'text') {
                    return `
                        <div class="message ${ownClass}">
                            <div class="message-avatar">${msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-bubble">${msg.content}</div>
                            </div>
                        </div>
                    `;
                }

                // Tip message
                if (msg.type === 'tip') {
                    return `
                        <div class="message ${ownClass}">
                            <div class="message-avatar">${msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-special">
                                    <div class="message-special-title">${msg.title}</div>
                                    <div class="message-special-content">${msg.content}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Celebration message
                if (msg.type === 'celebration') {
                    return `
                        <div class="message ${ownClass}">
                            <div class="message-avatar">${msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-action">${msg.content}</div>
                            </div>
                        </div>
                    `;
                }

                // News share message
                if (msg.type === 'news') {
                    return `
                        <div class="message ${ownClass}">
                            <div class="message-avatar">${msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-special">
                                    <div class="message-special-title">${msg.title}</div>
                                    <div class="message-special-content">${msg.content}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Help message
                if (msg.type === 'help') {
                    return `
                        <div class="message ${ownClass}">
                            <div class="message-avatar">${msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-action">${msg.content}</div>
                            </div>
                        </div>
                    `;
                }
            }).join('');

            scrollChatToBottom();
        }

        // Scroll chat to bottom
        function scrollChatToBottom() {
            setTimeout(() => {
                const container = document.getElementById('chat-messages-container');
                if (container) {
                    container.scrollTop = container.scrollHeight;
                }
            }, 100);
        }

        // Send chat message
        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (!message) return;

            // Add new message
            const newMsg = {
                id: currentChatMessages.length + 1,
                sender: 'You',
                avatar: 'SL',
                time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                type: 'text',
                content: message,
                own: true
            };

            currentChatMessages.push(newMsg);
            renderChatMessages();

            // Clear input
            input.value = '';

            // Show toast
            showToast('💬 Message sent to squad');

            // Simulate reply after 2 seconds
            setTimeout(() => {
                const replies = [
                    'Great point! I agree 👍',
                    'Thanks for sharing that!',
                    'Let me check and get back to you',
                    'That\'s really helpful, thanks!',
                    'I\'ll try that approach!'
                ];

                const replyMsg = {
                    id: currentChatMessages.length + 1,
                    sender: 'Marcus Tan',
                    avatar: 'MT',
                    time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                    type: 'text',
                    content: replies[Math.floor(Math.random() * replies.length)]
                };

                currentChatMessages.push(replyMsg);
                renderChatMessages();
            }, 2000);
        }

        // Handle Enter key in chat
        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        // Send quick message
        function sendQuickMessage(type) {
            const messages = {
                'tips': {
                    type: 'tip',
                    title: '💡 Pro Tip',
                    content: 'Always use the "CPF gap analysis" to show retirement funding needs. Clients respond well to specific numbers!'
                },
                'celebrate': {
                    type: 'celebration',
                    content: '🎉 Just hit my weekly target! 15 conversions this week!'
                },
                'help': {
                    type: 'help',
                    content: '🆘 Need help with ILP product comparison - client comparing us with competitor X'
                },
                'megatron': {
                    type: 'text',
                    content: '🤖 Asking Megatron about latest product updates...'
                }
            };

            const msg = messages[type];
            if (!msg) return;

            const newMsg = {
                id: currentChatMessages.length + 1,
                sender: 'You',
                avatar: 'SL',
                time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                ...msg,
                own: true
            };

            currentChatMessages.push(newMsg);
            renderChatMessages();
            showToast(`✅ ${type === 'tips' ? 'Tip' : type === 'celebrate' ? 'Celebration' : type === 'help' ? 'Help request' : 'Query'} shared with squad`);

            // Simulate contextual replies for each type
            setTimeout(() => {
                let replyMsg;
                const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

                if (type === 'tips') {
                    replyMsg = {
                        id: currentChatMessages.length + 1,
                        sender: 'Marcus Tan',
                        avatar: 'MT',
                        time: time,
                        type: 'text',
                        content: 'Great tip! I\'ve been using this strategy too - works like a charm! 💯'
                    };
                } else if (type === 'celebrate') {
                    replyMsg = {
                        id: currentChatMessages.length + 1,
                        sender: 'Rachel Ng',
                        avatar: 'RN',
                        time: time,
                        type: 'text',
                        content: 'Amazing work! 🔥 You\'re crushing it this week! Keep it up! 🚀'
                    };
                } else if (type === 'help') {
                    replyMsg = {
                        id: currentChatMessages.length + 1,
                        sender: 'Kevin Tan',
                        avatar: 'KT',
                        time: time,
                        type: 'text',
                        content: 'I can help! Our ILP has 100 fund options vs their 45. Also emphasize our lower management fees (1.2% vs 1.8%). Want to hop on a call?'
                    };
                } else if (type === 'megatron') {
                    replyMsg = {
                        id: currentChatMessages.length + 1,
                        sender: 'Megatron AI',
                        avatar: '🤖',
                        time: time,
                        type: 'tip',
                        title: '🤖 Megatron Response',
                        content: 'Latest updates: (1) HealthShield Premier now includes dental coverage up to $3K/year, (2) Smart Wealth Builder interest rate increased to 3.5%, (3) New rider available for chronic disease management. Check portal for full details.'
                    };
                }

                currentChatMessages.push(replyMsg);
                renderChatMessages();
            }, 2000);
        }

        // ===== DOSSIER NEWS INTEGRATION =====

        let dossierSelectedNews = {
            'chen-wei': [],
            'sarah-tan': []
        };

        // Render news selector in dossier
        function renderDossierNewsSelector(leadId) {
            const container = document.getElementById(`dossier-news-selector-${leadId}`);
            if (!container) {
                console.log('Container not found for leadId:', leadId);
                return;
            }

            // Check if newsData is available
            if (typeof newsData === 'undefined' || !newsData || newsData.length === 0) {
                container.innerHTML = '<div style="color: #999; font-size: 13px;">Loading news...</div>';
                // Retry after a delay
                setTimeout(() => renderDossierNewsSelector(leadId), 500);
                return;
            }

            // Filter relevant news (top 5 most relevant)
            const relevantNews = newsData.slice(0, 5);

            container.innerHTML = relevantNews.map(news => {
                const isSelected = dossierSelectedNews[leadId]?.includes(news.id);
                return `
                    <div class="dossier-news-item ${isSelected ? 'selected' : ''}" onclick="toggleDossierNews('${leadId}', ${news.id})">
                        <div class="dossier-news-checkbox">
                            ${isSelected ? '✓' : ''}
                        </div>
                        <div class="dossier-news-info">
                            <div class="dossier-news-headline">${news.headline}</div>
                            <div class="dossier-news-source">📰 ${news.source} • ${news.tags[0]}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle news selection in dossier
        function toggleDossierNews(leadId, newsId) {
            if (!dossierSelectedNews[leadId]) {
                dossierSelectedNews[leadId] = [];
            }

            const index = dossierSelectedNews[leadId].indexOf(newsId);
            if (index > -1) {
                dossierSelectedNews[leadId].splice(index, 1);
            } else {
                dossierSelectedNews[leadId].push(newsId);
            }

            renderDossierNewsSelector(leadId);
            updateDossierNewsContext(leadId);
        }

        // Update dossier news context based on selections
        function updateDossierNewsContext(leadId) {
            const contextContainer = document.getElementById(`dossier-selected-news-${leadId}`);
            const contextText = document.getElementById(`dossier-news-context-${leadId}`);

            if (!contextContainer || !contextText) return;

            const selectedIds = dossierSelectedNews[leadId] || [];

            if (selectedIds.length === 0) {
                contextContainer.style.display = 'none';
                return;
            }

            contextContainer.style.display = 'block';

            const selectedNewsItems = selectedIds.map(id => newsData.find(n => n.id === id)).filter(Boolean);

            // Get lead-specific context
            const leadContext = getLeadSpecificNewsContext(leadId, selectedNewsItems);

            const contextHtml = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="font-weight: 700; margin-bottom: 8px; font-size: 14px;">🤖 AI-Generated Impact Analysis</div>
                    <div style="font-size: 13px; line-height: 1.6;">${leadContext}</div>
                </div>
                ${selectedNewsItems.map(news => `
                    <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #bee5eb;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #0c5460;">📰 ${news.headline}</div>
                        <div style="margin-bottom: 8px; font-size: 13px;"><strong>General Talk Track:</strong> ${news.impactText}</div>
                        <div style="font-size: 11px; color: #0c5460;">
                            <strong>Source:</strong> ${news.source} | <strong>Category:</strong> ${news.tags.join(', ')}
                        </div>
                    </div>
                `).join('')}
            `;

            contextText.innerHTML = contextHtml;
        }

        // Generate lead-specific news context
        function getLeadSpecificNewsContext(leadId, newsItems) {
            // Lead profiles
            const leadProfiles = {
                'chen-wei': {
                    name: 'Chen Wei',
                    profile: '38-year-old investment banker, $15K/month income, recently married, high financial literacy',
                    interests: 'wealth accumulation, investment-linked policies, premium health coverage'
                },
                'sarah-tan': {
                    name: 'Sarah Tan',
                    profile: '34-year-old mother of 2, $8K/month income, family protection focused',
                    interests: 'family health coverage, life insurance, critical illness protection'
                }
            };

            const lead = leadProfiles[leadId];
            if (!lead) return 'Use these news insights to enhance your conversation.';

            // Generate contextual insights based on news
            if (newsItems.length === 0) return '';

            const newsTopics = newsItems.map(n => n.tags[0]).join(', ');

            let context = `<strong>For ${lead.name} specifically:</strong><br><br>`;

            newsItems.forEach((news, index) => {
                if (leadId === 'chen-wei') {
                    // Chen Wei specific contexts
                    if (news.id === 1) { // MAS Outpatient Coverage
                        context += `${index + 1}. <strong>MAS Outpatient Reform:</strong> Chen Wei's high income and preference for premium coverage make this regulatory change a perfect opener. "The new MAS guidelines mean basic plans no longer cut it for comprehensive outpatient care—exactly why HealthShield Premium's enhanced coverage is critical for someone at your income level."<br><br>`;
                    } else if (news.id === 2) { // NTUC Life360
                        context += `${index + 1}. <strong>NTUC Life360 Launch:</strong> Use this competitively: "While NTUC's new plan offers basic coverage, our WealthBuilder ILP gives you 100 fund options vs their 45, plus better management fees (1.2% vs 1.8%). For a finance professional like you, that compounds significantly over 20 years."<br><br>`;
                    } else if (news.id === 3) { // CPF Life Adjustments
                        context += `${index + 1}. <strong>CPF Life Changes:</strong> Perfect for Chen Wei's wealth mindset: "CPF Life increases show longer lifespans—great news, but it also means your retirement gap is wider. Your $15K income today needs $8-10K replacement monthly. CPF covers maybe 30%—our Smart Wealth Builder fills that gap with tax-efficient growth."<br><br>`;
                    } else if (news.id === 4) { // Hospital Costs Rise
                        context += `${index + 1}. <strong>Rising Hospital Costs:</strong> Chen Wei researched premium hospital coverage—this validates his concern: "Private hospital ICU now costs $3,800/day—12% up YoY. Your research showed you value premium care. Our PrivateShield Premier with no co-payment protects against this inflation without surprise bills."<br><br>`;
                    } else if (news.id === 9) { // Industry Growth
                        context += `${index + 1}. <strong>Insurance Sector Growth:</strong> Social proof for Chen Wei: "Industry-wide 18% premium growth shows savvy Singaporeans prioritizing protection. As a finance professional, you recognize this trend—smart money is locking in coverage now before premiums adjust for the next actuarial cycle."<br><br>`;
                    } else {
                        context += `${index + 1}. ${news.impactText}<br><br>`;
                    }
                } else if (leadId === 'sarah-tan') {
                    // Sarah Tan specific contexts
                    if (news.id === 1) { // MAS Outpatient Coverage
                        context += `${index + 1}. <strong>MAS Outpatient Reform:</strong> Perfect for Sarah's family concerns: "The new MAS outpatient guidelines expand coverage—critical for a family with young kids. Children need frequent doctor visits for colds, fevers, specialists. Our HealthShield Gold Plus already exceeds these new requirements with unlimited outpatient coverage for your entire family."<br><br>`;
                    } else if (news.id === 4) { // Hospital Costs Rise
                        context += `${index + 1}. <strong>Rising Hospital Costs:</strong> Address Sarah's biggest fear: "Hospital costs are up 12% this year—one pediatric ICU stay for dengue or pneumonia can cost $20K-$30K. With two young children, you can't afford to gamble. Our family plan covers all 4 of you with ZERO co-payment, so you never choose between your child's health and your savings."<br><br>`;
                    } else if (news.id === 8) { // MediShield Cancer Coverage
                        context += `${index + 1}. <strong>MediShield Cancer Expansion:</strong> Reassure while upselling: "Good news—MediShield now covers more cancer treatments. But here's what they don't tell you: MediShield limits mean 70% of costs still come from your pocket. Our CriticalCare covers 120 critical illnesses including childhood cancers, pays lump sum on diagnosis—you use it however you need. One parent can even stop working to care for the child."<br><br>`;
                    } else if (news.id === 3) { // CPF Life
                        context += `${index + 1}. <strong>CPF Life Updates:</strong> Frame for family planning: "CPF Life increases are great, but they highlight longevity—your kids might support you for 30+ years. That's why protecting your income NOW is critical. If something happens to you or your husband, this life insurance ensures your kids' education and family lifestyle continue uninterrupted."<br><br>`;
                    } else if (news.id === 9) { // Industry Growth
                        context += `${index + 1}. <strong>Insurance Sector Growth:</strong> Social proof for Sarah: "More Singapore families are buying protection—18% growth shows parents prioritizing their children's security. You're not alone in this concern. Smart parents like you are acting now because premiums only go up as kids grow and you get older."<br><br>`;
                    } else {
                        context += `${index + 1}. ${news.impactText}<br><br>`;
                    }
                } else {
                    context += `${index + 1}. ${news.impactText}<br><br>`;
                }
            });

            return context;
        }

        // Initialize news selector when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Check if we're on a dossier screen
            const dossierScreens = ['chen-wei', 'sarah-tan'];
            dossierScreens.forEach(leadId => {
                const container = document.getElementById(`dossier-news-selector-${leadId}`);
                if (container) {
                    renderDossierNewsSelector(leadId);
                }
            });
        });

        // Update useInDossier function
        function useInDossier(newsId) {
            const news = newsData.find(n => n.id === newsId);
            if (!news) return;

            // For now, add to Chen Wei's dossier as default
            const leadId = 'chen-wei';

            if (!dossierSelectedNews[leadId]) {
                dossierSelectedNews[leadId] = [];
            }

            if (!dossierSelectedNews[leadId].includes(newsId)) {
                dossierSelectedNews[leadId].push(newsId);
            }

            // Switch to dossier view
            viewDossier(leadId);

            showToast(`✅ Added to dossier: "${news.headline.substring(0, 30)}..."`);
        }

        // Update shareNews function to also post to squad chat
        function shareNews(newsId) {
            const news = newsData.find(n => n.id === newsId);
            if (!news) return;

            const currentTime = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            // Add to shared news feed
            const existingShare = sharedNewsItems.find(item => item.newsId === newsId);
            if (!existingShare) {
                sharedNewsItems.unshift({
                    newsId: newsId,
                    sharedBy: 'You',
                    sharedTime: currentTime,
                    isNew: true
                });
            }

            // Add to chat
            const newMsg = {
                id: currentChatMessages.length + 1,
                sender: 'You',
                avatar: 'SL',
                time: currentTime,
                type: 'news',
                title: '📰 Shared from News Hub',
                content: news.headline + ' - ' + news.impactText.substring(0, 80) + '...',
                newsId: newsId,
                own: true
            };

            currentChatMessages.push(newMsg);

            // Update squad news feed if visible
            renderSquadNewsFeed();

            showToast(`📤 News shared to squad: ${news.headline.substring(0, 35)}...`);

            // Simulate squad member reaction
            setTimeout(() => {
                const reactions = [
                    'This is super useful, thanks for sharing! 💯',
                    'Perfect timing! I have a client meeting this afternoon.',
                    'Great find! Adding this to my talk track.',
                    'Thanks! This will help with my upcoming calls.',
                    'Excellent insight! Sharing with my mentee too.'
                ];

                const replyMsg = {
                    id: currentChatMessages.length + 1,
                    sender: 'Rachel Ng',
                    avatar: 'RN',
                    time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                    type: 'text',
                    content: reactions[Math.floor(Math.random() * reactions.length)]
                };

                currentChatMessages.push(replyMsg);
                renderChatMessages();
            }, 2000);
        }
    </script>
</body>
</html>
